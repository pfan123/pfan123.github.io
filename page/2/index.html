<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>pfan博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="pfan博客 新起点，新高度">
<meta property="og:type" content="website">
<meta property="og:title" content="pfan博客">
<meta property="og:url" content="http://pfan123.github.io/page/2/index.html">
<meta property="og:site_name" content="pfan博客">
<meta property="og:description" content="pfan博客 新起点，新高度">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="pfan博客">
<meta name="twitter:description" content="pfan博客 新起点，新高度">
  
    <link rel="alternative" href="/atom.xml" title="pfan博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://litten.github.io/assets/blogImg/litten.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">pfan</a></h1>
		</hgroup>

		
		<p class="header-subtitle">新起点，新高度</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>		
					
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>

			</div>
		


		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
				        	<li class = "article_cate_tit"> 文章分类</li>
				        	<li class = "article_cate_a"> <a  href = "/categories/技术杂谈/">技术杂谈</a>	</li>
				        	<li class = "article_cate_a"> <a href = "/categories/兴趣爱好/">兴趣爱好</a>		</li>
				        	<li class = "article_cate_a"> <a href = "/categories/日志/">日志</a></li>
				        	<li class = "article_cate_a"> <a href = "/categories/JavaScript/">JavaScript</a>	</li>
				        	<li class = "article_cate_a"> <a  href = "/categories/CSS3/">CSS3</a>	</li>
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/pfan123" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/gaolu1990/home?wvr=5" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>



				<style type="text/css">
					.article_cate_tit{
						color:#ba8f6c;
						margin-top:6px;
					}
					.article_cate_con a{
						display:block;
						font-size:12px;
						text-align:center;
						margin:4px 0;
					}
					#header .header-menu{
						line-height:21px;
					}
					.article_cate_a{
						line-height:18px !important;
					}	
					.article_cate_a a{
						font-size:12px !important;
					}				
					#container .left-col .overlay{
						height:130px;
					}
					.header-nav{
						top:160px;
					}
				</style>	
				<!-- E 新增模块-->
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/gitignore-git/" style="font-size: 10px;">.gitignore git</a> <a href="/tags/htaccess-配置二级域名-绑定子目录/" style="font-size: 10px;">.htaccess  配置二级域名  绑定子目录</a> <a href="/tags/AMD/" style="font-size: 10px;">AMD</a> <a href="/tags/CMD/" style="font-size: 10px;">CMD</a> <a href="/tags/CSS-BEM-OOCSS/" style="font-size: 10px;">CSS BEM OOCSS</a> <a href="/tags/CSS动画篇/" style="font-size: 10px;">CSS动画篇</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/ESLint/" style="font-size: 10px;">ESLint</a> <a href="/tags/Git，Git查看历史记录/" style="font-size: 10px;">Git，Git查看历史记录</a> <a href="/tags/H5/" style="font-size: 10px;">H5</a> <a href="/tags/H5-视频直播-video/" style="font-size: 10px;">H5 视频直播 video</a> <a href="/tags/H5全景、CSS3d、perspective/" style="font-size: 20px;">H5全景、CSS3d、perspective</a> <a href="/tags/HLS、RTMP协议/" style="font-size: 10px;">HLS、RTMP协议</a> <a href="/tags/HTML5/" style="font-size: 20px;">HTML5</a> <a href="/tags/HTML5-视频直播-video-canvas/" style="font-size: 10px;">HTML5 视频直播 video canvas</a> <a href="/tags/HTTP、-node-http-proxy、-nginx、-proxy/" style="font-size: 20px;">HTTP、 node-http-proxy、 nginx、 proxy</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Mac-命令-Terminal-osx/" style="font-size: 10px;">Mac 命令 Terminal osx</a> <a href="/tags/Mac、root/" style="font-size: 10px;">Mac、root</a> <a href="/tags/Math-atan-、Math-atan2-斜率/" style="font-size: 10px;">Math.atan()、Math.atan2() 斜率</a> <a href="/tags/Mongoose参考手册-MongoDB-数据库-node/" style="font-size: 10px;">Mongoose参考手册  MongoDB  数据库 node</a> <a href="/tags/Nginx-负载均衡/" style="font-size: 10px;">Nginx  负载均衡</a> <a href="/tags/Nginx-负载均衡-node-jdc-解决方案-host/" style="font-size: 10px;">Nginx  负载均衡 node  jdc 解决方案 host</a> <a href="/tags/Nginx-Mac-Node/" style="font-size: 10px;">Nginx Mac Node</a> <a href="/tags/Nginx-MySQL-PHP-FPM-Mac-OS/" style="font-size: 10px;">Nginx MySQL PHP-FPM Mac OS</a> <a href="/tags/Nodejs学习实践-nodejs-ES6/" style="font-size: 10px;">Nodejs学习实践 nodejs  ES6</a> <a href="/tags/PreloadJS-EaselJS-TweenJS-SoundJS/" style="font-size: 10px;">PreloadJS EaselJS TweenJS SoundJS</a> <a href="/tags/SVG-Sprites-Symbols/" style="font-size: 10px;">SVG Sprites Symbols</a> <a href="/tags/UMD/" style="font-size: 10px;">UMD</a> <a href="/tags/Vim-vi/" style="font-size: 10px;">Vim vi</a> <a href="/tags/createJS/" style="font-size: 10px;">createJS</a> <a href="/tags/css-modules-scope-模块化/" style="font-size: 10px;">css modules  scope  模块化</a> <a href="/tags/deviceorientation、orientationchange-重力感应/" style="font-size: 10px;">deviceorientation、orientationchange 重力感应</a> <a href="/tags/deviceorientation、orientationchange-重力感应-CSS3D/" style="font-size: 10px;">deviceorientation、orientationchange 重力感应 CSS3D</a> <a href="/tags/express/" style="font-size: 10px;">express</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/hexo初始/" style="font-size: 10px;">hexo初始</a> <a href="/tags/hexo相关问题/" style="font-size: 10px;">hexo相关问题</a> <a href="/tags/insertAdjacentHTML方法/" style="font-size: 10px;">insertAdjacentHTML方法</a> <a href="/tags/insertAdjacentText方法/" style="font-size: 10px;">insertAdjacentText方法</a> <a href="/tags/javascript、canvas、toDataURL/" style="font-size: 10px;">javascript、canvas、toDataURL()</a> <a href="/tags/mac-iphone-铃声/" style="font-size: 10px;">mac iphone 铃声</a> <a href="/tags/node-版本管理-nvm-n/" style="font-size: 10px;">node 版本管理  nvm  n</a> <a href="/tags/node-读写excel-JS-XLSX-分析excel写入/" style="font-size: 10px;">node 读写excel JS-XLSX 分析excel写入</a> <a href="/tags/pm2学习实践-nodejs-pm2/" style="font-size: 10px;">pm2学习实践 nodejs pm2</a> <a href="/tags/react-flux-redux-ECMAScript6-Vue-Angular-Angular2-0-NuclearJS/" style="font-size: 10px;">react flux redux ECMAScript6 Vue Angular Angular2.0 NuclearJS</a> <a href="/tags/ssh常用命令-SSH/" style="font-size: 10px;">ssh常用命令  SSH</a> <a href="/tags/video-canvas/" style="font-size: 10px;">video canvas</a> <a href="/tags/vue-router-vue/" style="font-size: 10px;">vue-router, vue</a> <a href="/tags/webp/" style="font-size: 10px;">webp</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/三角学、弧度、角度/" style="font-size: 10px;">三角学、弧度、角度</a> <a href="/tags/买房前必备知识-house-home/" style="font-size: 10px;">买房前必备知识  house home</a> <a href="/tags/买车前必备知识-car/" style="font-size: 10px;">买车前必备知识  car</a> <a href="/tags/京东购物H5活动CP重构规范/" style="font-size: 10px;">京东购物H5活动CP重构规范</a> <a href="/tags/优化JavaScript的执行效率/" style="font-size: 10px;">优化JavaScript的执行效率</a> <a href="/tags/前端性能优化/" style="font-size: 10px;">前端性能优化</a> <a href="/tags/吉他/" style="font-size: 10px;">吉他</a> <a href="/tags/吉他知识/" style="font-size: 10px;">吉他知识</a> <a href="/tags/学吉他知识集锦/" style="font-size: 10px;">学吉他知识集锦</a> <a href="/tags/旅游-帝都畅游-相约北京/" style="font-size: 10px;">旅游 帝都畅游 相约北京</a> <a href="/tags/模块的写法/" style="font-size: 10px;">模块的写法</a> <a href="/tags/运营规范/" style="font-size: 10px;">运营规范</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/pingfan1990/">博客园博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.w3cfuns.com/house.php">前端网博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://pingfan1990.sinaapp.com/">pfan展示平台</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://doc.pfan123.com/">pfan前端开发导航平台</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">因上努力，果上随缘</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">pfan</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://litten.github.io/assets/blogImg/litten.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">pfan</h1>
			</hgroup>
			
			<p class="header-subtitle">新起点，新高度</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/pfan123" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/gaolu1990/home?wvr=5" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-canvas跨域问题" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/22/canvas跨域问题/" class="article-date">
  	<time datetime="2016-10-22T15:56:21.000Z" itemprop="datePublished">2016-10-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/22/canvas跨域问题/">跨域图片资源权限(CORS enabled image) - HTML | MDN</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>HTML 规范文档为 images 引入了 <code>crossorigin</code> 属性, 通过设置适当的头信息 <code>CORS</code> , 可以从其他站点加载 <code>img</code> 图片, 并用在 canvas 中,就像从当前站点(current origin)直接下载的一样.</p>
<p>crossorigin 属性的使用细节, 请参考 <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes" target="_blank" rel="external">CORS settings attributes.</a></p>
<h3 id="什么是-“被污染的-tainted-”-canvas"><a href="#什么是-“被污染的-tainted-”-canvas" class="headerlink" title="什么是 “被污染的(tainted)” canvas?"></a>什么是 “被污染的(tainted)” canvas?</h3><p>尽管没有CORS授权也可以在 canvas 中使用图像, 但这样做就会污染(taints)画布。 只要 canvas 被污染, 就不能再从画布中提取数据, 也就是说不能再调用 <code>toBlob()</code>, <code>toDataURL()</code> 和 <code>getImageData()</code> 等方法, 否则会抛出安全错误(security error).</p>
<p>这实际上是为了保护用户的个人信息,避免未经许可就从远程web站点加载用户的图像信息,造成隐私泄漏。</p>
<blockquote>
<p>如果用户登陆过QQ等社交网站, 假若不做保护 ,则可能打开某个网站后,该网站利用 canvas 将用户的图片信息获取,上传,进而引发泄露.</p>
</blockquote>
<h3 id="示例-从其他站点保存图片"><a href="#示例-从其他站点保存图片" class="headerlink" title="示例: 从其他站点保存图片"></a>示例: 从其他站点保存图片</h3><p>首先, 图片服务器必须设置相应的 <code>Access-Control-Allow-Origin</code> 响应头。添加 img 元素的 crossOrigin 属性来请求头。比如Apache服务器,可以拷贝 <a href="https://github.com/h5bp/server-configs-apache/blob/fc379c45f52a09dd41279dbf4e60ae281110a5b0/src/.htaccess#L36-L53" target="_blank" rel="external">HTML5 Boilerplate Apache server configs</a> 中的配置信息, 来进行回应:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;IfModule mod_setenvif.c&gt;</span><br><span class="line">    &lt;IfModule mod_headers.c&gt;</span><br><span class="line">    &lt;FilesMatch &quot;\.(cur|gif|ico|jpe?g|png|svgz?|webp)$&quot;&gt;</span><br><span class="line">        SetEnvIf Origin &quot;:&quot; IS_CORS</span><br><span class="line">        Header set Access-Control-Allow-Origin &quot;*&quot; env=IS_CORS</span><br><span class="line">    &lt;/FilesMatch&gt;</span><br><span class="line">    &lt;/IfModule&gt;</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>
<p>这些设置生效之后, 就可以像本站的资源一样, 保存其他站点的图片到 DOM存储) 之中(或者其他地方)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var img = new Image,</span><br><span class="line">    canvas = document.createElement(&quot;canvas&quot;),</span><br><span class="line">    ctx = canvas.getContext(&quot;2d&quot;),</span><br><span class="line">    src = &quot;http://example.com/image&quot;; // 具体的图片地址</span><br><span class="line"></span><br><span class="line">img.crossOrigin = &quot;Anonymous&quot;; //或 img.crossOrigin = &quot;＊&quot;; </span><br><span class="line"></span><br><span class="line">img.onload = function() &#123;</span><br><span class="line">    canvas.width = img.width;</span><br><span class="line">    canvas.height = img.height;</span><br><span class="line">    ctx.drawImage( img, 0, 0 );</span><br><span class="line">    localStorage.setItem( &quot;savedImageData&quot;, canvas.toDataURL(&quot;image/png&quot;) );</span><br><span class="line">&#125;</span><br><span class="line">img.src = src;</span><br><span class="line">//  确保缓存的图片也触发 load 事件</span><br><span class="line">if ( img.complete || img.complete === undefined ) &#123;</span><br><span class="line">    img.src = &quot;data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==&quot;;</span><br><span class="line">    img.src = src;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考资料:<br><a href="https://blog.chromium.org/2011/07/using-cross-domain-images-in-webgl-and.html" target="_blank" rel="external">Chrome:在WebGL中使用跨域图片</a><br><a href="https://html.spec.whatwg.org/multipage/#attr-img-crossorigin" target="_blank" rel="external">HTML规范-crossorigin属性</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript、canvas、toDataURL/">javascript、canvas、toDataURL()</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/javascript/">javascript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-vue-router心得" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/11/vue-router心得/" class="article-date">
  	<time datetime="2016-10-11T15:56:21.000Z" itemprop="datePublished">2016-10-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/11/vue-router心得/">vue-router进阶指南</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>“vue-router”: “^0.7.13”</p>
<p>参考资料:<br><a href="https://github.com/vuejs/vue-router/tree/master/docs/zh-cn" target="_blank" rel="external">vue-router文档</a><br><a href="http://www.cnblogs.com/keepfool/p/5690366.html" target="_blank" rel="external">Vue.js——vue-router 60分钟快速入门</a><br><a href="https://github.com/vuejs/vue-router/blob/master/docs/zh-cn/pipeline/data.md" target="_blank" rel="external">相同路由调转data(transition) [-&gt; Promise]</a><br><a href="https://github.com/vuejs/vue-router/issues/201" target="_blank" rel="external">相同路径下跳转怎么处理</a><br><a href="https://segmentfault.com/a/1190000004669403" target="_blank" rel="external">关于Vue生命周期的思考[zzky]</a><br><a href="https://cnodejs.org/topic/57e0d5ba3af3942a3aa3b8e9" target="_blank" rel="external">vue中使用路由跳转时，如果跳转的页面是当前页面，如何实现刷新当前页</a><br><a href="http://y.dobit.top/Detail/295.html" target="_blank" rel="external">vue.js 1.0的一些总结</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue-router-vue/">vue-router, vue</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-mac终端切换root用户" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/11/mac终端切换root用户/" class="article-date">
  	<time datetime="2016-10-11T15:56:21.000Z" itemprop="datePublished">2016-10-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/11/mac终端切换root用户/">Mac 终端切换root用户</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Mac-终端切换root用户方法"><a href="#Mac-终端切换root用户方法" class="headerlink" title="Mac 终端切换root用户方法"></a>Mac 终端切换root用户方法</h2><p>方法一：</p>
<ul>
<li><ol>
<li>打开Terminal</li>
</ol>
</li>
<li><ol>
<li>jonesduan-MacBook-Pro:~ user$ sudo -i</li>
</ol>
</li>
<li><ol>
<li>输入root密码即可。</li>
</ol>
</li>
</ul>
<p>方法二：</p>
<ul>
<li><ol>
<li>打开Terminal</li>
</ol>
</li>
<li><ol>
<li>jonesduan-MacBook-Pro:~ user$ sudo su</li>
</ol>
</li>
<li><ol>
<li>输入root密码即可。</li>
</ol>
</li>
</ul>
<p>两者方法区别在于：获取root权限后终端显示的不一样。</p>
<p>方法一是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jonesduan-MacBook-Pro:~ root#</span><br></pre></td></tr></table></figure></p>
<p>方法二是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh-3.2#</span><br></pre></td></tr></table></figure></p>
<h2 id="Mac-终端退出root权限切换user用户"><a href="#Mac-终端退出root权限切换user用户" class="headerlink" title="Mac 终端退出root权限切换user用户"></a>Mac 终端退出root权限切换user用户</h2><p>从root用户切回user用户只需执行命令：su user (user是你自己安装时候的用户名)，或是直接输入exit，也可Ctrl+D组合键推出</p>
<p>参考资料:<br><a href="http://blog.csdn.net/xuefeng1009/article/details/7421804" target="_blank" rel="external">Mac下忘记root密码，修改root密码介绍参见</a><br><a href="http://shlei.iteye.com/blog/855336" target="_blank" rel="external">Mac下root用户的启用和停用参见</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mac、root/">Mac、root</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-H5直播起航" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/16/H5直播起航/" class="article-date">
  	<time datetime="2016-09-16T03:51:43.000Z" itemprop="datePublished">2016-09-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/16/H5直播起航/">H5直播起航</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/img/hls/banner.png" alt="直播起航"></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前不久抽空对目前比较火的视频直播，做了下研究与探索，了解其整体实现流程，以及探讨移动端HTML5直播可行性方案。</p>
<p>发现目前 WEB 上主流的视频直播方案有 HLS 和 RTMP，移动 WEB 端目前以HLS为主（HLS存在延迟性问题，也可以借助 <a href="https://github.com/videojs/video.js" target="_blank" rel="external">video.js</a>  采用RTMP），PC端则以RTMP为主实时性较好，接下来将围绕这两种视频流协议来展开H5直播主题分享。</p>
<h2 id="一、视频流协议HLS与RTMP"><a href="#一、视频流协议HLS与RTMP" class="headerlink" title="一、视频流协议HLS与RTMP"></a>一、视频流协议HLS与RTMP</h2><h3 id="1-HTTP-Live-Streaming"><a href="#1-HTTP-Live-Streaming" class="headerlink" title="1. HTTP Live Streaming"></a>1. HTTP Live Streaming</h3><p>HTTP Live Streaming（简称 HLS）是一个基于 HTTP 的视频流协议，由 Apple 公司实现，Mac OS 上的 QuickTime、Safari 以及 iOS 上的 Safari 都能很好的支持 HLS，高版本 Android 也增加了对 HLS 的支持。一些常见的客户端如：MPlayerX、VLC 也都支持 HLS 协议。</p>
<p>HLS 协议基于 HTTP，而一个提供 HLS 的服务器需要做两件事：</p>
<ul>
<li>编码：以 H.263 格式对图像进行编码，以 MP3 或者 HE-AAC 对声音进行编码，最终打包到 MPEG-2 TS（Transport Stream）容器之中；</li>
<li>分割：把编码好的 TS 文件等长切分成后缀为 ts 的小文件，并生成一个 .m3u8 的纯文本索引文件；</li>
</ul>
<p>浏览器使用的是 m3u8 文件。m3u8 跟音频列表格式 m3u 很像，可以简单的认为 m3u8 就是包含多个 ts 文件的播放列表。播放器按顺序逐个播放，全部放完再请求一下 m3u8 文件，获得包含最新 ts 文件的播放列表继续播，周而复始。整个直播过程就是依靠一个不断更新的 m3u8 和一堆小的 ts 文件组成，m3u8 必须动态更新，ts 可以走 CDN。一个典型的 m3u8 文件格式如下：</p>
<blockquote>
<p>#EXTM3U</p>
<p>#EXT-X-STREAM-INF:PROGRAM-ID=1, BANDWIDTH=200000<br>gear1/prog_index.m3u8</p>
<p>#EXT-X-STREAM-INF:PROGRAM-ID=1, BANDWIDTH=311111<br>gear2/prog_index.m3u8</p>
<p>#EXT-X-STREAM-INF:PROGRAM-ID=1, BANDWIDTH=484444<br>gear3/prog_index.m3u8</p>
<p>#EXT-X-STREAM-INF:PROGRAM-ID=1, BANDWIDTH=737777<br>gear4/prog_index.m3u8</p>
</blockquote>
<p>可以看到 HLS 协议本质还是一个个的 HTTP 请求 / 响应，所以适应性很好，不会受到防火墙影响。但它也有一个致命的弱点：延迟现象非常明显。如果每个 ts 按照 5 秒来切分，一个 m3u8 放 6 个 ts 索引，那么至少就会带来 30 秒的延迟。如果减少每个 ts 的长度，减少 m3u8 中的索引数，延时确实会减少，但会带来更频繁的缓冲，对服务端的请求压力也会成倍增加。所以只能根据实际情况找到一个折中的点。</p>
<p>对于支持 HLS 的浏览器来说，直接这样写就能播放了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;video src=&quot;http://devimages.apple.com/iphone/samples/bipbop/bipbopall.m3u8&quot;</span><br><span class="line">height=&quot;300&quot; width=&quot;400&quot;  preload=&quot;auto&quot; autoplay=&quot;autoplay&quot; loop=&quot;loop&quot; webkit-playsinline=&quot;true&quot;&gt;&lt;/video&gt;</span><br></pre></td></tr></table></figure>
<p><code>注意</code>：HLS 在pc端仅支持safari浏览器，类似chrome浏览器使用<code>HTML5 video</code>标签无法播放 m3u8 格式，可直接采用网上一些比较成熟的方案，如：<a href="https://github.com/jackzhang1204/sewise-player" target="_blank" rel="external">sewise-player</a>、<a href="https://github.com/johndyer/mediaelement" target="_blank" rel="external">MediaElement</a>、<a href="https://github.com/videojs/videojs-contrib-hls" target="_blank" rel="external">videojs-contrib-hls</a>、<a href="https://github.com/jwplayer/jwplayer" target="_blank" rel="external">jwplayer</a>。</p>
<h3 id="2-Real-Time-Messaging-Protocol"><a href="#2-Real-Time-Messaging-Protocol" class="headerlink" title="2. Real Time Messaging Protocol"></a>2. Real Time Messaging Protocol</h3><p>Real Time Messaging Protocol（简称 RTMP）是 Macromedia 开发的一套视频直播协议，现在属于 Adobe。这套方案需要搭建专门的 RTMP 流媒体服务如 Adobe Media Server，并且在浏览器中只能使用 Flash 实现播放器。它的实时性非常好，延迟很小，但无法支持移动端 WEB 播放是它的硬伤。</p>
<p>虽然无法在iOS的H5页面播放，但是对于iOS原生应用是可以自己写解码去解析的, RTMP 延迟低、实时性较好。</p>
<p>浏览器端，<code>HTML5 video</code>标签无法播放 RTMP 协议的视频，可以通过 <a href="https://github.com/videojs/video.js" target="_blank" rel="external">video.js</a> 来实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;link href=&quot;http://vjs.zencdn.net/5.8.8/video-js.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;video id=&quot;example_video_1&quot; class=&quot;video-js vjs-default-skin&quot; controls preload=&quot;auto&quot; width=&quot;640&quot; height=&quot;264&quot; loop=&quot;loop&quot; webkit-playsinline&gt;</span><br><span class="line">  &lt;source src=&quot;rtmp://10.14.221.17:1935/rtmplive/home&quot; type=&apos;rtmp/flv&apos;&gt;</span><br><span class="line">&lt;/video&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;http://vjs.zencdn.net/5.8.8/video.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">videojs.options.flash.swf = &apos;video.swf&apos;;</span><br><span class="line">videojs(&apos;example_video_1&apos;).ready(function() &#123;</span><br><span class="line">  this.play();</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-视频流协议HLS与RTMP对比"><a href="#3-视频流协议HLS与RTMP对比" class="headerlink" title="3. 视频流协议HLS与RTMP对比"></a>3. 视频流协议HLS与RTMP对比</h3><table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">协议</th>
<th style="text-align:center">原理</th>
<th style="text-align:center">延时</th>
<th style="text-align:center">优点</th>
<th style="text-align:center">使用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">HLS</td>
<td style="text-align:center">短链接Http</td>
<td style="text-align:center">集合一段时间数据生成ts切片文件更新m3u8文件</td>
<td style="text-align:center">10s - 30s</td>
<td style="text-align:center">跨平台</td>
<td style="text-align:center">移动端为主</td>
</tr>
<tr>
<td style="text-align:center">RTMP</td>
<td style="text-align:center">长链接Tcp</td>
<td style="text-align:center">每个时刻的数据收到后立即发送</td>
<td style="text-align:center">2s</td>
<td style="text-align:center">延时低、实时性好</td>
<td style="text-align:center">PC+直播+实时性要求高＋互动性强</td>
</tr>
</tbody>
</table>
<h2 id="二、直播形式"><a href="#二、直播形式" class="headerlink" title="二、直播形式"></a>二、直播形式</h2><p><img src="/img/hls/1.png" alt="直播形式"></p>
<p>目前直播展示形式，通常以YY直播、映客直播这种页面居多，可以看到其结构可以分成三层：① 背景视频层 ② 关注、评论模块 ③ 点赞动画</p>
<p>而现行H5类似直播页面，实现技术难点不大，其可以通过实现方式分为：① 底部视频背景使用video视频标签实现播放 ② 关注、评论模块利用 WebScoket 来实时发送和接收新的消息通过DOM 和 CSS3 实现  ③ 点赞利用 CSS3 动画</p>
<p>了解完直播形式之后，接下来整体了解直播流程。</p>
<h2 id="三、直播整体流程"><a href="#三、直播整体流程" class="headerlink" title="三、直播整体流程"></a>三、直播整体流程</h2><p>直播整体流程大致可分为：</p>
<ul>
<li><p>视频采集端：可以是电脑上的音视频输入设备、或手机端的摄像头、或麦克风，目前以移动端手机视频为主。</p>
</li>
<li><p>直播流视频服务端：一台Nginx服务器，采集视频录制端传输的视频流(H264/ACC编码)，由服务器端进行解析编码，推送RTMP/HLS格式视频流至视频播放端。</p>
</li>
<li><p>视频播放端：可以是电脑上的播放器（QuickTime Player、VLC），手机端的native播放器，还有就是 H5 的video标签等，目前还是以手机端的native播放器为主。</p>
</li>
</ul>
<p><img src="/img/hls/2.png" alt="直播整体流程"></p>
<h2 id="四、H5-录制视频"><a href="#四、H5-录制视频" class="headerlink" title="四、H5 录制视频"></a>四、H5 录制视频</h2><p>对于H5视频录制，可以使用强大的 webRTC （Web Real-Time Communication）是一个支持网页浏览器进行实时语音对话或视频对话的技术，缺点是只在 PC 的 Chrome 上支持较好，移动端支持不太理想。</p>
<h3 id="1-使用-webRTC-录制视频基本流程"><a href="#1-使用-webRTC-录制视频基本流程" class="headerlink" title="1. 使用 webRTC 录制视频基本流程"></a>1. 使用 webRTC 录制视频基本流程</h3><p>① 调用 <code>window.navigator.webkitGetUserMedia()</code> 获取用户的PC摄像头视频数据。<br>② 将获取到视频流数据转换成 <code>window.webkitRTCPeerConnection</code> (一种视频流数据格式)。<br>③ 利用 <code>WebScoket</code> 将视频流数据传输到服务端。</p>
<p><code>注意</code>：虽然Google一直在推WebRTC，目前已有不少成型的产品出现，但是大部分移动端的浏览器还不支持 webRTC（最新iOS 10.0也不支持），所以真正的视频录制还是要靠客户端（iOS,Android）来实现,效果会好一些。</p>
<p><img src="/img/hls/3.png" alt="WebRTC支持度"></p>
<h3 id="2-iOS原生应用调用摄像头录制视频流程"><a href="#2-iOS原生应用调用摄像头录制视频流程" class="headerlink" title="2. iOS原生应用调用摄像头录制视频流程"></a>2. iOS原生应用调用摄像头录制视频流程</h3><p>① 音视频的采集，利用AVCaptureSession和AVCaptureDevice可以采集到原始的音视频数据流。<br>② 对视频进行H264编码，对音频进行AAC编码，在iOS中分别有已经封装好的编码库（<a href="https://github.com/kewlbear/x264-ios" target="_blank" rel="external">x264编码</a>、<a href="https://github.com/fflydev/faac-ios-build" target="_blank" rel="external">faac编码</a>、<a href="https://github.com/kewlbear/FFmpeg-iOS-build-script" target="_blank" rel="external">ffmpeg编码</a>）来实现对音视频的编码。<br>③ 对编码后的音、视频数据进行组装封包。<br>④ 建立RTMP连接并上推到服务端。</p>
<p><img src="/img/hls/4.png" alt="视频流程"></p>
<h2 id="五、搭建Nginx-Rtmp直播流服务"><a href="#五、搭建Nginx-Rtmp直播流服务" class="headerlink" title="五、搭建Nginx+Rtmp直播流服务"></a>五、搭建Nginx+Rtmp直播流服务</h2><h3 id="1-安装nginx、nginx-rtmp-module"><a href="#1-安装nginx、nginx-rtmp-module" class="headerlink" title="1. 安装nginx、nginx-rtmp-module"></a>1. 安装nginx、nginx-rtmp-module</h3><p>① 先<code>clone nginx</code>项目到本地：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew tap homebrew/nginx</span><br></pre></td></tr></table></figure>
<p>② 执行安装<code>nginx-rtmp-module</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nginx-full --with-rtmp-module</span><br></pre></td></tr></table></figure>
<h3 id="2-nginx-conf配置文件，配置RTMP、HLS"><a href="#2-nginx-conf配置文件，配置RTMP、HLS" class="headerlink" title="2. nginx.conf配置文件，配置RTMP、HLS"></a>2. nginx.conf配置文件，配置RTMP、HLS</h3><p>查找到nginx.conf配置文件（路径/usr/local/etc/nginx/nginx.conf），配置rtmp、hls。</p>
<p>① 在http节点之前添加 rtmp 的配置内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">rtmp &#123;</span><br><span class="line">  server &#123;</span><br><span class="line">     #监听的端口</span><br><span class="line">      listen 1935;</span><br><span class="line">      # RTMP 直播流配置</span><br><span class="line">      application rtmplive &#123;</span><br><span class="line">          live on;</span><br><span class="line">	      #为 rtmp 引擎设置最大连接数。默认为 off</span><br><span class="line">	      max_connections 1024;</span><br><span class="line">       &#125;</span><br><span class="line">	  # HLS 直播流配置</span><br><span class="line">      application hls&#123;</span><br><span class="line">          live on;</span><br><span class="line">          hls on;</span><br><span class="line">          hls_path /usr/local/var/www/hls;</span><br><span class="line">          hls_fragment 1s;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>② 在http中添加 hls的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">location /hls &#123;  </span><br><span class="line">       # Serve HLS fragments  </span><br><span class="line">       types &#123;  </span><br><span class="line">           application/vnd.apple.mpegurl m3u8;  </span><br><span class="line">           video/mp2t ts;  </span><br><span class="line">       &#125;  </span><br><span class="line">       root /usr/local/var/www;  </span><br><span class="line">       #add_header Cache-Controll no-cache;</span><br><span class="line">       expires -1;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>重启nginx服务</li>
</ol>
<p>重启nginx服务，浏览器中输入 <a href="http://localhost:8080" target="_blank" rel="external">http://localhost:8080</a>，是否出现欢迎界面确定nginx重启成功。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure></p>
<h2 id="六、直播流转换格式、编码推流"><a href="#六、直播流转换格式、编码推流" class="headerlink" title="六、直播流转换格式、编码推流"></a>六、直播流转换格式、编码推流</h2><p>当服务器端接收到采集视频录制端传输过来的视频流时，需要对其进行解析编码，推送RTMP/HLS格式视频流至视频播放端。通常使用的常见编码库方案，如<a href="https://github.com/kewlbear/x264-ios" target="_blank" rel="external">x264编码</a>、<a href="https://github.com/fflydev/faac-ios-build" target="_blank" rel="external">faac编码</a>、<a href="https://github.com/kewlbear/FFmpeg-iOS-build-script" target="_blank" rel="external">ffmpeg编码</a>等。</p>
<p>鉴于 FFmpeg 集合了多种音频、视频格式编码，我们可以优先选用FFmpeg进行转换格式、编码推流。</p>
<p>1.安装 FFmpeg 工具<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ffmpeg</span><br></pre></td></tr></table></figure></p>
<p>2.推流MP4文件</p>
<p>视频文件地址：/Users/gao/Desktop/video/test.mp4<br>推流拉流地址：rtmp://localhost:1935/rtmplive/home，rtmp://localhost:1935/rtmplive/home</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//RTMP 协议流</span><br><span class="line">ffmpeg -re -i /Users/gao/Desktop/video/test.mp4 -vcodec libx264 -acodec aac -f flv rtmp://10.14.221.17:1935/rtmplive/home</span><br><span class="line"></span><br><span class="line">//HLS 协议流</span><br><span class="line">ffmpeg -re -i /Users/gao/Desktop/video/test.mp4 -vcodec libx264 -vprofile baseline -acodec aac -ar 44100 -strict -2 -ac 1 -f flv  -q 10 rtmp://10.14.221.17:1935/hls/test</span><br></pre></td></tr></table></figure>
<p><code>注意</code>： 当我们进行推流之后，可以安装<a href="http://www.pc6.com/mac/112121.html" target="_blank" rel="external">VLC</a>、ffplay（支持rtmp协议的视频播放器）本地拉流进行演示</p>
<p>3.FFmpeg推流命令</p>
<p>① 视频文件进行直播</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -re -i /Users/gao/Desktop/video/test.mp4 -vcodec libx264 -vprofile baseline -acodec aac -ar 44100 -strict -2 -ac 1 -f flv  -q 10 rtmp://192.168.1.101:1935/hls/test</span><br><span class="line">ffmpeg -re -i /Users/gao/Desktop/video/test.mp4 -vcodec libx264 -vprofile baseline -acodec aac -ar 44100 -strict -2 -ac 1 -f flv  -q 10 rtmp://10.14.221.17:1935/hls/test</span><br></pre></td></tr></table></figure>
<p>② 推流摄像头＋桌面+麦克风录制进行直播</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -f avfoundation -framerate 30 -i &quot;1:0&quot; \-f avfoundation -framerate 30 -video_size 640x480 -i &quot;0&quot; \-c:v libx264 -preset ultrafast \-filter_complex &apos;overlay=main_w-overlay_w-10:main_h-overlay_h-10&apos; -acodec libmp3lame -ar 44100 -ac 1  -f flv rtmp://192.168.1.101:1935/hls/test</span><br></pre></td></tr></table></figure>
<p>更多命令，请参考：<br><a href="http://blog.csdn.net/leixiaohua1020/article/details/12029543" target="_blank" rel="external">FFmpeg处理RTMP流媒体的命令大全</a><br><a href="http://www.jianshu.com/p/d541b317f71c" target="_blank" rel="external"> FFmpeg常用推流命令</a></p>
<h2 id="七、H5-直播视频播放"><a href="#七、H5-直播视频播放" class="headerlink" title="七、H5 直播视频播放"></a>七、H5 直播视频播放</h2><p>移动端iOS和 Android 都天然支持HLS协议，做好视频采集端、视频流推流服务之后，便可以直接在H5页面配置 video 标签播放直播视频。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;video controls preload=&quot;auto&quot;  autoplay=&quot;autoplay&quot; loop=&quot;loop&quot; webkit-playsinline&gt;    </span><br><span class="line">    &lt;source src=&quot;http://10.14.221.8/hls/test.m3u8&quot; type=&quot;application/vnd.apple.mpegurl&quot; /&gt;  </span><br><span class="line">    &lt;p class=&quot;warning&quot;&gt;Your browser does not support HTML5 video.&lt;/p&gt;  </span><br><span class="line">&lt;/video&gt;</span><br></pre></td></tr></table></figure>
<p><code>ps</code>：① video标签添加<code>webkit-playsinline</code>属性（iOS支持）是保证视频在网页中内嵌播放。<br>② 针对微信浏览器，video标签层级最高的问题，需要申请添加白名单，请参照 <a href="http://bbs.mb.qq.com/thread-1242581-1-1.html?ptlang=2052。" target="_blank" rel="external">http://bbs.mb.qq.com/thread-1242581-1-1.html?ptlang=2052。</a></p>
<h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><p>本文从视频采集上传，服务器处理视频推流，以及H5页面播放直播视频一整套流程,具体阐述了直播实现原理，实现过程中会遇到很多性能优化问题。</p>
<p>① H5 HLS 限制必须是H264+AAC编码。</p>
<p>② H5 HLS 播放卡顿问题，server 端可以做好分片策略，将 ts 文件放在 CDN 上，前端可尽量做到 DNS 缓存等。</p>
<p>③ H5 直播为了达到更好的实时互动，也可以采用RTMP协议，通过<code>video.js</code>实现播放。</p>
<p>参考资料：</p>
<ul>
<li><a href="https://www.zhihu.com/question/42162310" target="_blank" rel="external">如何搭建一个完整的视频直播系统？</a></li>
<li><a href="https://imququ.com/post/html5-live-player-1.html" target="_blank" rel="external">HTML5 视频直播（一）</a></li>
<li><a href="https://imququ.com/post/html5-live-player-2.html" target="_blank" rel="external">HTML5 视频直播（二）</a></li>
<li><p><a href="https://imququ.com/post/html5-live-player-3.html" target="_blank" rel="external">HTML5 视频直播（三）</a></p>
</li>
<li><p><a href="http://www.haomou.net/2014/08/04/2014_Html5_canvas_video/" target="_blank" rel="external">WebRTC相关的canvas与video</a></p>
</li>
<li><p><a href="http://www.jianshu.com/p/f198d11577f4" target="_blank" rel="external">字体平滑➕视频转canvas</a></p>
</li>
<li><p><a href="http://www.alloyteam.com/2016/05/h5-camera-literacy/" target="_blank" rel="external">H5视频直播扫盲</a></p>
</li>
<li><a href="https://segmentfault.com/a/1190000000392586" target="_blank" rel="external">使用 WebSockets 进行 HTML5 视频直播</a></li>
<li><a href="https://www.zhihu.com/question/25497090" target="_blank" rel="external">可以用WebRTC来做视频直播吗？</a></li>
<li><a href="http://blog.ucloud.cn/archives/694" target="_blank" rel="external">关于直播，所有的技术细节都在这里了（一）</a></li>
<li><a href="http://blog.ucloud.cn/archives/699" target="_blank" rel="external">关于直播，所有的技术细节都在这里了（二）</a></li>
<li><p><a href="http://blog.ucloud.cn/archives/760" target="_blank" rel="external">关于直播，所有的技术细节都在这里了（三）</a></p>
</li>
<li><p><a href="http://www.jq-school.com/Show.aspx?id=738" target="_blank" rel="external">windows+nginx+ffmpeg实现移动端html5直播m3u8</a></p>
</li>
<li><a href="https://github.com/phoboslab/jsmpeg" target="_blank" rel="external">JS解码项目jsmpeg</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/H5/">H5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/H5-视频直播-video/">H5 视频直播 video</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HLS、RTMP协议/">HLS、RTMP协议</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-jdc线上部署问题解决方案" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/29/jdc线上部署问题解决方案/" class="article-date">
  	<time datetime="2016-08-29T11:17:43.000Z" itemprop="datePublished">2016-08-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/29/jdc线上部署问题解决方案/">模拟jdc部署环境，为node项目部署提供解决方案</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>有部署node项目操作过jdc服务器的童鞋们，可能都会遇到线上静态资源与本地静态资源不一致的问题，主要是由于我们部署的node项目的域名是二级目录，例jdc.jd.com/svg/，这样就导致相对路径指向jdc.jd.com，而不是目标jdc.jd.com/svg。</p>
<p>为了解决这个问题，我们通常是通过配置process.env.NODE_ENV的值，分开发环境dev，以及发布环境production，传入不同的指向路径，让静态资源路径与开发环境一致，但这一点还不够，切换到production改变静态资源路径，会导致本地无法正常预览，那么我们还需要配置nginx+node与线上保持一致的发布预览环境，从而达到发布及稳定，减少发布过程中浪费时间，难调试的问题。</p>
<p>以下是大概的解决方案，构建图：</p>
<p><img src="http://7xrig5.com1.z0.glb.clouddn.com/pic.jpg" alt="Alt text"></p>
<h3 id="mac下配置Nginx"><a href="#mac下配置Nginx" class="headerlink" title="mac下配置Nginx"></a>mac下配置Nginx</h3><p><a href="http://blog.pfan123.com/2016/06/12/Mac%20OS%E4%BD%BF%E7%94%A8brew%E5%AE%89%E8%A3%85Nginx%E3%80%81MySQL%E3%80%81PHP-FPM%E7%9A%84LAMP%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" target="_blank" rel="external">Mac使用brew安装Nginx、MySQL、PHP的LAMP开发环境</a></p>
<h3 id="Nginx配置文件详解"><a href="#Nginx配置文件详解" class="headerlink" title="Nginx配置文件详解"></a>Nginx配置文件详解</h3><p><a href="http://blog.pfan123.com/2016/08/28/Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E/" target="_blank" rel="external">Nginx配置文件详解</a></p>
<h3 id="Nginx反向代理处理静态页面"><a href="#Nginx反向代理处理静态页面" class="headerlink" title="Nginx反向代理处理静态页面"></a>Nginx反向代理处理静态页面</h3><p><a href="http://blog.pfan123.com/2016/06/12/nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2/" target="_blank" rel="external">nginx反向代理处理静态页面</a></p>
<h3 id="Nginx-Node常见问题"><a href="#Nginx-Node常见问题" class="headerlink" title="Nginx+Node常见问题"></a>Nginx+Node常见问题</h3><p>1.Mac 启动 nginx 失败，提示地址已被占用 （48: Address already in use）</p>
<p>启动Nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx</span><br></pre></td></tr></table></figure></p>
<p>报错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nginx: [emerg] bind() to 0.0.0.0:80 failed (48: Address already in use)</span><br><span class="line">nginx: [emerg] bind() to 0.0.0.0:80 failed (48: Address already in use)</span><br><span class="line">nginx: [emerg] bind() to 0.0.0.0:80 failed (48: Address already in use)</span><br><span class="line">nginx: [emerg] bind() to 0.0.0.0:80 failed (48: Address already in use)</span><br><span class="line">nginx: [emerg] bind() to 0.0.0.0:80 failed (48: Address already in use)</span><br><span class="line">nginx: [emerg] still could not bind()</span><br></pre></td></tr></table></figure></p>
<p>对Nginx玩的比较少的人，可能会认为，这是一个错误，但其实是<em>本机Nginx自启，一直再启动，没法重启，可以先<code>nginx -s stop</code>或<code>nginx -s reload</code></em>重启。</p>
<p>nginx常用命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx #打开 nginx</span><br><span class="line">nginx -s reload|reopen|stop|quit  #重新加载配置|重启|停止|退出 nginx</span><br><span class="line">nginx -t   #测试配置是否有语法错误</span><br></pre></td></tr></table></figure></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx-负载均衡-node-jdc-解决方案-host/">Nginx  负载均衡 node  jdc 解决方案 host</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/技术杂谈/">技术杂谈</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-Nginx配置文件详细说明" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/28/Nginx配置文件详细说明/" class="article-date">
  	<time datetime="2016-08-28T11:17:43.000Z" itemprop="datePublished">2016-08-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/28/Nginx配置文件详细说明/">Nginx配置文件详解</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Nginx服务器nginx.conf的配置文件说明, 部分注释收集与网络。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">#运行用户</span><br><span class="line">user www-data;    </span><br><span class="line">#启动进程,通常设置成和cpu的数量相等</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#全局错误日志及PID文件</span><br><span class="line">error_log  /var/log/nginx/error.log;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line">#工作模式及连接数上限</span><br><span class="line">events &#123;</span><br><span class="line">    use   epoll;             #epoll是多路复用IO(I/O Multiplexing)中的一种方式,但是仅用于linux2.6以上内核,可以大大提高nginx的性能</span><br><span class="line">    worker_connections  1024;#单个后台worker process进程的最大并发链接数</span><br><span class="line">    # multi_accept on; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#设定http服务器，利用它的反向代理功能提供负载均衡支持</span><br><span class="line">http &#123;</span><br><span class="line">     #设定mime类型,类型由mime.type文件定义</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    #设定日志格式</span><br><span class="line">    access_log    /var/log/nginx/access.log;</span><br><span class="line"></span><br><span class="line">    #sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，</span><br><span class="line">    #必须设为 on,如果用来进行下载等应用磁盘IO重负载应用，可设置为 off，以平衡磁盘与网络I/O处理速度，降低系统的uptime.</span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #连接超时时间</span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    tcp_nodelay        on;</span><br><span class="line">    </span><br><span class="line">    #开启gzip压缩</span><br><span class="line">    gzip  on;</span><br><span class="line">    gzip_disable &quot;MSIE [1-6]\.(?!.*SV1)&quot;;</span><br><span class="line"></span><br><span class="line">    #设定请求缓冲</span><br><span class="line">    client_header_buffer_size    1k;</span><br><span class="line">    large_client_header_buffers  4 4k;</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">    include /etc/nginx/sites-enabled/*;</span><br><span class="line"></span><br><span class="line">    #设定负载均衡的服务器列表</span><br><span class="line">     upstream mysvr &#123;</span><br><span class="line">    #weigth参数表示权值，权值越高被分配到的几率越大</span><br><span class="line">    #本机上的Squid开启3128端口</span><br><span class="line">    server 192.168.8.1:3128 weight=5;</span><br><span class="line">    server 192.168.8.2:80  weight=1;</span><br><span class="line">    server 192.168.8.3:80  weight=6;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   server &#123;</span><br><span class="line">    #侦听80端口</span><br><span class="line">        listen       80;</span><br><span class="line">        #定义使用www.xx.com访问</span><br><span class="line">        server_name  www.xx.com;</span><br><span class="line"></span><br><span class="line">        #设定本虚拟主机的访问日志</span><br><span class="line">        access_log  logs/www.xx.com.access.log  main;</span><br><span class="line"></span><br><span class="line">    #默认请求</span><br><span class="line">    location / &#123;</span><br><span class="line">          root   /root;      #定义服务器的默认网站根目录位置</span><br><span class="line">          index index.php index.html index.htm;   #定义首页索引文件的名称</span><br><span class="line"></span><br><span class="line">          fastcgi_pass  www.xx.com;</span><br><span class="line">         fastcgi_param  SCRIPT_FILENAME  $document_root/$fastcgi_script_name; </span><br><span class="line">          include /etc/nginx/fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    # 定义错误提示页面</span><br><span class="line">    error_page   500 502 503 504 /50x.html;  </span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        root   /root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #静态文件，nginx自己处理</span><br><span class="line">    location ~ ^/(images|javascript|js|css|flash|media|static)/ &#123;</span><br><span class="line">        root /var/www/virtual/htdocs;</span><br><span class="line">        #过期30天，静态文件不怎么更新，过期可以设大一点，如果频繁更新，则可以设置得小一点。</span><br><span class="line">        expires 30d;</span><br><span class="line">    &#125;</span><br><span class="line">    #PHP 脚本请求全部转发到 FastCGI处理. 使用FastCGI默认配置.</span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        root /root;</span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME /home/www/www$fastcgi_script_name;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">    #设定查看Nginx状态的地址</span><br><span class="line">    location /NginxStatus &#123;</span><br><span class="line">        stub_status            on;</span><br><span class="line">        access_log              on;</span><br><span class="line">        auth_basic              &quot;NginxStatus&quot;;</span><br><span class="line">        auth_basic_user_file  conf/htpasswd;</span><br><span class="line">    &#125;</span><br><span class="line">    #禁止访问 .htxxx 文件</span><br><span class="line">    location ~ /\.ht &#123;</span><br><span class="line">        deny all;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上是一些基本的配置,使用Nginx最大的好处就是负载均衡</p>
<p>如果要使用负载均衡的话,可以修改配置http节点如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">#设定http服务器，利用它的反向代理功能提供负载均衡支持</span><br><span class="line">http &#123;</span><br><span class="line">     #设定mime类型,类型由mime.type文件定义</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    #设定日志格式</span><br><span class="line">    access_log    /var/log/nginx/access.log;</span><br><span class="line"></span><br><span class="line">    #省略上文有的一些配置节点</span><br><span class="line"></span><br><span class="line">    #。。。。。。。。。。</span><br><span class="line"></span><br><span class="line">    #设定负载均衡的服务器列表</span><br><span class="line">     upstream mysvr &#123;</span><br><span class="line">    #weigth参数表示权值，权值越高被分配到的几率越大</span><br><span class="line">    server 192.168.8.1x:3128 weight=5;#本机上的Squid开启3128端口</span><br><span class="line">    server 192.168.8.2x:80  weight=1;</span><br><span class="line">    server 192.168.8.3x:80  weight=6;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   upstream mysvr2 &#123;</span><br><span class="line">    #weigth参数表示权值，权值越高被分配到的几率越大</span><br><span class="line"></span><br><span class="line">    server 192.168.8.x:80  weight=1;</span><br><span class="line">    server 192.168.8.x:80  weight=6;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   #第一个虚拟服务器</span><br><span class="line">   server &#123;</span><br><span class="line">    #侦听192.168.8.x的80端口</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  192.168.8.x;</span><br><span class="line"></span><br><span class="line">      #对aspx后缀的进行负载均衡请求</span><br><span class="line">    location ~ .*\.aspx$ &#123;</span><br><span class="line"></span><br><span class="line">         root   /root;      #定义服务器的默认网站根目录位置</span><br><span class="line">          index index.php index.html index.htm;   #定义首页索引文件的名称</span><br><span class="line"></span><br><span class="line">          proxy_pass  http://mysvr ;#请求转向mysvr 定义的服务器列表</span><br><span class="line"></span><br><span class="line">          #以下是一些反向代理的配置可删除.</span><br><span class="line"></span><br><span class="line">          proxy_redirect off;</span><br><span class="line"></span><br><span class="line">          #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span><br><span class="line">          proxy_set_header Host $host;</span><br><span class="line">          proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">          client_max_body_size 10m;    #允许客户端请求的最大单文件字节数</span><br><span class="line">          client_body_buffer_size 128k;  #缓冲区代理缓冲用户端请求的最大字节数，</span><br><span class="line">          proxy_connect_timeout 90;  #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">          proxy_send_timeout 90;        #后端服务器数据回传时间(代理发送超时)</span><br><span class="line">          proxy_read_timeout 90;         #连接成功后，后端服务器响应时间(代理接收超时)</span><br><span class="line">          proxy_buffer_size 4k;             #设置代理服务器（nginx）保存用户头信息的缓冲区大小</span><br><span class="line">          proxy_buffers 4 32k;               #proxy_buffers缓冲区，网页平均在32k以下的话，这样设置</span><br><span class="line">          proxy_busy_buffers_size 64k;    #高负荷下缓冲大小（proxy_buffers*2）</span><br><span class="line">          proxy_temp_file_write_size 64k;  #设定缓存文件夹大小，大于这个值，将从upstream服务器传</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考资料：</p>
<ul>
<li><p><a href="http://0.0.0.0:4000/2016/06/12/nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2/" target="_blank" rel="external">nginx反向代理处理静态页面</a></p>
</li>
<li><p><a href="http://0.0.0.0:4000/2016/06/12/Mac%20OS%E4%BD%BF%E7%94%A8brew%E5%AE%89%E8%A3%85Nginx%E3%80%81MySQL%E3%80%81PHP-FPM%E7%9A%84LAMP%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" target="_blank" rel="external">Mac使用brew安装Nginx、MySQL、PHP的LAMP开发环境</a></p>
</li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx-负载均衡/">Nginx  负载均衡</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/技术杂谈/">技术杂谈</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-Mongoose 参考手册" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/01/Mongoose 参考手册/" class="article-date">
  	<time datetime="2016-08-01T11:17:43.000Z" itemprop="datePublished">2016-08-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/01/Mongoose 参考手册/">Mongoose 参考手册 -- 转载</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Mongoose-是什么"><a href="#Mongoose-是什么" class="headerlink" title="Mongoose 是什么?"></a>Mongoose 是什么?</h2><p>一般我们不直接用MongoDB的函数来操作MongoDB数据库 Mongose就是一套操作MongoDB数据库的接口.</p>
<h4 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h4><p>一种以文件形式存储的数据库模型骨架，无法直接通往数据库端，也就是说它不具备对数据库的操作能力.可以说是数据属性模型(传统意义的表结构)，又或着是“集合”的模型骨架</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/* 定义一个 Schema */</span><br><span class="line">var mongoose = require(&quot;mongoose&quot;);</span><br><span class="line"></span><br><span class="line">var TestSchema = new mongoose.Schema(&#123;</span><br><span class="line">    name : &#123; type:String &#125;,//属性name,类型为String</span><br><span class="line">    age  : &#123; type:Number, default:0 &#125;,//属性age,类型为Number,默认为0</span><br><span class="line">    time : &#123; type:Date, default:Date.now &#125;,</span><br><span class="line">    email: &#123; type:String,default:&apos;&apos;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面这个 TestSchema包含4个属性 [name, age, time, email]</p>
<h4 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h4><p>由Schema构造生成的模型，除了Schema定义的数据库骨架以外，还具有数据库操作的行为，类似于管理数据库属性、行为的类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var db = mongoose.connect(&quot;mongodb://127.0.0.1:27017/test&quot;);</span><br><span class="line"></span><br><span class="line">// 创建Model</span><br><span class="line">var TestModel = db.model(&quot;test1&quot;, TestSchema);</span><br></pre></td></tr></table></figure>
<p>test1 数据库中的集合名称, 不存在会创建.</p>
<h4 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h4><p>由Model创建的实体，使用save方法保存数据，Model和Entity都有能影响数据库的操作，但Model比Entity更具操作性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var TestEntity = new TestModel(&#123;</span><br><span class="line">       name : &quot;Lenka&quot;,</span><br><span class="line">       age  : 36,</span><br><span class="line">       email: &quot;lenka@qq.com&quot;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(TestEntity.name); // Lenka</span><br><span class="line">console.log(TestEntity.age); // 36</span><br></pre></td></tr></table></figure>
<h4 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h4><p>MongoDB 使用游标返回find的执行结果.客户端对游标的实现通常能够对最终结果进行有效的控制。可以限制结果的数量，略过部分结果，根据任意键按任意顺序的组合对结果进行各种排序，或者是执行其他一些强的操作。</p>
<h4 id="ObjectId"><a href="#ObjectId" class="headerlink" title="ObjectId"></a>ObjectId</h4><p>存储在mongodb集合中的每个文档（document）都有一个默认的主键_id，这个主键名称是固定的，它可以是mongodb支持的任何数据类型，默认是ObjectId。</p>
<p>ObjectId是一个12字节的 BSON 类型字符串。按照字节顺序，依次代表：<br>4字节：UNIX时间戳<br>3字节：表示运行MongoDB的机器<br>2字节：表示生成此_id的进程<br>3字节：由一个随机数开始的计数器生成的值</p>
<h4 id="Node-js-中"><a href="#Node-js-中" class="headerlink" title="Node.js 中"></a>Node.js 中</h4><p>package.json 中加入”mongoose”: “*” 字段<br>npm install 安装依赖.</p>
<p>var mongoose = require(“mongoose”);<br>var db = mongoose.connect(“mongodb://localhost:27017/test”);<br>然后引用</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>var mongoose = require(“mongoose”);<br>var db = mongoose.connect(“mongodb://localhost:27017/test”);</p>
<h4 id="db-数据库操作"><a href="#db-数据库操作" class="headerlink" title="db - 数据库操作"></a>db - 数据库操作</h4><p>1.挂接数据库连接事件,参数1: 也可以是error.</p>
<p> db.connection.on(‘open’, callback);</p>
<h2 id="Schema-表结构"><a href="#Schema-表结构" class="headerlink" title="Schema - 表结构"></a>Schema - 表结构</h2><p>1.构造函数</p>
<blockquote>
<p>new mongoose.Schema( { name:{type:String}, age:{type:Number, default:10}  } )</p>
</blockquote>
<p>2.添加属性</p>
<blockquote>
<p>Schema.add( { name: ‘String’, email: ‘String’, age: ‘Number’ } )</p>
</blockquote>
<p>3.有时候Schema不仅要为后面的Model和Entity提供公共的属性，还要提供公共的方法</p>
<blockquote>
<p>Schema.method( ‘say’, function(){console.log(‘hello’);} )<br>//这样Model和Entity的实例就能使用这个方法了</p>
</blockquote>
<p>4.添加静态方法</p>
<blockquote>
<p>Schema.static( ‘say’, function(){console.log(‘hello’);} )<br>//静态方法，只限于在Model层就能使用</p>
</blockquote>
<p>5.追加方法</p>
<blockquote>
<p>Schema.methods.say = function(){console.log(‘hello’);};<br>//静态方法，只限于在Model层就能使用</p>
</blockquote>
<h2 id="model-文档操作"><a href="#model-文档操作" class="headerlink" title="model - 文档操作"></a>model - 文档操作</h2><p>1.构造函数, 参数1:集合名称, 参数2:Schema实例</p>
<blockquote>
<p> db.model(“test1”, TestSchema );</p>
</blockquote>
<p>2.查询, 参数1忽略,或为空对象则返回所有集合文档</p>
<blockquote>
<p> model.find({}, callback);</p>
<p> model.find({},field,callback);<br>过滤查询,参数2: {‘name’:1, ‘age’:0} 查询文档的返回结果包含name , 不包含age.(_id默认是1)</p>
<p>model.find({},null,{limit:20});<br>过滤查询,参数3: 游标操作 limit限制返回结果数量为20个,如不足20个则返回所有.</p>
<p>model.findOne({}, callback);<br>查询找到的第一个文档</p>
<p>model.findById(‘obj._id’, callback);<br>查询找到的第一个文档,同上. 但是只接受 __id 的值查询</p>
</blockquote>
<p>3.创建, 在集合中创建一个文档</p>
<blockquote>
<p>Model.create(文档数据, callback))</p>
</blockquote>
<p>4.更新,参数1:查询条件, 参数2:更新对象,可以使用MondoDB的更新修改器</p>
<blockquote>
<p>Model.update(conditions, update, function(error)</p>
</blockquote>
<p>5.删除, 参数1:查询条件</p>
<blockquote>
<p>Model.remove(conditions,callback);</p>
</blockquote>
<h4 id="Entity-文档操作"><a href="#Entity-文档操作" class="headerlink" title="Entity - 文档操作"></a>Entity - 文档操作</h4><p>1.构造函数, 其实就是model的实例</p>
<blockquote>
<p>new TestModel( { name:‘xueyou’, age:21 } );</p>
</blockquote>
<p>2.创建, 在集合中创建一个文档.</p>
<blockquote>
<p>Entity.save(callback);</p>
</blockquote>
<h2 id="修改器和更新器"><a href="#修改器和更新器" class="headerlink" title="修改器和更新器"></a>修改器和更新器</h2><h4 id="更新修改器"><a href="#更新修改器" class="headerlink" title="更新修改器:"></a>更新修改器:</h4><p>‘$inc’ 增减修改器,只对数字有效.下面的实例: 找到 age=22的文档,修改文档的age值自增1</p>
<blockquote>
<p>Model.update({‘age’:22}, {’$inc’:{‘age’:1} }  );<br>执行后: age=23</p>
</blockquote>
<p>‘$set’ 指定一个键的值,这个键不存在就创建它.可以是任何MondoDB支持的类型.</p>
<blockquote>
<p>Model.update({‘age’:22}, {’$set’:{‘age’:‘haha’} }  );<br>执行后: age=‘haha’</p>
</blockquote>
<p>‘$unset’ 同上取反,删除一个键</p>
<blockquote>
<p>Model.update({‘age’:22}, {’$unset’:{‘age’:‘haha’} }  );<br>执行后: age键不存在</p>
</blockquote>
<h4 id="数组修改器"><a href="#数组修改器" class="headerlink" title="数组修改器:"></a>数组修改器:</h4><p>‘$push’ 给一个键push一个数组成员,键不存在会创建</p>
<blockquote>
<p> Model.update({‘age’:22}, {’$push’:{‘array’:10} }  );<br>执行后: 增加一个 array 键,类型为数组, 有一个成员 10</p>
</blockquote>
<p>‘$addToSet’ 向数组中添加一个元素,如果存在就不添加</p>
<blockquote>
<p> Model.update({‘age’:22}, {’$addToSet’:{‘array’:10} }  );<br>执行后: array中有10所以不会添加</p>
</blockquote>
<p>‘$each’ 遍历数组, 和 $push 修改器配合可以插入多个值</p>
<blockquote>
<p> Model.update({‘age’:22}, {’$push’:{‘array’:{’$each’: [1,2,3,4,5]}} }  );<br>执行后: array : [10,1,2,3,4,5]</p>
</blockquote>
<p>‘$pop’ 向数组中尾部删除一个元素</p>
<blockquote>
<p> Model.update({‘age’:22}, {’$pop’:{‘array’:1} }  );<br>执行后: array : [10,1,2,3,4]  tips: 将1改成-1可以删除数组首部元素</p>
</blockquote>
<p>‘$pull’ 向数组中删除指定元素</p>
<blockquote>
<p> Model.update({‘age’:22}, {’$pull’:{‘array’:10} }  );<br>执行后: array : [1,2,3,4]  匹配到array中的10后将其删除</p>
</blockquote>
<h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询:"></a>条件查询:</h4><ul>
<li>“$lt”    小于</li>
<li>“$lte”    小于等于</li>
<li>“$gt”    大于</li>
<li>“$gte”    大于等于</li>
<li>“$ne”    不等于</li>
</ul>
<blockquote>
<p>Model.find({“age”:{ “$get”:18 , “$lte”:30 } } );<br>查询 age 大于等于18并小于等于30的文档</p>
</blockquote>
<h4 id="或查询-OR"><a href="#或查询-OR" class="headerlink" title="或查询 OR:"></a>或查询 OR:</h4><ul>
<li>‘$in’ 一个键对应多个值</li>
<li>‘$nin’ 同上取反, 一个键不对应指定值</li>
<li>“$or” 多个条件匹配, 可以嵌套 $in 使用</li>
<li><p>“$not”    同上取反, 查询与特定模式不匹配的文档</p>
<blockquote>
<p> Model.find({“age”:{ “$in”:[20,21,22.‘haha’]} } );<br>查询 age等于20或21或21或’haha’的文档</p>
<p>Model.find({“$or” :  [ {‘age’:18} , {‘name’:‘xueyou’} ] });<br>查询 age等于18 或 name等于’xueyou’ 的文档</p>
</blockquote>
</li>
</ul>
<h4 id="类型查询"><a href="#类型查询" class="headerlink" title="类型查询:"></a>类型查询:</h4><p>null 能匹配自身和不存在的值, 想要匹配键的值 为null, 就要通过  “$exists” 条件判定键值已经存在<br>“$exists” (表示是否存在的意思)</p>
<blockquote>
<p> Model.find(“age” :  { “$in” : [null] , “exists” : true  } );<br>查询 age值为null的文档</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;name: &#123;$exists: true&#125;&#125;,function(error,docs)&#123;</span><br><span class="line">  //查询所有存在name属性的文档</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Model.find(&#123;telephone: &#123;$exists: false&#125;&#125;,function(error,docs)&#123;</span><br><span class="line">  //查询所有不存在telephone属性的文档</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式:"></a>正则表达式:</h4><p>MongoDb 使用 Prel兼容的正则表达式库来匹配正则表达式</p>
<blockquote>
<p> find( {“name” : /joe/i } )<br>查询name为 joe 的文档, 并忽略大小写</p>
<p> find( {“name” : /joe?/i } )<br>查询匹配各种大小写组合</p>
</blockquote>
<h4 id="查询数组"><a href="#查询数组" class="headerlink" title="查询数组:"></a>查询数组:</h4><blockquote>
<p>  Model.find({“array”:10} );<br>查询 array(数组类型)键中有10的文档,  array : [1,2,3,4,5,10]  会匹配到</p>
<p>  Model.find({“array[5]”:10} );<br>查询 array(数组类型)键中下标5对应的值是10,  array : [1,2,3,4,5,10]  会匹配到</p>
</blockquote>
<p>‘$all’ 匹配数组中多个元素</p>
<blockquote>
<p>  Model.find({“array”:[5,10]} );<br>查询 匹配array数组中 既有5又有10的文档</p>
</blockquote>
<p>‘$size’ 匹配数组长度</p>
<blockquote>
<p>  Model.find({“array”:{“$size” : 3} } );<br>查询 匹配array数组长度为3 的文档</p>
</blockquote>
<p>‘$slice’ 查询子集合返回</p>
<blockquote>
<p>  Model.find({“array”:{“$skice” : 10} } );<br>查询 匹配array数组的前10个元素</p>
<p>  Model.find({“array”:{“$skice” : [5,10] } } );<br>查询 匹配array数组的第5个到第10个元素</p>
</blockquote>
<h4 id="where"><a href="#where" class="headerlink" title="where"></a>where</h4><p>用它可以执行任意javacript语句作为查询的一部分,如果回调函数返回 true 文档就作为结果的一部分返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">	find( &#123;&quot;$where&quot; : function()&#123;</span><br><span class="line">		for( var x in this )&#123;</span><br><span class="line">		 //这个函数中的 this 就是文档</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if(this.x !== null &amp;&amp; this.y !== null)&#123;</span><br><span class="line">		    return this.x + this.y === 10 ? true : false;</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">		    return true;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">&#125;  &#125;  )</span><br></pre></td></tr></table></figure>
<p>简化版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find( &#123;&quot;$where&quot; :  &quot;this.x + this.y === 10&quot; &#125; )</span><br><span class="line">find( &#123;&quot;$where&quot; : &quot; function()&#123; return this.x + this.y ===10; &#125; &quot; &#125; )</span><br></pre></td></tr></table></figure>
<h4 id="游标-1"><a href="#游标-1" class="headerlink" title="游标:"></a>游标:</h4><ul>
<li>limit(3)    限制返回结果的数量,</li>
<li>skip(3)    跳过前3个文档,返回其余的</li>
<li>sort( {“username”:1 , “age”:-1 } )    排序 键对应文档的键名, 值代表排序方向, 1 升序, -1降序</li>
</ul>
<p>参考资料：</p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_62fda93c0101gw1g.html" target="_blank" rel="external">MongoDB 查询文档</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_62fda93c0101gw1g.html" target="_blank" rel="external">mongoose 学习</a></li>
<li><a href="http://blog.csdn.net/zk437092645/article/details/9345885" target="_blank" rel="external">mongoose对查询结果进行排序</a></li>
<li><a href="http://www.cnblogs.com/stephen-liu74/archive/2012/08/03/2553803.html" target="_blank" rel="external">MongoDB学习笔记(查询)</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mongoose参考手册-MongoDB-数据库-node/">Mongoose参考手册  MongoDB  数据库 node</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/技术杂谈/">技术杂谈</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-Docker-从入门到实践" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/25/Docker-从入门到实践/" class="article-date">
  	<time datetime="2016-07-25T11:17:43.000Z" itemprop="datePublished">2016-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/25/Docker-从入门到实践/">Docker — 从入门到实践</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>买车文章大纲：</p>
<p>准备资料：</p>
<ul>
<li><a href="https://docs.docker.com/" target="_blank" rel="external">docker官方文档</a></li>
<li><a href="https://yeasy.gitbooks.io/docker_practice/content/" target="_blank" rel="external">Docker —— 从入门到实践</a></li>
<li><a href="http://www.runoob.com/docker/docker-tutorial.html" target="_blank" rel="external">Docker 教程</a></li>
<li><a href="http://www.docker.org.cn/book/docker/what-is-docker-16.html" target="_blank" rel="external">docker中文</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/">Docker</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/技术杂谈/">技术杂谈</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-gitignore 文件使用说明" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/25/gitignore 文件使用说明/" class="article-date">
  	<time datetime="2016-07-25T11:17:43.000Z" itemprop="datePublished">2016-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/25/gitignore 文件使用说明/">.gitignore 文件使用说明</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我们在使用 Git 进行版本控制的时候，有些文件是无需纳入 Git 管理的，通常都是些自动生成的文件，像日志或者编译过程中创建的文件。我们可以创建一个名为 .gitignore的文件，列出要忽略的文件来解决这个问题。</p>
<p>来看一个简单的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># cat .gitignore</span><br><span class="line">*.[oa]</span><br><span class="line">*~</span><br></pre></td></tr></table></figure>
<p>第一行告诉 Git 忽略所有以 .o 或 .a结尾的文件。一般这类对象文件和存档文件都是编译过程中出现的，我们用不着跟踪它们的版本。<br>第二行告诉 Git 忽略所有以波浪符（~）结尾的文件，许多文本编辑软件（比如 Emacs）都用这样的文件名保存副本。此外，你可能还需要忽略 log，tmp 或者 pid 目录，以及自动生成的文档等等。要养成一开始就设置好 .gitignore 文件的习惯，以免将来误提交这类无用的文件。</p>
<p>文件 .gitignore 的格式规范如下：<br>所有空行或者以注释符号 ＃ 开头的行都会被 Git 忽略。<br>可以使用标准的 glob 模式匹配。<br>匹配模式最后跟反斜杠（/）说明要忽略的是目录。<br>要忽略指定模式以外的文件或目录，可以在模式前加上惊叹号（!）取反。</p>
<p>所谓的 glob 模式是指 shell 所使用的简化了的正则表达式。<br>星号（*）匹配零个或多个任意字符；<br>[abc] 匹配任何一个列在方括号中的字符（这个例子要么匹配一个 a，要么匹配一个 b，要么匹配一个 c）；<br>问号（?）只匹配一个任意字符；<br>如果在方括号中使用短划线分隔两个字符，表示所有在这两个字符范围内的都可以匹配（比如 [0-9] 表示匹配所有 0 到 9 的数字）。</p>
<p>我们再看一个 .gitignore 文件的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 忽略所有 .a 结尾的文件</span><br><span class="line">*.a</span><br><span class="line"></span><br><span class="line"># 但 lib.a 除外</span><br><span class="line">!lib.a</span><br><span class="line"></span><br><span class="line"># 仅仅忽略项目根目录下的 TODO 文件，不包括 subdir/TODO</span><br><span class="line">/TODO</span><br><span class="line"></span><br><span class="line"># 忽略 build/ 目录下的所有文件</span><br><span class="line">build/</span><br><span class="line"></span><br><span class="line"># 会忽略 doc/notes.txt 但不包括 doc/server/notes.txt</span><br><span class="line">doc/notes.txt</span><br></pre></td></tr></table></figure>
<p>其他信息可以直接 man gitignore 查看。</p>
<p>此外推荐一个自动生成 .gitignore 文件的网址：<a href="http://www.gitignore.io/" target="_blank" rel="external">http://www.gitignore.io/</a></p>
<p>对于iOS开发者，推荐一个 gist ：<a href="https://gist.github.com/mmorey/6931793" target="_blank" rel="external">https://gist.github.com/mmorey/6931793</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gitignore-git/">.gitignore git</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/技术杂谈/">技术杂谈</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-买房前必备知识" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/24/买房前必备知识/" class="article-date">
  	<time datetime="2016-07-24T11:17:43.000Z" itemprop="datePublished">2016-07-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/24/买房前必备知识/">买房前必备知识</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>买车文章大纲：</p>
<p>准备资料：</p>
<ul>
<li><a href="https://www.zhihu.com/question/28086367" target="_blank" rel="external">买房前要学习哪些知识（常识），有哪些获取的途径推荐？</a></li>
<li><a href="https://www.zhihu.com/question/20216680" target="_blank" rel="external">普通人购房前需要了解的知识有哪些？</a></li>
<li><a href="https://www.zhihu.com/question/21879342" target="_blank" rel="external">对于买房，有哪些理财的知识和好的方法？</a></li>
<li><a href="https://www.zhihu.com/question/24464072" target="_blank" rel="external">买房看房时需要注意哪些？</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/买房前必备知识-house-home/">买房前必备知识  house home</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/兴趣爱好/">兴趣爱好</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 pfan
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a>
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>