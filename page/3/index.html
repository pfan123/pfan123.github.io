<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>pfan博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="pfan博客 新起点，新高度">
<meta property="og:type" content="website">
<meta property="og:title" content="pfan博客">
<meta property="og:url" content="http://pfan123.github.io/page/3/index.html">
<meta property="og:site_name" content="pfan博客">
<meta property="og:description" content="pfan博客 新起点，新高度">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="pfan博客">
<meta name="twitter:description" content="pfan博客 新起点，新高度">
  
    <link rel="alternative" href="/atom.xml" title="pfan博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://litten.github.io/assets/blogImg/litten.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">pfan</a></h1>
		</hgroup>

		
		<p class="header-subtitle">新起点，新高度</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>		
					
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>

			</div>
		


		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
				        	<li class = "article_cate_tit"> 文章分类</li>
				        	<li class = "article_cate_a"> <a  href = "/categories/技术杂谈/">技术杂谈</a>	</li>
				        	<li class = "article_cate_a"> <a href = "/categories/兴趣爱好/">兴趣爱好</a>		</li>
				        	<li class = "article_cate_a"> <a href = "/categories/日志/">日志</a></li>
				        	<li class = "article_cate_a"> <a href = "/categories/JavaScript/">JavaScript</a>	</li>
				        	<li class = "article_cate_a"> <a  href = "/categories/CSS3/">CSS3</a>	</li>
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/pfan123" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/gaolu1990/home?wvr=5" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>



				<style type="text/css">
					.article_cate_tit{
						color:#ba8f6c;
						margin-top:6px;
					}
					.article_cate_con a{
						display:block;
						font-size:12px;
						text-align:center;
						margin:4px 0;
					}
					#header .header-menu{
						line-height:21px;
					}
					.article_cate_a{
						line-height:18px !important;
					}	
					.article_cate_a a{
						font-size:12px !important;
					}				
					#container .left-col .overlay{
						height:130px;
					}
					.header-nav{
						top:160px;
					}
				</style>	
				<!-- E 新增模块-->
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/gitignore-git/" style="font-size: 10px;">.gitignore git</a> <a href="/tags/htaccess-配置二级域名-绑定子目录/" style="font-size: 10px;">.htaccess  配置二级域名  绑定子目录</a> <a href="/tags/AMD/" style="font-size: 10px;">AMD</a> <a href="/tags/CMD/" style="font-size: 10px;">CMD</a> <a href="/tags/CSS-BEM-OOCSS/" style="font-size: 10px;">CSS BEM OOCSS</a> <a href="/tags/CSS动画篇/" style="font-size: 10px;">CSS动画篇</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/ESLint/" style="font-size: 10px;">ESLint</a> <a href="/tags/Git，Git查看历史记录/" style="font-size: 10px;">Git，Git查看历史记录</a> <a href="/tags/H5/" style="font-size: 10px;">H5</a> <a href="/tags/H5-视频直播-video/" style="font-size: 10px;">H5 视频直播 video</a> <a href="/tags/H5全景、CSS3d、perspective/" style="font-size: 20px;">H5全景、CSS3d、perspective</a> <a href="/tags/HLS、RTMP协议/" style="font-size: 10px;">HLS、RTMP协议</a> <a href="/tags/HTML5/" style="font-size: 20px;">HTML5</a> <a href="/tags/HTML5-视频直播-video-canvas/" style="font-size: 10px;">HTML5 视频直播 video canvas</a> <a href="/tags/HTML5、localstorage、sessionStorage/" style="font-size: 10px;">HTML5、localstorage、sessionStorage</a> <a href="/tags/HTML、XML解析、dom-level、htmlparser2、xmldom、sax-js、cheerio/" style="font-size: 10px;">HTML、XML解析、dom level、htmlparser2、xmldom、sax-js、cheerio</a> <a href="/tags/HTTP、-node-http-proxy、-nginx、-proxy/" style="font-size: 20px;">HTTP、 node-http-proxy、 nginx、 proxy</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Mac-命令-Terminal-osx/" style="font-size: 10px;">Mac 命令 Terminal osx</a> <a href="/tags/Mac、root/" style="font-size: 10px;">Mac、root</a> <a href="/tags/Math-atan-、Math-atan2-斜率/" style="font-size: 10px;">Math.atan()、Math.atan2() 斜率</a> <a href="/tags/Mongoose参考手册-MongoDB-数据库-node/" style="font-size: 10px;">Mongoose参考手册  MongoDB  数据库 node</a> <a href="/tags/Nginx-负载均衡/" style="font-size: 10px;">Nginx  负载均衡</a> <a href="/tags/Nginx-负载均衡-node-jdc-解决方案-host/" style="font-size: 10px;">Nginx  负载均衡 node  jdc 解决方案 host</a> <a href="/tags/Nginx-Mac-Node/" style="font-size: 10px;">Nginx Mac Node</a> <a href="/tags/Nginx-MySQL-PHP-FPM-Mac-OS/" style="font-size: 10px;">Nginx MySQL PHP-FPM Mac OS</a> <a href="/tags/Nodejs学习实践-nodejs-ES6/" style="font-size: 10px;">Nodejs学习实践 nodejs  ES6</a> <a href="/tags/PreloadJS-EaselJS-TweenJS-SoundJS/" style="font-size: 10px;">PreloadJS EaselJS TweenJS SoundJS</a> <a href="/tags/SVG-Sprites-Symbols/" style="font-size: 10px;">SVG Sprites Symbols</a> <a href="/tags/SVG-icon、-导出优化/" style="font-size: 10px;">SVG icon、 导出优化</a> <a href="/tags/UMD/" style="font-size: 10px;">UMD</a> <a href="/tags/Vim-vi/" style="font-size: 10px;">Vim vi</a> <a href="/tags/createJS/" style="font-size: 10px;">createJS</a> <a href="/tags/css-modules-scope-模块化/" style="font-size: 10px;">css modules  scope  模块化</a> <a href="/tags/deviceorientation、orientationchange-重力感应/" style="font-size: 10px;">deviceorientation、orientationchange 重力感应</a> <a href="/tags/deviceorientation、orientationchange-重力感应-CSS3D/" style="font-size: 10px;">deviceorientation、orientationchange 重力感应 CSS3D</a> <a href="/tags/express/" style="font-size: 10px;">express</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/hexo初始/" style="font-size: 10px;">hexo初始</a> <a href="/tags/hexo相关问题/" style="font-size: 10px;">hexo相关问题</a> <a href="/tags/howler-js、-video-js/" style="font-size: 10px;">howler.js、 video.js</a> <a href="/tags/insertAdjacentHTML方法/" style="font-size: 10px;">insertAdjacentHTML方法</a> <a href="/tags/insertAdjacentText方法/" style="font-size: 10px;">insertAdjacentText方法</a> <a href="/tags/javascript、canvas、toDataURL/" style="font-size: 10px;">javascript、canvas、toDataURL()</a> <a href="/tags/mac-iphone-铃声/" style="font-size: 10px;">mac iphone 铃声</a> <a href="/tags/node-版本管理-nvm-n/" style="font-size: 10px;">node 版本管理  nvm  n</a> <a href="/tags/node-读写excel-JS-XLSX-分析excel写入/" style="font-size: 10px;">node 读写excel JS-XLSX 分析excel写入</a> <a href="/tags/pm2学习实践-nodejs-pm2/" style="font-size: 10px;">pm2学习实践 nodejs pm2</a> <a href="/tags/react-flux-redux-ECMAScript6-Vue-Angular-Angular2-0-NuclearJS/" style="font-size: 10px;">react flux redux ECMAScript6 Vue Angular Angular2.0 NuclearJS</a> <a href="/tags/ssh常用命令-SSH/" style="font-size: 10px;">ssh常用命令  SSH</a> <a href="/tags/video-canvas/" style="font-size: 10px;">video canvas</a> <a href="/tags/vue-router-vue/" style="font-size: 10px;">vue-router, vue</a> <a href="/tags/webp/" style="font-size: 10px;">webp</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/三角学、弧度、角度/" style="font-size: 10px;">三角学、弧度、角度</a> <a href="/tags/买房前必备知识-house-home/" style="font-size: 10px;">买房前必备知识  house home</a> <a href="/tags/买车前必备知识-car/" style="font-size: 10px;">买车前必备知识  car</a> <a href="/tags/京东购物H5活动CP重构规范/" style="font-size: 10px;">京东购物H5活动CP重构规范</a> <a href="/tags/优化JavaScript的执行效率/" style="font-size: 10px;">优化JavaScript的执行效率</a> <a href="/tags/前端性能优化/" style="font-size: 10px;">前端性能优化</a> <a href="/tags/吉他/" style="font-size: 10px;">吉他</a> <a href="/tags/吉他知识/" style="font-size: 10px;">吉他知识</a> <a href="/tags/学吉他知识集锦/" style="font-size: 10px;">学吉他知识集锦</a> <a href="/tags/旅游-帝都畅游-相约北京/" style="font-size: 10px;">旅游 帝都畅游 相约北京</a> <a href="/tags/模块的写法/" style="font-size: 10px;">模块的写法</a> <a href="/tags/运营规范/" style="font-size: 10px;">运营规范</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/pingfan1990/">博客园博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.w3cfuns.com/house.php">前端网博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://pingfan1990.sinaapp.com/">pfan展示平台</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://doc.pfan123.com/">pfan前端开发导航平台</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">因上努力，果上随缘</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">pfan</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://litten.github.io/assets/blogImg/litten.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">pfan</h1>
			</hgroup>
			
			<p class="header-subtitle">新起点，新高度</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/pfan123" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/gaolu1990/home?wvr=5" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-Mongoose 参考手册" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/01/Mongoose 参考手册/" class="article-date">
  	<time datetime="2016-08-01T11:17:43.000Z" itemprop="datePublished">2016-08-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/01/Mongoose 参考手册/">Mongoose 参考手册 -- 转载</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Mongoose-是什么"><a href="#Mongoose-是什么" class="headerlink" title="Mongoose 是什么?"></a>Mongoose 是什么?</h2><p>一般我们不直接用MongoDB的函数来操作MongoDB数据库 Mongose就是一套操作MongoDB数据库的接口.</p>
<h4 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h4><p>一种以文件形式存储的数据库模型骨架，无法直接通往数据库端，也就是说它不具备对数据库的操作能力.可以说是数据属性模型(传统意义的表结构)，又或着是“集合”的模型骨架</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/* 定义一个 Schema */</span><br><span class="line">var mongoose = require(&quot;mongoose&quot;);</span><br><span class="line"></span><br><span class="line">var TestSchema = new mongoose.Schema(&#123;</span><br><span class="line">    name : &#123; type:String &#125;,//属性name,类型为String</span><br><span class="line">    age  : &#123; type:Number, default:0 &#125;,//属性age,类型为Number,默认为0</span><br><span class="line">    time : &#123; type:Date, default:Date.now &#125;,</span><br><span class="line">    email: &#123; type:String,default:&apos;&apos;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面这个 TestSchema包含4个属性 [name, age, time, email]</p>
<h4 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h4><p>由Schema构造生成的模型，除了Schema定义的数据库骨架以外，还具有数据库操作的行为，类似于管理数据库属性、行为的类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var db = mongoose.connect(&quot;mongodb://127.0.0.1:27017/test&quot;);</span><br><span class="line"></span><br><span class="line">// 创建Model</span><br><span class="line">var TestModel = db.model(&quot;test1&quot;, TestSchema);</span><br></pre></td></tr></table></figure>
<p>test1 数据库中的集合名称, 不存在会创建.</p>
<h4 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h4><p>由Model创建的实体，使用save方法保存数据，Model和Entity都有能影响数据库的操作，但Model比Entity更具操作性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var TestEntity = new TestModel(&#123;</span><br><span class="line">       name : &quot;Lenka&quot;,</span><br><span class="line">       age  : 36,</span><br><span class="line">       email: &quot;lenka@qq.com&quot;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(TestEntity.name); // Lenka</span><br><span class="line">console.log(TestEntity.age); // 36</span><br></pre></td></tr></table></figure>
<h4 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h4><p>MongoDB 使用游标返回find的执行结果.客户端对游标的实现通常能够对最终结果进行有效的控制。可以限制结果的数量，略过部分结果，根据任意键按任意顺序的组合对结果进行各种排序，或者是执行其他一些强的操作。</p>
<h4 id="ObjectId"><a href="#ObjectId" class="headerlink" title="ObjectId"></a>ObjectId</h4><p>存储在mongodb集合中的每个文档（document）都有一个默认的主键_id，这个主键名称是固定的，它可以是mongodb支持的任何数据类型，默认是ObjectId。</p>
<p>ObjectId是一个12字节的 BSON 类型字符串。按照字节顺序，依次代表：<br>4字节：UNIX时间戳<br>3字节：表示运行MongoDB的机器<br>2字节：表示生成此_id的进程<br>3字节：由一个随机数开始的计数器生成的值</p>
<h4 id="Node-js-中"><a href="#Node-js-中" class="headerlink" title="Node.js 中"></a>Node.js 中</h4><p>package.json 中加入”mongoose”: “*” 字段<br>npm install 安装依赖.</p>
<p>var mongoose = require(“mongoose”);<br>var db = mongoose.connect(“mongodb://localhost:27017/test”);<br>然后引用</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>var mongoose = require(“mongoose”);<br>var db = mongoose.connect(“mongodb://localhost:27017/test”);</p>
<h4 id="db-数据库操作"><a href="#db-数据库操作" class="headerlink" title="db - 数据库操作"></a>db - 数据库操作</h4><p>1.挂接数据库连接事件,参数1: 也可以是error.</p>
<p> db.connection.on(‘open’, callback);</p>
<h2 id="Schema-表结构"><a href="#Schema-表结构" class="headerlink" title="Schema - 表结构"></a>Schema - 表结构</h2><p>1.构造函数</p>
<blockquote>
<p>new mongoose.Schema( { name:{type:String}, age:{type:Number, default:10}  } )</p>
</blockquote>
<p>2.添加属性</p>
<blockquote>
<p>Schema.add( { name: ‘String’, email: ‘String’, age: ‘Number’ } )</p>
</blockquote>
<p>3.有时候Schema不仅要为后面的Model和Entity提供公共的属性，还要提供公共的方法</p>
<blockquote>
<p>Schema.method( ‘say’, function(){console.log(‘hello’);} )<br>//这样Model和Entity的实例就能使用这个方法了</p>
</blockquote>
<p>4.添加静态方法</p>
<blockquote>
<p>Schema.static( ‘say’, function(){console.log(‘hello’);} )<br>//静态方法，只限于在Model层就能使用</p>
</blockquote>
<p>5.追加方法</p>
<blockquote>
<p>Schema.methods.say = function(){console.log(‘hello’);};<br>//静态方法，只限于在Model层就能使用</p>
</blockquote>
<h2 id="model-文档操作"><a href="#model-文档操作" class="headerlink" title="model - 文档操作"></a>model - 文档操作</h2><p>1.构造函数, 参数1:集合名称, 参数2:Schema实例</p>
<blockquote>
<p> db.model(“test1”, TestSchema );</p>
</blockquote>
<p>2.查询, 参数1忽略,或为空对象则返回所有集合文档</p>
<blockquote>
<p> model.find({}, callback);</p>
<p> model.find({},field,callback);<br>过滤查询,参数2: {‘name’:1, ‘age’:0} 查询文档的返回结果包含name , 不包含age.(_id默认是1)</p>
<p>model.find({},null,{limit:20});<br>过滤查询,参数3: 游标操作 limit限制返回结果数量为20个,如不足20个则返回所有.</p>
<p>model.findOne({}, callback);<br>查询找到的第一个文档</p>
<p>model.findById(‘obj._id’, callback);<br>查询找到的第一个文档,同上. 但是只接受 __id 的值查询</p>
</blockquote>
<p>3.创建, 在集合中创建一个文档</p>
<blockquote>
<p>Model.create(文档数据, callback))</p>
</blockquote>
<p>4.更新,参数1:查询条件, 参数2:更新对象,可以使用MondoDB的更新修改器</p>
<blockquote>
<p>Model.update(conditions, update, function(error)</p>
</blockquote>
<p>5.删除, 参数1:查询条件</p>
<blockquote>
<p>Model.remove(conditions,callback);</p>
</blockquote>
<h4 id="Entity-文档操作"><a href="#Entity-文档操作" class="headerlink" title="Entity - 文档操作"></a>Entity - 文档操作</h4><p>1.构造函数, 其实就是model的实例</p>
<blockquote>
<p>new TestModel( { name:‘xueyou’, age:21 } );</p>
</blockquote>
<p>2.创建, 在集合中创建一个文档.</p>
<blockquote>
<p>Entity.save(callback);</p>
</blockquote>
<h2 id="修改器和更新器"><a href="#修改器和更新器" class="headerlink" title="修改器和更新器"></a>修改器和更新器</h2><h4 id="更新修改器"><a href="#更新修改器" class="headerlink" title="更新修改器:"></a>更新修改器:</h4><p>‘$inc’ 增减修改器,只对数字有效.下面的实例: 找到 age=22的文档,修改文档的age值自增1</p>
<blockquote>
<p>Model.update({‘age’:22}, {’$inc’:{‘age’:1} }  );<br>执行后: age=23</p>
</blockquote>
<p>‘$set’ 指定一个键的值,这个键不存在就创建它.可以是任何MondoDB支持的类型.</p>
<blockquote>
<p>Model.update({‘age’:22}, {’$set’:{‘age’:‘haha’} }  );<br>执行后: age=‘haha’</p>
</blockquote>
<p>‘$unset’ 同上取反,删除一个键</p>
<blockquote>
<p>Model.update({‘age’:22}, {’$unset’:{‘age’:‘haha’} }  );<br>执行后: age键不存在</p>
</blockquote>
<h4 id="数组修改器"><a href="#数组修改器" class="headerlink" title="数组修改器:"></a>数组修改器:</h4><p>‘$push’ 给一个键push一个数组成员,键不存在会创建</p>
<blockquote>
<p> Model.update({‘age’:22}, {’$push’:{‘array’:10} }  );<br>执行后: 增加一个 array 键,类型为数组, 有一个成员 10</p>
</blockquote>
<p>‘$addToSet’ 向数组中添加一个元素,如果存在就不添加</p>
<blockquote>
<p> Model.update({‘age’:22}, {’$addToSet’:{‘array’:10} }  );<br>执行后: array中有10所以不会添加</p>
</blockquote>
<p>‘$each’ 遍历数组, 和 $push 修改器配合可以插入多个值</p>
<blockquote>
<p> Model.update({‘age’:22}, {’$push’:{‘array’:{’$each’: [1,2,3,4,5]}} }  );<br>执行后: array : [10,1,2,3,4,5]</p>
</blockquote>
<p>‘$pop’ 向数组中尾部删除一个元素</p>
<blockquote>
<p> Model.update({‘age’:22}, {’$pop’:{‘array’:1} }  );<br>执行后: array : [10,1,2,3,4]  tips: 将1改成-1可以删除数组首部元素</p>
</blockquote>
<p>‘$pull’ 向数组中删除指定元素</p>
<blockquote>
<p> Model.update({‘age’:22}, {’$pull’:{‘array’:10} }  );<br>执行后: array : [1,2,3,4]  匹配到array中的10后将其删除</p>
</blockquote>
<h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询:"></a>条件查询:</h4><ul>
<li>“$lt”    小于</li>
<li>“$lte”    小于等于</li>
<li>“$gt”    大于</li>
<li>“$gte”    大于等于</li>
<li>“$ne”    不等于</li>
</ul>
<blockquote>
<p>Model.find({“age”:{ “$get”:18 , “$lte”:30 } } );<br>查询 age 大于等于18并小于等于30的文档</p>
</blockquote>
<h4 id="或查询-OR"><a href="#或查询-OR" class="headerlink" title="或查询 OR:"></a>或查询 OR:</h4><ul>
<li>‘$in’ 一个键对应多个值</li>
<li>‘$nin’ 同上取反, 一个键不对应指定值</li>
<li>“$or” 多个条件匹配, 可以嵌套 $in 使用</li>
<li><p>“$not”    同上取反, 查询与特定模式不匹配的文档</p>
<blockquote>
<p> Model.find({“age”:{ “$in”:[20,21,22.‘haha’]} } );<br>查询 age等于20或21或21或’haha’的文档</p>
<p>Model.find({“$or” :  [ {‘age’:18} , {‘name’:‘xueyou’} ] });<br>查询 age等于18 或 name等于’xueyou’ 的文档</p>
</blockquote>
</li>
</ul>
<h4 id="类型查询"><a href="#类型查询" class="headerlink" title="类型查询:"></a>类型查询:</h4><p>null 能匹配自身和不存在的值, 想要匹配键的值 为null, 就要通过  “$exists” 条件判定键值已经存在<br>“$exists” (表示是否存在的意思)</p>
<blockquote>
<p> Model.find(“age” :  { “$in” : [null] , “exists” : true  } );<br>查询 age值为null的文档</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;name: &#123;$exists: true&#125;&#125;,function(error,docs)&#123;</span><br><span class="line">  //查询所有存在name属性的文档</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Model.find(&#123;telephone: &#123;$exists: false&#125;&#125;,function(error,docs)&#123;</span><br><span class="line">  //查询所有不存在telephone属性的文档</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式:"></a>正则表达式:</h4><p>MongoDb 使用 Prel兼容的正则表达式库来匹配正则表达式</p>
<blockquote>
<p> find( {“name” : /joe/i } )<br>查询name为 joe 的文档, 并忽略大小写</p>
<p> find( {“name” : /joe?/i } )<br>查询匹配各种大小写组合</p>
</blockquote>
<h4 id="查询数组"><a href="#查询数组" class="headerlink" title="查询数组:"></a>查询数组:</h4><blockquote>
<p>  Model.find({“array”:10} );<br>查询 array(数组类型)键中有10的文档,  array : [1,2,3,4,5,10]  会匹配到</p>
<p>  Model.find({“array[5]”:10} );<br>查询 array(数组类型)键中下标5对应的值是10,  array : [1,2,3,4,5,10]  会匹配到</p>
</blockquote>
<p>‘$all’ 匹配数组中多个元素</p>
<blockquote>
<p>  Model.find({“array”:[5,10]} );<br>查询 匹配array数组中 既有5又有10的文档</p>
</blockquote>
<p>‘$size’ 匹配数组长度</p>
<blockquote>
<p>  Model.find({“array”:{“$size” : 3} } );<br>查询 匹配array数组长度为3 的文档</p>
</blockquote>
<p>‘$slice’ 查询子集合返回</p>
<blockquote>
<p>  Model.find({“array”:{“$skice” : 10} } );<br>查询 匹配array数组的前10个元素</p>
<p>  Model.find({“array”:{“$skice” : [5,10] } } );<br>查询 匹配array数组的第5个到第10个元素</p>
</blockquote>
<h4 id="where"><a href="#where" class="headerlink" title="where"></a>where</h4><p>用它可以执行任意javacript语句作为查询的一部分,如果回调函数返回 true 文档就作为结果的一部分返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">	find( &#123;&quot;$where&quot; : function()&#123;</span><br><span class="line">		for( var x in this )&#123;</span><br><span class="line">		 //这个函数中的 this 就是文档</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if(this.x !== null &amp;&amp; this.y !== null)&#123;</span><br><span class="line">		    return this.x + this.y === 10 ? true : false;</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">		    return true;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">&#125;  &#125;  )</span><br></pre></td></tr></table></figure>
<p>简化版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find( &#123;&quot;$where&quot; :  &quot;this.x + this.y === 10&quot; &#125; )</span><br><span class="line">find( &#123;&quot;$where&quot; : &quot; function()&#123; return this.x + this.y ===10; &#125; &quot; &#125; )</span><br></pre></td></tr></table></figure>
<h4 id="游标-1"><a href="#游标-1" class="headerlink" title="游标:"></a>游标:</h4><ul>
<li>limit(3)    限制返回结果的数量,</li>
<li>skip(3)    跳过前3个文档,返回其余的</li>
<li>sort( {“username”:1 , “age”:-1 } )    排序 键对应文档的键名, 值代表排序方向, 1 升序, -1降序</li>
</ul>
<p>参考资料：</p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_62fda93c0101gw1g.html" target="_blank" rel="external">MongoDB 查询文档</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_62fda93c0101gw1g.html" target="_blank" rel="external">mongoose 学习</a></li>
<li><a href="http://blog.csdn.net/zk437092645/article/details/9345885" target="_blank" rel="external">mongoose对查询结果进行排序</a></li>
<li><a href="http://www.cnblogs.com/stephen-liu74/archive/2012/08/03/2553803.html" target="_blank" rel="external">MongoDB学习笔记(查询)</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mongoose参考手册-MongoDB-数据库-node/">Mongoose参考手册  MongoDB  数据库 node</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/技术杂谈/">技术杂谈</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-Docker-从入门到实践" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/25/Docker-从入门到实践/" class="article-date">
  	<time datetime="2016-07-25T11:17:43.000Z" itemprop="datePublished">2016-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/25/Docker-从入门到实践/">Docker — 从入门到实践</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>买车文章大纲：</p>
<p>准备资料：</p>
<ul>
<li><a href="https://docs.docker.com/" target="_blank" rel="external">docker官方文档</a></li>
<li><a href="https://yeasy.gitbooks.io/docker_practice/content/" target="_blank" rel="external">Docker —— 从入门到实践</a></li>
<li><a href="http://www.runoob.com/docker/docker-tutorial.html" target="_blank" rel="external">Docker 教程</a></li>
<li><a href="http://www.docker.org.cn/book/docker/what-is-docker-16.html" target="_blank" rel="external">docker中文</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/">Docker</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/技术杂谈/">技术杂谈</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-gitignore 文件使用说明" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/25/gitignore 文件使用说明/" class="article-date">
  	<time datetime="2016-07-25T11:17:43.000Z" itemprop="datePublished">2016-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/25/gitignore 文件使用说明/">.gitignore 文件使用说明</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我们在使用 Git 进行版本控制的时候，有些文件是无需纳入 Git 管理的，通常都是些自动生成的文件，像日志或者编译过程中创建的文件。我们可以创建一个名为 .gitignore的文件，列出要忽略的文件来解决这个问题。</p>
<p>来看一个简单的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># cat .gitignore</span><br><span class="line">*.[oa]</span><br><span class="line">*~</span><br></pre></td></tr></table></figure>
<p>第一行告诉 Git 忽略所有以 .o 或 .a结尾的文件。一般这类对象文件和存档文件都是编译过程中出现的，我们用不着跟踪它们的版本。<br>第二行告诉 Git 忽略所有以波浪符（~）结尾的文件，许多文本编辑软件（比如 Emacs）都用这样的文件名保存副本。此外，你可能还需要忽略 log，tmp 或者 pid 目录，以及自动生成的文档等等。要养成一开始就设置好 .gitignore 文件的习惯，以免将来误提交这类无用的文件。</p>
<p>文件 .gitignore 的格式规范如下：<br>所有空行或者以注释符号 ＃ 开头的行都会被 Git 忽略。<br>可以使用标准的 glob 模式匹配。<br>匹配模式最后跟反斜杠（/）说明要忽略的是目录。<br>要忽略指定模式以外的文件或目录，可以在模式前加上惊叹号（!）取反。</p>
<p>所谓的 glob 模式是指 shell 所使用的简化了的正则表达式。<br>星号（*）匹配零个或多个任意字符；<br>[abc] 匹配任何一个列在方括号中的字符（这个例子要么匹配一个 a，要么匹配一个 b，要么匹配一个 c）；<br>问号（?）只匹配一个任意字符；<br>如果在方括号中使用短划线分隔两个字符，表示所有在这两个字符范围内的都可以匹配（比如 [0-9] 表示匹配所有 0 到 9 的数字）。</p>
<p>我们再看一个 .gitignore 文件的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 忽略所有 .a 结尾的文件</span><br><span class="line">*.a</span><br><span class="line"></span><br><span class="line"># 但 lib.a 除外</span><br><span class="line">!lib.a</span><br><span class="line"></span><br><span class="line"># 仅仅忽略项目根目录下的 TODO 文件，不包括 subdir/TODO</span><br><span class="line">/TODO</span><br><span class="line"></span><br><span class="line"># 忽略 build/ 目录下的所有文件</span><br><span class="line">build/</span><br><span class="line"></span><br><span class="line"># 会忽略 doc/notes.txt 但不包括 doc/server/notes.txt</span><br><span class="line">doc/notes.txt</span><br></pre></td></tr></table></figure>
<p>其他信息可以直接 man gitignore 查看。</p>
<p>此外推荐一个自动生成 .gitignore 文件的网址：<a href="http://www.gitignore.io/" target="_blank" rel="external">http://www.gitignore.io/</a></p>
<p>对于iOS开发者，推荐一个 gist ：<a href="https://gist.github.com/mmorey/6931793" target="_blank" rel="external">https://gist.github.com/mmorey/6931793</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gitignore-git/">.gitignore git</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/技术杂谈/">技术杂谈</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-买车前必备知识" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/24/买车前必备知识/" class="article-date">
  	<time datetime="2016-07-24T11:17:43.000Z" itemprop="datePublished">2016-07-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/24/买车前必备知识/">买车前必备知识</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>买车文章大纲：</p>
<p>1.车型简介</p>
<p>2.买车前必备知识<br>    油耗－百公里多少油耗（雪铁龙车型 8.3L/百公里，6～7左右最省油，控制在每公里5毛以内），性能保养</p>
<p>3.各车型品牌对比</p>
<p>准备资料：</p>
<ul>
<li><a href="https://www.zhihu.com/question/28587624" target="_blank" rel="external">买车前需要了解哪些知识？</a></li>
<li><a href="https://www.zhihu.com/question/20216680" target="_blank" rel="external">关于汽车构造，有什么是必须知道的知识？</a></li>
<li><a href="https://www.zhihu.com/question/28341210" target="_blank" rel="external">拥有汽车的生活和没有汽车有什么差别？</a></li>
<li><a href="https://www.zhihu.com/question/31422477" target="_blank" rel="external">买车是买低配、中配还是高配？</a></li>
<li><a href="https://www.zhihu.com/question/30086195" target="_blank" rel="external">一年当中买车的最佳时间为何时？</a></li>
<li><a href="https://www.zhihu.com/question/31347237" target="_blank" rel="external">第一次买车是怎样一种体验？</a></li>
<li><a href="http://auto.sohu.com/20151207/n430090704.shtml" target="_blank" rel="external">买车千万别只看油耗</a></li>
<li><a href="https://www.zhihu.com/question/37226869" target="_blank" rel="external">汽车油耗大是种什么样的体验?</a></li>
<li><a href="http://newcar.xcar.com.cn/oil.htm" target="_blank" rel="external">车主油耗</a></li>
<li><a href="http://toutiao.com/i6229453131135058433/" target="_blank" rel="external">长安哈弗中枪 优惠一万也别买这些百公里油耗上10的SUV</a></li>
<li><a href="http://auto.sohu.com/20160612/n454052159.shtml" target="_blank" rel="external">百公里油耗低于6L，10万就选它们！</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/买车前必备知识-car/">买车前必备知识  car</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/兴趣爱好/">兴趣爱好</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-买房前必备知识" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/24/买房前必备知识/" class="article-date">
  	<time datetime="2016-07-24T11:17:43.000Z" itemprop="datePublished">2016-07-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/24/买房前必备知识/">买房前必备知识</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>买车文章大纲：</p>
<p>准备资料：</p>
<ul>
<li><a href="https://www.zhihu.com/question/28086367" target="_blank" rel="external">买房前要学习哪些知识（常识），有哪些获取的途径推荐？</a></li>
<li><a href="https://www.zhihu.com/question/20216680" target="_blank" rel="external">普通人购房前需要了解的知识有哪些？</a></li>
<li><a href="https://www.zhihu.com/question/21879342" target="_blank" rel="external">对于买房，有哪些理财的知识和好的方法？</a></li>
<li><a href="https://www.zhihu.com/question/24464072" target="_blank" rel="external">买房看房时需要注意哪些？</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/买房前必备知识-house-home/">买房前必备知识  house home</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/兴趣爱好/">兴趣爱好</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-通过.htaccess文件将二级域名绑定到子目录" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/24/通过.htaccess文件将二级域名绑定到子目录/" class="article-date">
  	<time datetime="2016-07-24T10:51:43.000Z" itemprop="datePublished">2016-07-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/24/通过.htaccess文件将二级域名绑定到子目录/">通过.htaccess文件配置二级域名绑定子目录</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一直使用万网的虚拟主机，但是发现只能绑定域名到根目录，因此想要添加一个新的网站只能使用 abc.com/blog 而不能用 blog.abc.com 这样的二级域名。可以通过 .htaccess 文件来解决该问题，那下面具体讲一下万网通过.htaccess文件配置二级域名绑定子目录。</p>
<h2 id="第一步，增加-htaccess配置"><a href="#第一步，增加-htaccess配置" class="headerlink" title="第一步，增加.htaccess配置"></a>第一步，增加.htaccess配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 开启功能  </span><br><span class="line">RewriteEngine on  </span><br><span class="line"> </span><br><span class="line"># 你要绑定的二级域名  </span><br><span class="line">RewriteCond %&#123;HTTP_HOST&#125; ^blog.abc.com$  </span><br><span class="line"> </span><br><span class="line"># 把那个子目录指向要绑定的二级域名  </span><br><span class="line"># 这里以子目录blog目录为例  </span><br><span class="line">RewriteCond %&#123;REQUEST_URI&#125; !^/blog/  </span><br><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-f  </span><br><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-d  </span><br><span class="line">RewriteRule ^(.*)$ /blog/$1  </span><br><span class="line"> </span><br><span class="line">#这里改成要绑定的二级域名和要绑定的子目录  </span><br><span class="line">RewriteCond %&#123;HTTP_HOST&#125; ^blog.abc.com$  </span><br><span class="line">RewriteRule ^(/)?$ blog/index.php [L]</span><br><span class="line"></span><br><span class="line"># 你要绑定的二级域名  </span><br><span class="line">RewriteCond %&#123;HTTP_HOST&#125; ^case.abc.com$  </span><br><span class="line"> </span><br><span class="line"># 配置case.abc.com域名</span><br><span class="line">RewriteCond %&#123;REQUEST_URI&#125; !^/case/  </span><br><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-f  </span><br><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-d  </span><br><span class="line">RewriteRule ^(.*)$ /case/$1  </span><br><span class="line">  </span><br><span class="line">RewriteCond %&#123;HTTP_HOST&#125; ^case.abc.com$  </span><br><span class="line">RewriteRule ^(/)?$ case/index.php [L]</span><br></pre></td></tr></table></figure>
<h2 id="第二步，增加域名解析"><a href="#第二步，增加域名解析" class="headerlink" title="第二步，增加域名解析"></a>第二步，增加域名解析</h2><p><img src="http://7xrig5.com1.z0.glb.clouddn.com/yuming1.png" alt="增加域名解析"></p>
<h2 id="第三步，绑定域名"><a href="#第三步，绑定域名" class="headerlink" title="第三步，绑定域名"></a>第三步，绑定域名</h2><p><img src="http://7xrig5.com1.z0.glb.clouddn.com/yun2.png" alt="增加域名解析"></p>
<p>经过，上面三个步骤，就可以访问绑定的二级域名了。</p>
<p>参考资料：</p>
<ul>
<li><a href="http://www.oschina.net/question/12_58586" target="_blank" rel="external">21 个非常有用的 .htaccess 提示和技巧</a></li>
<li><a href="http://www.php100.com/html/webkaifa/apache/2012/0816/10885.html" target="_blank" rel="external">.htaccess 配置文件详解</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/htaccess-配置二级域名-绑定子目录/">.htaccess  配置二级域名  绑定子目录</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/技术杂谈/">技术杂谈</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-webp实践" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/19/webp实践/" class="article-date">
  	<time datetime="2016-07-19T03:51:43.000Z" itemprop="datePublished">2016-07-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/19/webp实践/">webp实践探究</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近组内流行一股探讨webp的风潮，抱着实事求是的态度，本码农也开始了webp探究实践。先扫一下盲，提提WebP的优势。</p>
<h2 id="WebP-的优势"><a href="#WebP-的优势" class="headerlink" title="WebP 的优势"></a>WebP 的优势</h2><p>WebP 格式是 Google 于2010年发布的一种支持有损压缩和无损压缩的图片文件格式，派生自图像编码格式 VP8。它具有较优的图像数据压缩算法，能带来更小的图片体积，而且拥有肉眼识别无差异的图像质量，同时具备了无损和有损的压缩模式、Alpha 透明以及动画的特性，在 JPEG 和 PNG 上的转化效果都非常优秀、稳定和统一。目前，知名网站 Youtube 、Facebook、Ebay 等均有使用 WebP格式。</p>
<p>WebP 集合了多种图片文件格式的特点，JPEG 适合压缩照片和其他细节丰富的图片，GIF 可以显示动态图片，PNG 支持透明图像，图片色彩非常丰富，而 WebP 则兼具上述优点，且较于它们还有更出色的地方。</p>
<p>据 Google 测试，无损压缩后的 WebP 比 PNG 文件少了 45% 的文件大小，即使 PNG 文件经过其他压缩工具压缩后，WebP 还是可以减少 28% 的文件大小。此外，与 JPEG 相比，在质量相同的情况下，WebP 格式图像的体积要比 JPEG 格式图像小 40%，而 WebP 在压缩方面比 JPEG 格式更优越。    </p>
<h2 id="Webp-转换工具"><a href="#Webp-转换工具" class="headerlink" title="Webp 转换工具"></a>Webp 转换工具</h2><p>看了我组恩鑫大大的<a href="http://mtd.jd.com/wiki/doku.php?id=blog:2016:07:png_%E8%BD%AC_webp_%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%96%B9%E5%BC%8F" target="_blank" rel="external">png 转 webp 的正确姿势</a>，知道了<a href="https://developers.google.com/speed/webp/" target="_blank" rel="external">WebP Converter工具</a>转换webp的效率是比较高的。</p>
<p>webP Converter工具安装是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo brew install webp</span><br></pre></td></tr></table></figure>
<p>转换webp命令是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cwebp -q 80 image.png -o image.webp</span><br></pre></td></tr></table></figure>
<p>知道了，google提供的工具转换效率高，以及使用方式，鉴于工程化、批量化、敏捷开发的原则，我进行了如下猜想使其达到批量生产的目的：</p>
<p>猜测一：  cwebp命令后面匹配多个参数进行批量转换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cwebp -q 80 image.png -o image.webp -q 80 logo.png -o logo.webp</span><br></pre></td></tr></table></figure>
<p>抱着大大的希望，结果发现，只能转换最后一个图片，只能转换最后一个图片，只能转换最后一个图片，重要的事情说三遍，整个人不好了……</p>
<p>猜测二：通过child_process模块，开子进程，来执行格式webp转换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">const child_process  = require(&quot;child_process&quot;);</span><br><span class="line">const fs = require(&quot;fs&quot;);</span><br><span class="line">const path = require(&quot;path&quot;);</span><br><span class="line">const curPath = process.cwd();</span><br><span class="line"></span><br><span class="line">function convertWep(opt)&#123;</span><br><span class="line">	var src = opt.src, quality = opt.quality || 60;</span><br><span class="line"></span><br><span class="line">    if(fs.existsSync(src))&#123;</span><br><span class="line">        fs.readdir(src,(err,files) =&gt; &#123;</span><br><span class="line">            if(err)&#123;console.log(err);return;&#125;</span><br><span class="line">            files.forEach(function(filename)&#123;</span><br><span class="line">            </span><br><span class="line">                var url = path.join(src,filename);</span><br><span class="line"></span><br><span class="line">                fs.stat(url,(err, stats) =&gt; &#123;</span><br><span class="line">                    if (err) throw err;</span><br><span class="line">                    </span><br><span class="line">                    if(stats.isFile())&#123;</span><br><span class="line">                    	//不支持bmp格式</span><br><span class="line">                        if(/.*\.png|jpg|gif$/.test(url))&#123;</span><br><span class="line">                        </span><br><span class="line">                        	var webpsrc = url.split(&apos;.&apos;)[0]+&quot;.webp&quot;;</span><br><span class="line">                        	childWebp(path.join(curPath,url),quality,path.join(curPath,webpsrc))</span><br><span class="line">                        	console.log(filename+&quot; 转换webp格式成功&quot;);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;else if(stats.isDirectory())&#123;</span><br><span class="line">                        convertWep(&#123;</span><br><span class="line">							&quot;src&quot;:url,</span><br><span class="line">							&quot;quality&quot;:quality                        	</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        console.log(&quot;给定的目录不存，读取不到文件&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function childWebp(src , quality,webpsrc)&#123;</span><br><span class="line">	child_process.exec(&quot;cwebp -q &quot;+quality+&quot; &quot;+src+&quot; -o &quot;+webpsrc,(error, stdout, stderr) =&gt; &#123;</span><br><span class="line">	    if (error) &#123;</span><br><span class="line">	      console.log(error.stack);</span><br><span class="line">	      console.log(&apos;Error code: &apos; + error.code);</span><br><span class="line">	      return ;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">convertWep(&#123;</span><br><span class="line">	src:&quot;./images/&quot;,</span><br><span class="line">	quality:60</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>转换结果：<br><img src="http://7xrig5.com1.z0.glb.clouddn.com/1.png" alt="child_process开进程转换结果"></p>
<p>方法原理就是给每个图片单独开子进程进行转换，看结果可以达到批量转换不同质量的webp格式的目的，但是不够优雅，无法达到监测每个图片转换情况，无法监测图片转换完成，以及无法关闭所开的子进程。</p>
<h3 id="gulp-webp转换工具"><a href="#gulp-webp转换工具" class="headerlink" title="gulp-webp转换工具"></a>gulp-webp转换工具</h3><p>本着码农朋友不作死、不服输的精神，反复查阅资料找寻其他自动化转换webp工具，我发现了<a href="https://github.com/sindresorhus/gulp-webp" target="_blank" rel="external">gulp-webp</a>插件也可以达到批量转换，支持 <code>PNG</code>、<code>JPEG</code>、<code>TIFF</code>格式转换，并且转换率基本一致。</p>
<p>使用示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const gulp = require(&apos;gulp&apos;);</span><br><span class="line">const webp = require(&apos;gulp-webp&apos;);</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;default&apos;, () =&gt;</span><br><span class="line">    gulp.src(&apos;./images/*.&#123;png,jpg,jpeg&#125;&apos;)</span><br><span class="line">        .pipe(webp(&#123;quality: 60&#125;))</span><br><span class="line">        .pipe(gulp.dest(&apos;./dist&apos;))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>简单看看，示例代码，感觉还是很优雅的，但使用时发现无法提供转换webp具体提示，这点糟透了：<br>执行结果：<br><img src="http://7xrig5.com1.z0.glb.clouddn.com/2.png" alt="child_process开进程转换结果"></p>
<p>gulp-webp与WebP Converter转换率对比:<br><code>WebP Converter</code>: 0.4.3<br><code>gulp-webp</code>: 2.3.0<br>原图： bg.jpg (34.176K)，test.png(141.071K)</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>质量</th>
<th>gulp-webp</th>
<th>WebP Converter</th>
</tr>
</thead>
<tbody>
<tr>
<td>bg.jpg</td>
<td>90%</td>
<td>21.344K</td>
<td>21.344K</td>
</tr>
<tr>
<td></td>
<td>80%</td>
<td>10.250K</td>
<td>10.250K</td>
</tr>
<tr>
<td></td>
<td>70%</td>
<td>7.550K</td>
<td>7.550K</td>
</tr>
<tr>
<td></td>
<td>60%</td>
<td>6.856K</td>
<td>6.856K</td>
</tr>
<tr>
<td></td>
<td>50%</td>
<td>6.034K</td>
<td>6.034K</td>
</tr>
<tr>
<td>test.png</td>
<td>90%</td>
<td>48.390K</td>
<td>48.710K</td>
</tr>
<tr>
<td></td>
<td>80%</td>
<td>29.584K</td>
<td>29.584K</td>
</tr>
<tr>
<td></td>
<td>70%</td>
<td>23.240K</td>
<td>23.240K</td>
</tr>
<tr>
<td></td>
<td>60%</td>
<td>20.734K</td>
<td>20.734K</td>
</tr>
<tr>
<td></td>
<td>50%</td>
<td>18.332K</td>
<td>18.332K</td>
</tr>
</tbody>
</table>
<p>对比结果得出，gulp-webp与WebP Converter转换率基本是一致的，于是乎猜想难道它们使用额转换原理一样。抱着这个猜想，开始了分析<code>gulp-webp</code>转换原理。</p>
<p><code>gulp-webp</code>中 API 提到：</p>
<blockquote>
<p>webp([options])</p>
<p>See the <a href="https://github.com/imagemin/imagemin-webp#imageminwebpoptions" target="_blank" rel="external">imagemin-webp</a> options.</p>
</blockquote>
<p>查看<code>imagemin-webp</code>模块中发现，其中转换模块最终是利用<code>cwebp-bin</code>实现，其原理也是对图片单开子进程实现转换：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var execFile = require(&apos;child_process&apos;).execFile;</span><br><span class="line">var cwebp = require(&apos;cwebp-bin&apos;);</span><br><span class="line"></span><br><span class="line">execFile(cwebp, [&apos;input.png&apos;, &apos;-o&apos;, &apos;output.webp&apos;], function (err) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        throw err;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    console.log(&apos;Image is converted!&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>结合webp官网给出解释：</p>
<blockquote>
<p>WebP includes the lightweight encoding and decoding library libwebp and the command line tools cwebp and dwebp for converting images to and from the WebP format, as well as tools for viewing, muxing and animating WebP images. The full source code is available on the download page.</p>
</blockquote>
<p>最终结论，<code>WebP Converter</code>与<code>gulp-webp</code>转换webp的核心模块都是<code>cwebp-bin</code>，实现原理、转换效率基本都是一样，所以在使用webp批量转换上，使用gulp-webp插件或前面我提到的第二种猜想方法，都可以达到目的，具体使用可结合个人喜好选用。</p>
<h2 id="Webp-实例使用"><a href="#Webp-实例使用" class="headerlink" title="Webp 实例使用"></a>Webp 实例使用</h2><p>本码农再次本着实事求是的心态，深挖总结webp在项目中实际使用。具体使用方案如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//注意此脚本需放在样式前面</span><br><span class="line"> checkWebp();</span><br><span class="line"> </span><br><span class="line"> function checkWebp()&#123;</span><br><span class="line">      var img = new Image();</span><br><span class="line">      img.onload = function()&#123;</span><br><span class="line">         if(img.width &gt; 0 &amp;&amp; img.height &gt; 0)&#123;</span><br><span class="line">           document.documentElement.className = &quot;webp&quot;;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      img.onerror = function()&#123;&#125;</span><br><span class="line">      img.src = &quot;data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA&quot;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/201607/sns808/css/style.css&quot;&gt;</span><br><span class="line"></span><br><span class="line"> &lt;div class=&quot;wrapper&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"> //样式代码片段</span><br><span class="line"> .wrapper&#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    width:pxTorem(750px);</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    margin:0 auto;</span><br><span class="line">    background:image-url(&quot;bg.jpg&quot;) no-repeat;</span><br><span class="line">    background-size:cover;</span><br><span class="line">&#125;</span><br><span class="line">.webp&#123;</span><br><span class="line">    .wrapper&#123;</span><br><span class="line">        background:image-url(&quot;bg.webp&quot;) no-repeat;</span><br><span class="line">        background-size:cover;        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过chrome控制台观察结果：</p>
<p><img src="http://7xrig5.com1.z0.glb.clouddn.com/3.png" alt="实践结果"></p>
<p>通过浏览器的自动运算判断，只加载了对应使用的资源，从而达到减少加载资源、提高加载效率的目的。</p>
<p>参考资料：</p>
<ul>
<li><a href="https://github.com/sindresorhus/gulp-webp" target="_blank" rel="external">gulp-webp转换工具</a></li>
<li><a href="https://github.com/imagemin/imagemin-webp#imageminwebpoptions" target="_blank" rel="external">imagemin-webp包装 cwebp-bin</a></li>
<li><a href="https://github.com/imagemin/cwebp-bin" target="_blank" rel="external">底层转换cwebp-bin</a></li>
<li><a href="https://www.npmjs.com/package/webpcss" target="_blank" rel="external">webpcss</a></li>
<li><a href="http://blog.qiniu.com/archives/5793" target="_blank" rel="external">七牛云图片处理实践｜带你认识 WEBP</a></li>
<li><a href="http://7b1fp7.com2.z0.glb.clouddn.com/%E4%B8%83%E7%89%9B%E5%8A%A8%E6%80%81WebP%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.pdf" target="_blank" rel="external">七牛动态WebP使用指南.pdf</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webp/">webp</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-Canvas实时处理Video预研" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/18/Canvas实时处理Video预研/" class="article-date">
  	<time datetime="2016-07-18T03:51:43.000Z" itemprop="datePublished">2016-07-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/18/Canvas实时处理Video预研/">Canvas实时处理Video预研</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="video简介"><a href="#video简介" class="headerlink" title="video简介"></a>video简介</h2><p>HTML5里引入的新标记 <code>&lt;video&gt;</code> 实现了HTML对视频播放和音频播放的原生支持，有了这种原生的HTML5视频播放器/音频播放器，我们不再需要flash技术，而直接能将视频/音频嵌入到了网页中。</p>
<p>由于部分浏览器存在不支持<code>&lt;video&gt;</code> 标签，可以尝试使用<a href="https://github.com/videojs/video.js" target="_blank" rel="external">video.js</a>.</p>
<h2 id="如何嵌入视频"><a href="#如何嵌入视频" class="headerlink" title="如何嵌入视频"></a>如何嵌入视频</h2><p>方式一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;video src=&quot;http://www.webhek.com/~j/theora_testsuite/320x240.ogg&quot; controls autoplay loop&gt;</span><br><span class="line">  Your browser does not support the &lt;code&gt;video&lt;/code&gt; element.</span><br><span class="line">&lt;/video&gt;</span><br></pre></td></tr></table></figure>
<p>方式二：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;video width=&quot;320&quot; height=&quot;240&quot; controls&gt;</span><br><span class="line">  &lt;source src=&quot;movie.mp4&quot; type=&quot;video/mp4&quot;&gt;</span><br><span class="line">  &lt;source src=&quot;movie.ogg&quot; type=&quot;video/ogg&quot;&gt;</span><br><span class="line">您的浏览器不支持Video标签。</span><br><span class="line">&lt;/video&gt;</span><br></pre></td></tr></table></figure>
<h2 id="video常用属性"><a href="#video常用属性" class="headerlink" title="video常用属性"></a>video常用属性</h2><table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>autoplay</td>
<td>如果出现该属性，则视频在就绪后马上播放。</td>
</tr>
<tr>
<td>controls</td>
<td>如果出现该属性，则向用户显示控件，比如播放按钮。</td>
</tr>
<tr>
<td>loop</td>
<td>如果出现该属性，则当媒介文件完成播放后再次开始播放。</td>
</tr>
<tr>
<td>muted</td>
<td>规定视频的音频输出应该被静音。</td>
</tr>
<tr>
<td>poster</td>
<td>规定视频下载时显示的图像，或者在用户点击播放按钮前显示的图像。</td>
</tr>
<tr>
<td>preload</td>
<td>如果出现该属性，则视频在页面加载时进行加载，并预备播放。如果使用 “autoplay”，则忽略该属性。</td>
</tr>
<tr>
<td>webkit-playsinline</td>
<td>IOS允许内嵌播放在网页，因浏览器默认，全局打开。</td>
</tr>
</tbody>
</table>
<h2 id="video在IOS和Andriod使用情况"><a href="#video在IOS和Andriod使用情况" class="headerlink" title="video在IOS和Andriod使用情况"></a>video在IOS和Andriod使用情况</h2><blockquote>
<p>1.video在<code>IOS</code>环境下微信、sq以及uc使用情况<br>默认，全屏播放video，通过webkit-playsinline属性可以达到内嵌入网页播放，添加controls属性会导致出现video控制条.</p>
<p>2.video在<code>Andriod</code>环境下微信、sq以及uc使用情况<br>但凡检测到页面可播放的video元素，都会调用浏览器封装的播放器，全屏播放，不支持webkit-playsinline属性，发现qq域名拥有腾讯x5白名单，可以内嵌播放，默认不会调用全屏播放，但会自动添加浮动全屏按钮。</p>
</blockquote>
<h2 id="video转canvas"><a href="#video转canvas" class="headerlink" title="video转canvas"></a>video转canvas</h2><p>canvas中 drawImage() 方法可以在画布上绘制视频。想通过canvas绘制video视频的方式，来全兼容IOS和Andriod，发现还是无法解决Andriod中存在检测页面中video全屏播发的问题，示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- video视频在ios中wx和sq里面可以通过drawImage实现截取视频，andriod中wx和sq，不管你禁用还是隐藏video都会自动启用系统自带播放器--&gt;</span><br><span class="line">&lt;!-- 这里ios会有控制条，是因为加了controls，不加就可以取消--&gt;</span><br><span class="line">&lt;video id=&quot;video&quot; controls width=&quot;270&quot; autoplay webkit-playsinline=&quot;true&quot;&gt;</span><br><span class="line">  &lt;source src=&quot;http://www.w3school.com.cn/example/html5/mov_bbb.mp4&quot; type=&apos;video/mp4&apos;&gt;</span><br><span class="line">  &lt;source src=&quot;http://www.w3school.com.cn/example/html5/mov_bbb.ogg&quot; type=&apos;video/ogg&apos;&gt;</span><br><span class="line">  &lt;source src=&quot;http://www.w3school.com.cn/example/html5/mov_bbb.webm&quot; type=&apos;video/webm&apos;&gt;</span><br><span class="line">&lt;/video&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;画布（每 20 毫秒，代码就会绘制视频的当前帧）：&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;canvas id=&quot;myCanvas&quot; width=&quot;540&quot; height=&quot;270&quot; style=&quot;border:1px solid #d3d3d3;&quot;&gt;</span><br><span class="line">Your browser does not support the HTML5 canvas tag.</span><br><span class="line">&lt;/canvas&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">var video=document.getElementById(&quot;video&quot;);</span><br><span class="line">var canvas=document.getElementById(&quot;myCanvas&quot;);</span><br><span class="line">ctx=canvas.getContext(&apos;2d&apos;);</span><br><span class="line"></span><br><span class="line">video.addEventListener(&apos;play&apos;, function() &#123;var i=window.setInterval(function() &#123;ctx.drawImage(video,0,0,540,270)&#125;,20);&#125;,false);</span><br><span class="line">video.addEventListener(&apos;pause&apos;,function() &#123;window.clearInterval(i);&#125;,false);</span><br><span class="line">video.addEventListener(&apos;ended&apos;,function() &#123;clearInterval(i);&#125;,false);  </span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>参考资料：</p>
<ul>
<li><a href="http://tgideas.qq.com/webplat/info/news_version3/804/7104/7106/m5723/201509/374931.shtml" target="_blank" rel="external">关于“吴亦凡入伍”H5的背后的技术（前端篇）</a></li>
<li><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDQwNjY3Mg==&amp;mid=209431356&amp;idx=1&amp;sn=d4084807268fb54596d8119d8ca99d7d&amp;scene=23&amp;srcid=eIJhX8QYYO7xdxu35qSp#rd" target="_blank" rel="external">“吴亦凡即将入伍”的H5技术到底是怎么实现的？</a></li>
<li><p><a href="http://yanhaijing.com/html/2016/03/12/html5-video/" target="_blank" rel="external">HTML5视频的那些事儿）</a></p>
</li>
<li><p><a href="http://www.haomou.net/2014/08/04/2014_Html5_canvas_video/" target="_blank" rel="external">WebRTC相关的canvas与video</a></p>
</li>
<li><a href="http://www.jianshu.com/p/f198d11577f4" target="_blank" rel="external">字体平滑➕视频转canvas</a></li>
<li><a href="http://annn.me/video2txt-canvas/" target="_blank" rel="external">基于canvas将视频转化成字符动画</a></li>
<li><a href="http://www.w3school.com.cn/tags/canvas_drawimage.asp" target="_blank" rel="external">HTML5 canvas drawImage() 方法</a></li>
<li><a href="http://annn.me/img2txt-canvas/" target="_blank" rel="external">基于canvas将图片转化成字符画</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTML5/">HTML5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/video-canvas/">video canvas</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-HTML5 视频直播" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/12/HTML5 视频直播/" class="article-date">
  	<time datetime="2016-07-12T03:51:43.000Z" itemprop="datePublished">2016-07-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/12/HTML5 视频直播/">HTML5 视频直播</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>参考资料：</p>
<ul>
<li><a href="https://imququ.com/post/html5-live-player-1.html" target="_blank" rel="external">HTML5 视频直播（一）</a></li>
<li><a href="https://imququ.com/post/html5-live-player-2.html" target="_blank" rel="external">HTML5 视频直播（二）</a></li>
<li><p><a href="https://imququ.com/post/html5-live-player-3.html" target="_blank" rel="external">HTML5 视频直播（三）</a></p>
</li>
<li><p><a href="http://www.haomou.net/2014/08/04/2014_Html5_canvas_video/" target="_blank" rel="external">WebRTC相关的canvas与video</a></p>
</li>
<li><p><a href="http://www.jianshu.com/p/f198d11577f4" target="_blank" rel="external">字体平滑➕视频转canvas</a></p>
</li>
<li><p><a href="http://www.alloyteam.com/2016/05/h5-camera-literacy/" target="_blank" rel="external">H5视频直播扫盲</a></p>
</li>
<li><a href="https://segmentfault.com/a/1190000000392586" target="_blank" rel="external">使用 WebSockets 进行 HTML5 视频直播</a></li>
<li><a href="https://www.zhihu.com/question/25497090" target="_blank" rel="external">可以用WebRTC来做视频直播吗？</a></li>
<li><a href="http://blog.ucloud.cn/archives/694" target="_blank" rel="external">关于直播，所有的技术细节都在这里了（一）</a></li>
<li><a href="http://blog.ucloud.cn/archives/699" target="_blank" rel="external">关于直播，所有的技术细节都在这里了（二）</a></li>
<li><p><a href="http://blog.ucloud.cn/archives/760" target="_blank" rel="external">关于直播，所有的技术细节都在这里了（三）</a></p>
</li>
<li><p><a href="http://www.jq-school.com/Show.aspx?id=738" target="_blank" rel="external">windows+nginx+ffmpeg实现移动端html5直播m3u8</a></p>
</li>
<li><p><a href="https://github.com/tiantianlan/LiveExplanation" target="_blank" rel="external">直播技术</a></p>
</li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTML5/">HTML5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTML5-视频直播-video-canvas/">HTML5 视频直播 video canvas</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-createJS实战深入解析" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/06/createJS实战深入解析/" class="article-date">
  	<time datetime="2016-07-06T15:51:43.000Z" itemprop="datePublished">2016-07-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/06/createJS实战深入解析/">createJS实战深入解析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="CreateJS简介"><a href="#CreateJS简介" class="headerlink" title="CreateJS简介"></a>CreateJS简介</h2><p>CreateJS 是一套可以构建丰富交互体验的 HTML5 游戏的开源工具包，旨在降低 HTML5 项目的开发难度和成本，让开发者以熟悉的方式打造更具现代感的网络交互体验。</p>
<p>CreateJS中文Github:<a href="https://github.com/CreateJS/" target="_blank" rel="external">https://github.com/CreateJS/</a><br>CreateJS英文版Api:<a href="http://www.createjs.com/" target="_blank" rel="external">http://www.createjs.com/</a><br>CreateJS中文版Api:<a href="http://www.createjs.cc/" target="_blank" rel="external">http://www.createjs.cc/</a></p>
<p>CreateJS 中包含：</p>
<ul>
<li>EaselJS：用于 Sprites、动画、向量和位图的绘制，创建 HTML5 Canvas 上的交互体验（包含多点触控），同时提供 Flash 中的“显示列表”功能。</li>
<li>TweenJS：一个简单的用于制作类似 Flash 中“补间动画”的引擎，可生成数字或非数字的连续变化效果。</li>
<li>SoundJS：一个音频播放引擎，能够根据浏览器性能选择音频播放方式。将音频文件作为模块，可随时加载和卸载。</li>
<li>PrloadJS：帮助你简化网站资源预加载工作，无论加载内容是图形、视频、声音、JS、数据……<br>以上的Createjs介绍来自百度，不过通过介绍可以知道，虽然CreateJS看起来复杂，不过四个部分各有作用，其中最主要的就是EaselJS，其余三项不过是为他服务。</li>
</ul>
<p>开发步骤：<br>1、下载类库，可以使用源代码，也可以使用压缩过的min.js，就好像平时写网页一样。<br>2、建立html和canvas标签，onload后再执行createjs相关逻辑。<br>3、编写createjs逻辑。这个非常简单，因为createjs只提供了最简单的基础功能，我们理解了基础功能后就可以叠积木了。</p>
<p>关于createjs，最关键是要理解类结构</p>
<p><img src="/img/create/create.png" alt="createjs类结构"></p>
<p>上图列出了createjs的主要类结构，所有舞台上的内容都是元件，元件的基类是DisplayObject。Container可以包含子元件，舞台Stage本身也是Container。另外Sprite用于表现SpriteSheet帧动画人物、Bitmap用于展示纯静态的人物。 </p>
<p><img src="/img/create/1.jpg" alt="createjs类结构"></p>
<p> 而Filter和Shadow则是滤镜分支，可以针对任意元件实现颜色变换、模糊、阴影等效果。使用滤镜的方式跟Flash一致，需要新建Filter实例，添加到目标元件的FilterList中，Createjs框架在下一帧就会把该元件加上滤镜效果。</p>
<h2 id="EaselJS部分"><a href="#EaselJS部分" class="headerlink" title="EaselJS部分"></a>EaselJS部分</h2><p>EaselJS所有的功能都是被一个全局类<code>createjs</code>所包含，将其打印大致包含如下（有删减）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">AlphaMapFilter</span><br><span class="line">AlphaMaskFilter</span><br><span class="line">Bitmap   			//位图，用于引入图片  位图类不需要缓存</span><br><span class="line">BitmapText			// 位图中绘制文字</span><br><span class="line">BlurFilter			//模糊滤镜</span><br><span class="line">ButtonHelper</span><br><span class="line">ColorFilter			// 颜色滤镜</span><br><span class="line">ColorMatrix</span><br><span class="line">ColorMatrixFilter</span><br><span class="line">Container</span><br><span class="line">DisplayObject</span><br><span class="line">DisplayProps</span><br><span class="line">DOMElement</span><br><span class="line">EaselJS				//版本信息</span><br><span class="line">Event</span><br><span class="line">EventDispatcher</span><br><span class="line">Filter				//滤镜</span><br><span class="line">Graphics			//绘制各种图形</span><br><span class="line">Matrix2D</span><br><span class="line">MouseEvent       //鼠标事件，用于与用户交互</span><br><span class="line">MovieClip		 //动画剪裁</span><br><span class="line">MovieClipPlugin</span><br><span class="line">Point			//绘制点</span><br><span class="line">Rectangle		//绘制矩形</span><br><span class="line">Shadow			//绘制阴影</span><br><span class="line">Shape			//新建图形图层</span><br><span class="line">Sprite			//帧或帧序列（即动画）</span><br><span class="line">SpriteContainer</span><br><span class="line">SpriteSheet</span><br><span class="line">SpriteSheetBuilder</span><br><span class="line">SpriteSheetUtils</span><br><span class="line">SpriteStage</span><br><span class="line">Stage			//新建舞台</span><br><span class="line">Text			//绘制文本图层</span><br><span class="line">Ticker</span><br><span class="line">Touch			//移动端交互  触摸事件 注册createjs.Touch.enable(stage)  pressup、pressmove</span><br><span class="line">UID				//用于生成序列唯一标识号的全局实用程序</span><br><span class="line">Utility Methods</span><br></pre></td></tr></table></figure>
<p>使用EaselJS基本结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">var stage=new createjs.Stage(&quot;canvas&quot;);</span><br><span class="line">var canvas = new createjs.Stage(&quot;canvas&quot;).canvas;</span><br><span class="line">var container = new createjs.Container();</span><br><span class="line">var ctx = new createjs.Stage(&quot;canvas&quot;).canvas.getContext(&quot;2d&quot;);</span><br><span class="line"></span><br><span class="line">var circle=new createjs.Shape();</span><br><span class="line">circle.graphics.beginFill(&quot;red&quot;).drawCircle(0,0,50);</span><br><span class="line"></span><br><span class="line">//regX,regY向左，向上偏移两，旋转时设置可以让其沿坐标点旋转。</span><br><span class="line">circle.regX = -25;</span><br><span class="line">circle.regY = -25;</span><br><span class="line">circle.x=50;</span><br><span class="line">circle.y=50;</span><br><span class="line"></span><br><span class="line">//增加形状实例显示在舞台列表上</span><br><span class="line">stage.addChild(circle);</span><br><span class="line"></span><br><span class="line">//更新舞台渲染</span><br><span class="line">stage.update();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">stage.addEventListener(&quot;stagemousedown&quot;,function()&#123;</span><br><span class="line">	//控制舞台点击</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">stage.addEventListener(&quot;click&quot;,function()&#123;</span><br><span class="line">	//只能点击舞台上的显示元素才能触发</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//多点触摸功能的设备 pressup,pressmove替换touchstart，touchmove</span><br><span class="line">createjs.Touch.enable(stage);</span><br><span class="line"></span><br><span class="line">//帧频率绘制模式</span><br><span class="line">createjs.Ticker.timingMode = createjs.Ticker.RAF;</span><br><span class="line"></span><br><span class="line">//createjs.Ticker.setFPS(60);</span><br><span class="line"></span><br><span class="line">//获取当前帧频率</span><br><span class="line">createjs.Ticker.getMeasuredFPS()</span><br><span class="line"></span><br><span class="line">stage.addEventListener(&quot;tick&quot;,tick);</span><br></pre></td></tr></table></figure>
<p>1.stagemousedown,stagemouseup,stagemousemove与mousedown,mouseup,mousemove的区别</p>
<blockquote>
<p>(1) stagemousedown,stagemouseup,stagemousemove是针对stage的专属事件<br>(2) mousedown,mouseup,mousemove事件对stage、DisplayObject都可以触发，但针对stage只对舞台上DisplayObject才触发</p>
</blockquote>
<p>2.pressmove、pressup与touchmove,touchend</p>
<blockquote>
<p>(1) 要使用移动端交互，多点触控事件，需先注册createjs.Touch.enable(stage)，开启触摸事件<br>(2) pressmove代替touchmove, pressup代替touchend</p>
</blockquote>
<p>3.DisplayObject中<code>cache</code>提高stage渲染效率<br><code>cache</code>方法其实是把显示对象画到一个新的canvas中，从而每一次stage.update()重绘的时候不用重新渲染了，大大提高效率。<br>通常把一些不经常变化的复杂的显示对象进行<code>cache</code>（比如说有许多子对象的容器或者复杂的Shape），被缓存的显示对象可以移动、旋转、改变透明度。但是被缓存的显示对象的内容变化的话，就要重新调用cache()、updateCahce()、uncache()方法。 </p>
<p>关于cache，<a href="http://createjs.com/#demos/easeljs/cache" target="_blank" rel="external">官网cache例子</a></p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cache ( x  y  width  height  [scale=1] )  //scale默认为1</span><br><span class="line"></span><br><span class="line">前四个参数指定了显示对象要缓存的区域，注意的事x和y的坐标都是根据当前这个显示对象本身的坐标系来计算。 </span><br><span class="line">最后一个参数scale表示在缓存时缩放的比例，比如 myShape.cache(0,0,100,100,2) 这样使用时，缓存出来的结果大小事200*200。</span><br></pre></td></tr></table></figure>
<p>缓存一个圆型的Shape，例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var shape = new createjs.Shape();</span><br><span class="line">shape.graphics.beginFill(&quot;#ff0000&quot;).drawCircle(0, 0, 25);</span><br><span class="line">shape.cache(-25, -25, 50, 50);</span><br></pre></td></tr></table></figure>
<p>使用<code>cache</code>注意关键点：</p>
<blockquote>
<p>1.在<code>displayObject</code>上使用<code>filter</code>，要在调用<code>cache</code>方法之前使用filter<br>2.<code>Bitmap</code>对象中使用<code>cache</code>，普通<code>bitmap</code>不要调用<code>cache</code>方法，如果bitmap要使用滤镜<code>filter</code>的话，一定要调用<code>cache</code><br>3.在<code>Sprite</code>对象中，<code>Sprite</code>已经是光栅格式，对于<code>Sprite</code>实例来说<code>cache</code>没有必要。不要为提高性能来调用<code>Sprite</code>的<code>cache</code></p>
</blockquote>
<p>4.DisplayObject中<code>scale</code>、<code>rotation</code>中心点，通过regX,regY偏移，定位到相对<code>DisplayObject</code>坐标点</p>
<blockquote>
<p>例如,让一个100 x100px位图旋转中心,您将设置regX regY 50</p>
</blockquote>
<p>5.Ticker处理帧频率</p>
<p>Ticker类为游戏开发提供了一个主要的定时类,主要的目的就是把stage渲染的工作集中起来，也就是说定时调用stage.update()这个方法。Ticker设置的频率也就是游戏的帧数了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">createjs.Ticker.setFPS(60);</span><br><span class="line">createjs.Ticker.addEventListener(&quot;tick&quot;, handleTick);</span><br><span class="line">stage.addEventListener(&quot;stagemousedown&quot;, function(event)&#123;</span><br><span class="line">    createjs.Ticker.setPaused(!createjs.Ticker.getPaused());</span><br><span class="line">&#125;);</span><br><span class="line">function handleTick(event)&#123;</span><br><span class="line">	if(!event.paused)&#123;</span><br><span class="line">	  ……</span><br><span class="line">	&#125;</span><br><span class="line">	stage.update();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">在侦听函数中event的数据 </span><br><span class="line">1.event.paused 表示ticker是否处于暂停状态 </span><br><span class="line">2.event.delta 在上一次tick事件之后到这次事件的时间间隔，以毫秒为单位。 </span><br><span class="line">3.event.time 在Ticker被初始化以后的时间总和，以毫秒为单位。 </span><br><span class="line">4.event.runTime 在Ticker被初始化以后没有暂停的时间总和，以毫秒为单位。</span><br></pre></td></tr></table></figure>
<p>Ticker常用属性和方法：<br>1.paused 在ticker暂停时，所有的侦听器仍然会接受到tick事件，但是事件中的paused会是true（createjs.Ticker.paused = true）；<br>2.timingMode指定tick的timing模式。一共有三种模式，TIMEOUT、RAF和RAF_SYNCHEN。<br>（1）TIMEOUT，这种模式下使用的就是setTimeOut这个方法实现的。是timingMode的默认模式。<br>（2）RAF 在这个模式下使用requestAnimationFrame，完全忽略Ticker的帧频。如果requestAnimationFrame API不支持的话就用TIMEOUT模式。<br>（3）RAF_SYNCHEN 在这个模式下使用requestAnimationFrame，但是试图与ticker的帧频同步。如果requestAnimationFrame API不支持的话就用TIMEOUT模式。<br>3.getMeasuredFPS() 获得当前的实际帧频。<br>4.getMeasuredTickTime 获得平均一次tick所有的时间，大概就是在这一次tick所用的时间。</p>
<h2 id="PrloadJS部分"><a href="#PrloadJS部分" class="headerlink" title="PrloadJS部分"></a>PrloadJS部分</h2><p>PreloadJS是一个用来管理和协调相关资源加载的类库，它可以方便的帮助你预先加载相关资源。当我们打印PreloadJS对象，发现主要提供以下类：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">AbstractLoader</span><br><span class="line">AbstractMediaLoader</span><br><span class="line">AbstractRequest</span><br><span class="line">BinaryLoader  //二进制文件的加载</span><br><span class="line">CSSLoader	  //CSS文件的加载</span><br><span class="line">DataUtils</span><br><span class="line">DomUtils</span><br><span class="line">ImageLoader</span><br><span class="line">JavaScriptLoader</span><br><span class="line">JSONLoader   	//加载JSON</span><br><span class="line">JSONPLoader		//要加载JSON跨域，使用JSONP和 JSONPLoader 代替</span><br><span class="line">LoadItem</span><br><span class="line">LoadQueue   //加载管理器，可以预先加载一个文件或者一个文件队列</span><br><span class="line">ManifestLoader</span><br><span class="line">MediaTagRequest</span><br><span class="line">PreloadJS</span><br><span class="line">ProgressEvent</span><br><span class="line">RequestUtils</span><br><span class="line">SamplePlugin</span><br><span class="line">SoundLoader</span><br><span class="line">SpriteSheetLoader</span><br><span class="line">SVGLoader		//加载svg</span><br><span class="line">TagRequest</span><br><span class="line">TextLoader</span><br><span class="line">VideoLoader</span><br><span class="line">XHRRequest</span><br><span class="line">XMLLoader</span><br><span class="line">```	</span><br><span class="line">LoadQueue类，应该来说平时使用比较多，这里就主要聊聊LoadQueue。</span><br><span class="line"></span><br><span class="line">LoadQueue 类</span><br><span class="line">LoadQueue类是预加​​载内容的主要API。 LoadQueue是负载管理器，它可以预载是单个文件或文件的队列。</span><br><span class="line"></span><br><span class="line">LoadQueue包含了几个可以订阅的事件：</span><br><span class="line"></span><br><span class="line">- complete: 当队列完成加载所有文件时。</span><br><span class="line">- error: 当队列与任何文件遇到错误时。</span><br><span class="line">- progress: 对于整个队列进展已经改变。</span><br><span class="line">- fileload: 单个文件已完成加载。</span><br><span class="line">- fileprogress: 单个文件进度变化。注意,只有文件装载XHR(或可能通过插件)将 file 事件进展除了0或100%。</span><br><span class="line"></span><br><span class="line">LoadQueue支持相关文件类型如下：</span><br><span class="line"></span><br><span class="line">- BINARY: XHR调用的二进制文件</span><br><span class="line">- CSS: CSS文件</span><br><span class="line">- IMAGE: 一般图片文件格式</span><br><span class="line">- JAVASCRIPT: JavaScript文件</span><br><span class="line">- JSON: JSON数据</span><br><span class="line">- JSONP: 跨域JSON文件</span><br><span class="line">- MANIFEST: JSON格式的文件列表</span><br><span class="line">- SOUND: 音频文件</span><br><span class="line">- SVG: SVG文件</span><br><span class="line">- TEXT: 文本文件 - 仅支持XHR</span><br><span class="line">- XML: XML数据</span><br></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var queue = new createjs.LoadQueue(true); //LoadQueue ( [preferXHR=true]  [basePath=&quot;&quot;]  [crossOrigin=&quot;&quot;] )</span><br><span class="line"></span><br><span class="line">queue.loadManifest([&#123;</span><br><span class="line">    id: &quot;guide&quot;,</span><br><span class="line">    src: &quot;images/guide.png&quot;</span><br><span class="line">  &#125;&#125;]);</span><br><span class="line"></span><br><span class="line">queue.on(&quot;fileload&quot;, handleFileLoad, this);</span><br><span class="line">queue.on(&quot;complete&quot;, handleComplete, this);</span><br><span class="line">queue.on(&quot;progress&quot;, handleProgress, this);</span><br><span class="line"></span><br><span class="line">function handleComplete()&#123;</span><br><span class="line">	queue.getResult(‘id’);</span><br><span class="line">&#125;</span><br><span class="line">function handleProgress(event) &#123;</span><br><span class="line">  console.log(event.progress * 100)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>LoadQueue支持相关文件类型如下：</p>
<ul>
<li><p>预加载音频文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//初始化插件</span><br><span class="line"> queue.installPlugin(createjs.Sound);</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置加载路径<br>注意，第一个参数为true，代表通过xhr形式加载，但是通常，我们可能需要http加载，所以建议设置为false，以免造成重复加载。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var queue = new createjs.LoadQueue(false,&quot;./base/src/&quot;); //LoadQueue ( [preferXHR=true]  [basePath=&quot;&quot;]  [crossOrigin=&quot;&quot;] )</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取加载进度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event.progress</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取预加载资源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preload.getResult(‘id’);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="TweenJS部分"><a href="#TweenJS部分" class="headerlink" title="TweenJS部分"></a>TweenJS部分</h2><p>TweenJS Javascript库提供了一个简单但强大的渐变界面。它支持渐变的数字对象属性&amp;CSS样式属性,并允许您链接补间动画和行动结合起来,创造出复杂的序列。其中主要包含如下类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CSSPlugin   //用css的方式写动画，但是它采用的形式是html，效率低下</span><br><span class="line">Ease		//提供支持贝塞尔动画</span><br><span class="line">MotionGuidePlugin   //轨迹动画插件</span><br><span class="line">SamplePlugin</span><br><span class="line">Timeline</span><br><span class="line">Tween  </span><br><span class="line">TweenJS</span><br></pre></td></tr></table></figure>
<p>Tween构造函数:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tween ( target  [props]  [pluginData] )</span><br></pre></td></tr></table></figure></p>
<p>参数</p>
<ul>
<li>target对象: 将其属性渐变的目标对象</li>
<li><p>[props] 对象: 适用于这个渐变实例的配置属性(ex. {loop:true, paused:true}. 所有属性默认为false. 被支持的小道具是:<br>(1)loop: 设置循环属性渐变，true为循环，false为不循环.<br>(2)useTicks: 使用嘀嗒走针是因为持续时间而不是毫秒.<br>(3)ignoreGlobalPause: 设置在渐变动画上 ignoreGlobalPause 属性.<br>(4)override:如果设置为true,Tween.removeTweens(target) 将被称为移除相同目标的所有别的渐变动画.<br>(5)paused: 指示是否开始停止渐变动画.<br>(6)position: 表明这个渐变的初始位置.<br>(7)onChange: 指定一个“change”事件侦听器.</p>
</li>
<li><p>[pluginData] 对象(可选的):一个对象包含的数据供安装使用插件。有关详细信息,请参阅个别插件的文档.</p>
</li>
</ul>
<p>Tween实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">target.alpha = 1;</span><br><span class="line">   createjs.Tween.get(target, &#123;override:true&#125;) //多个渐变动画可以指向相同的实例,然而如果他们影响相同的属性可能会有意外行为. 需要停止所有的渐变动画, 使用 removeTweens 或者通过 override:true</span><br><span class="line">   .to(&#123;alpha:0.5,x:10,y:20&#125;, 1000, createjs.Ease.linear)</span><br><span class="line">   .wait(500)</span><br><span class="line">   .call(handleComplete)</span><br><span class="line">   .to(&#123;alpha:0, visible:false&#125;, 1000, createjs.Ease.bounceInOut)</span><br><span class="line">   .addEventListener(&quot;change&quot;,handleChange)</span><br><span class="line"></span><br><span class="line">   function handleComplete() &#123;</span><br><span class="line">   //Tween complete</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>get 获取目标元素</li>
<li>to 执行动画</li>
<li>wait 队列等待</li>
<li>call 执行回调函数</li>
<li>createjs.Ease.bounceInOut 缓动效果</li>
<li>change  订阅 change 事件以便当目标的属性改变时获得通知</li>
</ul>
<p>使用Ease可以控制运动的轨迹，实现曲线的运动，还可以控制运动过程，比如先加速再减速等，在Tweenjs官方示例中有两个可以用来观察Ease提供的各个参数对运动过程产生的影响，<br><a href="http://andysaia.com/blog/tweenjs/" target="_blank" rel="external">http://andysaia.com/blog/tweenjs/</a><br><a href="http://www.createjs.com/demos/tweenjs/tween_sparktable" target="_blank" rel="external">http://www.createjs.com/demos/tweenjs/tween_sparktable</a></p>
<p>参考资料：</p>
<ul>
<li><a href="http://www.createjs.cc/" target="_blank" rel="external">createjs中文api</a></li>
<li><a href="http://blog.csdn.net/lanix516/article/details/47261225" target="_blank" rel="external">如何使用Createjs来编写HTML5游戏（一）EaselJS简介</a></li>
<li><a href="http://blog.csdn.net/lanix516/article/details/47282073" target="_blank" rel="external">如何使用Createjs来编写HTML5游戏（二）使用EaselJS处理图片</a></li>
<li><a href="http://blog.csdn.net/lanix516/article/details/47302309" target="_blank" rel="external">如何使用Createjs来编写HTML5游戏（三）使用EaselJS中的制作Sprite类制作</a></li>
<li><a href="http://blog.csdn.net/lanix516/article/details/47323573" target="_blank" rel="external">如何使用Createjs来编写HTML5游戏（四）TweenJS和Tick动画</a></li>
<li><a href="http://blog.csdn.net/lanix516/article/details/47326093" target="_blank" rel="external">如何使用Createjs来编写HTML5游戏（五）PreloadJS和SoundJS</a></li>
<li><a href="http://blog.csdn.net/lanix516/article/details/47357747" target="_blank" rel="external">如何使用Createjs来编写HTML5游戏（六）完成一个简单的打飞机游戏（上）</a></li>
<li><a href="http://blog.csdn.net/lanix516/article/details/47382401" target="_blank" rel="external">如何使用Createjs来编写HTML5游戏（七）完成一个简单的打飞机游戏（下）</a></li>
<li><a href="http://blog.csdn.net/lanix516/article/details/47402499" target="_blank" rel="external">如何使用Createjs来编写HTML5游戏（八） 通过继承扩展EaselJS中的基础元素</a></li>
<li><a href="http://blog.csdn.net/k_shl_2011/article/category/5666125" target="_blank" rel="external">createjs教程</a></li>
</ul>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PreloadJS-EaselJS-TweenJS-SoundJS/">PreloadJS EaselJS TweenJS SoundJS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/createJS/">createJS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 pfan
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a>
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>