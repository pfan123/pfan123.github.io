<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>pfan博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="pfan博客 新起点，新高度">
<meta property="og:type" content="website">
<meta property="og:title" content="pfan博客">
<meta property="og:url" content="http://pfan123.github.io/index.html">
<meta property="og:site_name" content="pfan博客">
<meta property="og:description" content="pfan博客 新起点，新高度">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="pfan博客">
<meta name="twitter:description" content="pfan博客 新起点，新高度">
  
    <link rel="alternative" href="/atom.xml" title="pfan博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://litten.github.io/assets/blogImg/litten.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">pfan</a></h1>
		</hgroup>

		
		<p class="header-subtitle">新起点，新高度</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>		
					
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>A propos</li>
						
					</ul>
				</div>

			</div>
		


		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
				        	<li class = "article_cate_tit"> 文章分类</li>
				        	<li class = "article_cate_a"> <a  href = "/categories/技术杂谈/">技术杂谈</a>	</li>
				        	<li class = "article_cate_a"> <a href = "/categories/兴趣爱好/">兴趣爱好</a>		</li>
				        	<li class = "article_cate_a"> <a href = "/categories/日志/">日志</a></li>
				        	<li class = "article_cate_a"> <a href = "/categories/JavaScript/">JavaScript</a>	</li>
				        	<li class = "article_cate_a"> <a  href = "/categories/CSS3/">CSS3</a>	</li>
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/pfan123" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/gaolu1990/home?wvr=5" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>



				<style type="text/css">
					.article_cate_tit{
						color:#ba8f6c;
						margin-top:6px;
					}
					.article_cate_con a{
						display:block;
						font-size:12px;
						text-align:center;
						margin:4px 0;
					}
					#header .header-menu{
						line-height:21px;
					}
					.article_cate_a{
						line-height:18px !important;
					}	
					.article_cate_a a{
						font-size:12px !important;
					}				
					#container .left-col .overlay{
						height:130px;
					}
					.header-nav{
						top:160px;
					}
				</style>	
				<!-- E 新增模块-->
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/gitignore-git/" style="font-size: 10px;">.gitignore git</a> <a href="/tags/htaccess-配置二级域名-绑定子目录/" style="font-size: 10px;">.htaccess  配置二级域名  绑定子目录</a> <a href="/tags/AMD/" style="font-size: 10px;">AMD</a> <a href="/tags/CMD/" style="font-size: 10px;">CMD</a> <a href="/tags/CSS-BEM-OOCSS/" style="font-size: 10px;">CSS BEM OOCSS</a> <a href="/tags/CSS动画篇/" style="font-size: 10px;">CSS动画篇</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/ESLint/" style="font-size: 10px;">ESLint</a> <a href="/tags/Git，Git查看历史记录/" style="font-size: 10px;">Git，Git查看历史记录</a> <a href="/tags/H5/" style="font-size: 10px;">H5</a> <a href="/tags/H5-视频直播-video/" style="font-size: 10px;">H5 视频直播 video</a> <a href="/tags/H5全景、CSS3d、perspective/" style="font-size: 15px;">H5全景、CSS3d、perspective</a> <a href="/tags/HLS、RTMP协议/" style="font-size: 10px;">HLS、RTMP协议</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/HTML5-视频直播-video-canvas/" style="font-size: 10px;">HTML5 视频直播 video canvas</a> <a href="/tags/HTML5、localstorage、sessionStorage/" style="font-size: 10px;">HTML5、localstorage、sessionStorage</a> <a href="/tags/HTML、XML解析、dom-level、htmlparser2、xmldom、sax-js、cheerio/" style="font-size: 10px;">HTML、XML解析、dom level、htmlparser2、xmldom、sax-js、cheerio</a> <a href="/tags/HTTP、-node-http-proxy、-nginx、-proxy/" style="font-size: 15px;">HTTP、 node-http-proxy、 nginx、 proxy</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Linux、CentOS/" style="font-size: 10px;">Linux、CentOS</a> <a href="/tags/Linux、UNIX/" style="font-size: 10px;">Linux、UNIX</a> <a href="/tags/Linux、Unix/" style="font-size: 20px;">Linux、Unix</a> <a href="/tags/Linux、Unix、nvm、node/" style="font-size: 10px;">Linux、Unix、nvm、node</a> <a href="/tags/Mac-命令-Terminal-osx/" style="font-size: 10px;">Mac 命令 Terminal osx</a> <a href="/tags/Mac、root/" style="font-size: 10px;">Mac、root</a> <a href="/tags/Math-atan-、Math-atan2-斜率/" style="font-size: 10px;">Math.atan()、Math.atan2() 斜率</a> <a href="/tags/Mongoose参考手册-MongoDB-数据库-node/" style="font-size: 10px;">Mongoose参考手册  MongoDB  数据库 node</a> <a href="/tags/Nginx-负载均衡/" style="font-size: 10px;">Nginx  负载均衡</a> <a href="/tags/Nginx-负载均衡-node-jdc-解决方案-host/" style="font-size: 10px;">Nginx  负载均衡 node  jdc 解决方案 host</a> <a href="/tags/Nginx-Mac-Node/" style="font-size: 10px;">Nginx Mac Node</a> <a href="/tags/Nginx-MySQL-PHP-FPM-Mac-OS/" style="font-size: 10px;">Nginx MySQL PHP-FPM Mac OS</a> <a href="/tags/Nodejs学习实践-nodejs-ES6/" style="font-size: 10px;">Nodejs学习实践 nodejs  ES6</a> <a href="/tags/PreloadJS-EaselJS-TweenJS-SoundJS/" style="font-size: 10px;">PreloadJS EaselJS TweenJS SoundJS</a> <a href="/tags/SVG-Sprites-Symbols/" style="font-size: 10px;">SVG Sprites Symbols</a> <a href="/tags/SVG-icon、-导出优化/" style="font-size: 10px;">SVG icon、 导出优化</a> <a href="/tags/SVG、dataURI、base64/" style="font-size: 10px;">SVG、dataURI、base64</a> <a href="/tags/UMD/" style="font-size: 10px;">UMD</a> <a href="/tags/Vim-vi/" style="font-size: 10px;">Vim vi</a> <a href="/tags/Webhook，git/" style="font-size: 10px;">Webhook，git</a> <a href="/tags/Webhook，git，-Git-Hooks/" style="font-size: 10px;">Webhook，git， Git Hooks</a> <a href="/tags/createJS/" style="font-size: 10px;">createJS</a> <a href="/tags/css-modules-scope-模块化/" style="font-size: 10px;">css modules  scope  模块化</a> <a href="/tags/device-width-window-screen-width-区分ip6与ip6plus/" style="font-size: 10px;">device-width window.screen.width 区分ip6与ip6plus</a> <a href="/tags/deviceorientation、orientationchange-重力感应/" style="font-size: 10px;">deviceorientation、orientationchange 重力感应</a> <a href="/tags/deviceorientation、orientationchange-重力感应-CSS3D/" style="font-size: 10px;">deviceorientation、orientationchange 重力感应 CSS3D</a> <a href="/tags/express/" style="font-size: 10px;">express</a> <a href="/tags/fiddler/" style="font-size: 10px;">fiddler</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/hexo初始/" style="font-size: 10px;">hexo初始</a> <a href="/tags/hexo相关问题/" style="font-size: 10px;">hexo相关问题</a> <a href="/tags/howler-js、-video-js/" style="font-size: 10px;">howler.js、 video.js</a> <a href="/tags/insertAdjacentHTML方法/" style="font-size: 10px;">insertAdjacentHTML方法</a> <a href="/tags/insertAdjacentText方法/" style="font-size: 10px;">insertAdjacentText方法</a> <a href="/tags/javascript、canvas、toDataURL/" style="font-size: 10px;">javascript、canvas、toDataURL()</a> <a href="/tags/letsencrypt、HTTPS、SSL、TSL/" style="font-size: 10px;">letsencrypt、HTTPS、SSL、TSL</a> <a href="/tags/mac-iphone-铃声/" style="font-size: 10px;">mac iphone 铃声</a> <a href="/tags/node-版本管理-nvm-n/" style="font-size: 10px;">node 版本管理  nvm  n</a> <a href="/tags/node-读写excel-JS-XLSX-分析excel写入/" style="font-size: 10px;">node 读写excel JS-XLSX 分析excel写入</a> <a href="/tags/pm2学习实践-nodejs-pm2/" style="font-size: 10px;">pm2学习实践 nodejs pm2</a> <a href="/tags/react-flux-redux-ECMAScript6-Vue-Angular-Angular2-0-NuclearJS/" style="font-size: 10px;">react flux redux ECMAScript6 Vue Angular Angular2.0 NuclearJS</a> <a href="/tags/ssh常用命令-SSH/" style="font-size: 10px;">ssh常用命令  SSH</a> <a href="/tags/svg、path、circle、rect、ellipse、polygon、polyline、line/" style="font-size: 10px;">svg、path、circle、rect、ellipse、polygon、polyline、line</a> <a href="/tags/video-canvas/" style="font-size: 10px;">video canvas</a> <a href="/tags/vue-router-vue/" style="font-size: 10px;">vue-router, vue</a> <a href="/tags/webp/" style="font-size: 10px;">webp</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/三角学、弧度、角度/" style="font-size: 10px;">三角学、弧度、角度</a> <a href="/tags/买房前必备知识-house-home/" style="font-size: 10px;">买房前必备知识  house home</a> <a href="/tags/买车前必备知识-car/" style="font-size: 10px;">买车前必备知识  car</a> <a href="/tags/京东购物H5活动CP重构规范/" style="font-size: 10px;">京东购物H5活动CP重构规范</a> <a href="/tags/优化JavaScript的执行效率/" style="font-size: 10px;">优化JavaScript的执行效率</a> <a href="/tags/前端性能优化/" style="font-size: 10px;">前端性能优化</a> <a href="/tags/吉他/" style="font-size: 10px;">吉他</a> <a href="/tags/吉他知识/" style="font-size: 10px;">吉他知识</a> <a href="/tags/学吉他知识集锦/" style="font-size: 10px;">学吉他知识集锦</a> <a href="/tags/搬瓦工，Shadowsocks/" style="font-size: 10px;">搬瓦工，Shadowsocks</a> <a href="/tags/旅游-帝都畅游-相约北京/" style="font-size: 10px;">旅游 帝都畅游 相约北京</a> <a href="/tags/模块的写法/" style="font-size: 10px;">模块的写法</a> <a href="/tags/运营规范/" style="font-size: 10px;">运营规范</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/pingfan1990/">博客园博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.w3cfuns.com/house.php">前端网博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://pingfan1990.sinaapp.com/">pfan展示平台</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://doc.pfan123.com/">pfan前端开发导航平台</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">因上努力，果上随缘</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">pfan</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://litten.github.io/assets/blogImg/litten.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">pfan</h1>
			</hgroup>
			
			<p class="header-subtitle">新起点，新高度</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/pfan123" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/gaolu1990/home?wvr=5" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-Webhook 实践" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/03/10/Webhook 实践/" class="article-date">
  	<time datetime="2017-03-10T02:00:21.000Z" itemprop="datePublished">2017-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/10/Webhook 实践/">Webhook 进行网站自动化部署</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Webhook-是什么？"><a href="#Webhook-是什么？" class="headerlink" title="Webhook 是什么？"></a>Webhook 是什么？</h2><p><a href="https://developer.github.com/webhooks/" target="_blank" rel="external">Webhook</a>，也就是人们常说的钩子，是一个很有用的工具。Webhook 允许第三方应用监听 Github.com 上的特定事件，在这些事件发生时通过 HTTP POST 方式通知( 超时5秒) 到第三方应用指定的 Web URL。 例如项目有新的内容 Push，或是 Merge Request 有更新等。 WebHook 可方便用户实现自动部署，自动测试，自动打包，监控项目变化等。</p>
<p>如此一来，可以通过这种方式去自动完成一些重复性工作；比如，用 Webhook 来自动触发一些持续集成（CI）工具的运作，比如 <a href="https://github.com/integrations/travis-ci" target="_blank" rel="external">Travis CI</a>；又或者是通过 Webhook 去部署你的线上服务器。</p>
<h2 id="Webhook使用场景"><a href="#Webhook使用场景" class="headerlink" title="Webhook使用场景"></a>Webhook使用场景</h2><p>实际工作中，经常有这样的场景，本地提交代码到git仓库以后需要网站远程自动同步代码, 大概流程如下图： </p>
<p><img src="http://img.pfan123.com/webhook1.png" alt="Webhook"></p>
<h2 id="Webhook自动化部署"><a href="#Webhook自动化部署" class="headerlink" title="Webhook自动化部署"></a>Webhook自动化部署</h2><p>1.为了响应 Webhook 发出的请求，从而做一些我们想做的事情，我们得先实现一个响应服务器。本文采用 Node 来实现一个原型，你当然也可以用 PHP，python 等， 这里使用了<a href="https://github.com/rvagg/github-webhook-handler" target="_blank" rel="external">github-webhook-handler</a>插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&apos;http&apos;)</span><br><span class="line">const createHandler = require(&apos;github-webhook-handler&apos;)</span><br><span class="line">const handler = createHandler(&#123; path: &apos;/webhook&apos;, secret: &apos;myhashsecret&apos; &#125;)</span><br><span class="line">const exec = require(&apos;child_process&apos;).exec</span><br><span class="line"></span><br><span class="line">var commands = [</span><br><span class="line">  &apos;cd .././blog&apos;,</span><br><span class="line">  &apos;git clean -df&apos;,</span><br><span class="line">  &apos;git pull&apos;</span><br><span class="line">].join(&apos; &amp;&amp; &apos;)</span><br><span class="line"></span><br><span class="line">http.createServer(function (req, res) &#123;</span><br><span class="line">  console.log(req.url)</span><br><span class="line">  handler(req, res, function (err) &#123;</span><br><span class="line">    res.statusCode = 404</span><br><span class="line">    res.end(&apos;no such location&apos;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).listen(7777)</span><br><span class="line"></span><br><span class="line">handler.on(&apos;error&apos;, function (err) &#123;</span><br><span class="line">  console.error(&apos;Error:&apos;, err.message)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">handler.on(&apos;push&apos;, function (event) &#123;</span><br><span class="line">  console.log(&apos;Received a push event for %s to %s&apos;,</span><br><span class="line">    event.payload.repository.name,</span><br><span class="line">    event.payload.ref)</span><br><span class="line"></span><br><span class="line">    //执行通关exec做操作，也可以尝试用sh脚本</span><br><span class="line">    exec(commands, function (error, stdout, stderr) &#123;</span><br><span class="line">      if (error) &#123;</span><br><span class="line">        console.log(error.stack);</span><br><span class="line">        console.log(&apos;Error code: &apos; + error.code);</span><br><span class="line">      &#125;</span><br><span class="line">      console.log(&apos;博客更新 deploy&apos;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">handler.on(&apos;issues&apos;, function (event) &#123;</span><br><span class="line">  console.log(&apos;Received an issue event for %s action=%s: #%d %s&apos;,</span><br><span class="line">    event.payload.repository.name,</span><br><span class="line">    event.payload.action,</span><br><span class="line">    event.payload.issue.number,</span><br><span class="line">    event.payload.issue.title)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>例如  <code>deploy.sh</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//执行通关exec做操作，也可以尝试用sh脚本</span><br><span class="line">exec(&apos;sh deploy.sh&apos;, function (error, stdout, stderr) &#123;</span><br><span class="line">  if (error) &#123;</span><br><span class="line">    console.log(error.stack);</span><br><span class="line">    console.log(&apos;Error code: &apos; + error.code);</span><br><span class="line">  &#125;</span><br><span class="line">  console.log(&apos;博客更新 deploy&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"> </span><br><span class="line">WEB_PATH=&apos;/www/blog/&apos;</span><br><span class="line"> </span><br><span class="line">echo &quot;Start deployment&quot;</span><br><span class="line"></span><br><span class="line">cd $WEB_PATH</span><br><span class="line">echo &quot;pulling source code...&quot;</span><br><span class="line">git reset --hard origin/master</span><br><span class="line">git clean -f</span><br><span class="line">git pull</span><br><span class="line">git checkout master</span><br><span class="line">echo &quot;Finished.&quot;</span><br></pre></td></tr></table></figure>
<h2 id="配置-Webhook"><a href="#配置-Webhook" class="headerlink" title="配置 Webhook"></a>配置 Webhook</h2><p>Webhook 的配置是十分简单的，首先进入你的 repo 主页，通过点击页面上的按钮 [settings] -&gt; [Webhooks &amp; service] 进入 Webhooks 配置主页面。也可以通过下面这个链接直接进入配置页面：</p>
<p><img src="http://img.pfan123.com/webhook2.png" alt="Webhook"></p>
<p>配置好 Webhook 后，Github 会发送一个 ping 来测试这个地址。如果成功了，那么这个 Webhook 前就会加上一个绿色的勾；如果你得到的是一个红色的叉，那就好好检查一下哪儿出问题了吧！</p>
<p><img src="http://img.pfan123.com/webhook3.png" alt="Webhook"></p>
<p>参考资料：</p>
<p><a href="https://developer.github.com/webhooks/" target="_blank" rel="external">Webhook</a></p>
<p><a href="https://coding.net/help/doc/git/webhook.html" target="_blank" rel="external">coding Webhook</a></p>
<p><a href="https://github.com/rvagg/github-webhook-handler" target="_blank" rel="external">github-webhook-handler</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webhook，git/">Webhook，git</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-使用 letsencrypt 生成SSL证书开启https" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/03/10/使用 letsencrypt 生成SSL证书开启https/" class="article-date">
  	<time datetime="2017-03-10T02:00:21.000Z" itemprop="datePublished">2017-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/10/使用 letsencrypt 生成SSL证书开启https/">使用 letsencrypt 生成 SSL 证书开启 HTTPS</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="HTTP-和-HTTPS-是什么？"><a href="#HTTP-和-HTTPS-是什么？" class="headerlink" title="HTTP 和 HTTPS 是什么？"></a>HTTP 和 HTTPS 是什么？</h2><p>　 HTTP 是一个传输网页内容的协议，比如你看到的 http 开头的网站 <a href="http://yun.pfan123.com" target="_blank" rel="external">http://yun.pfan123.com</a>，其网页上的文字、图片、CSS、JS 等文件都是通过 http 协议传输到我们浏览器的。</p>
<p>HTTPS（全称：Hyper Text Transfer Protocol over Secure Socket Layer），是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。</p>
<h2 id="SSL-TLS-是什么？"><a href="#SSL-TLS-是什么？" class="headerlink" title="SSL/TLS 是什么？"></a>SSL/TLS 是什么？</h2><p>SSL是一个介于HTTP协议与TCP之间的一个可选层，其位置大致如下:</p>
<p><img src="http://img.pfan123.com/https_ssl.png" alt="svg基本形状"></p>
<ul>
<li><p>SSL：（Secure Socket Layer，安全套接字层），为Netscape所研发，用以保障在Internet上数据传输之安全，利用数据加密(Encryption)技术，可确保数据在网络上之传输过程中不会被截取。当前版本为3.0，它已被广泛地用于Web浏览器与服务器之间的身份认证和加密数据传输。<br>SSL协议位于TCP/IP协议与各种应用层协议之间，为数据通讯提供安全支持。SSL协议可分为两层： SSL记录协议（SSL Record Protocol）：它建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持。 SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。</p>
</li>
<li><p>TLS：(Transport Layer Security，传输层安全协议)，用于两个应用程序之间提供保密性和数据完整性。<br>TLS 1.0是IETF（Internet Engineering Task Force，Internet工程任务组）制定的一种新的协议，它建立在SSL 3.0协议规范之上，是SSL 3.0的后续版本，可以理解为SSL 3.1，它是写入了 RFC 的。该协议由两层组成： TLS 记录协议（TLS Record）和 TLS 握手协议（TLS Handshake）。较低的层为 TLS 记录协议，位于某个可靠的传输协议（例如 TCP）上面。</p>
</li>
</ul>
<p>SSL/TLS协议提供的服务主要有：</p>
<ul>
<li>1.认证用户和服务器，确保数据发送到正确的客户机和服务器；</li>
<li>2.加密数据以防止数据中途被窃取；</li>
<li>3.维护数据的完整性，确保数据在传输过程中不被改变。</li>
</ul>
<h2 id="HTTPS与HTTP的一些区别"><a href="#HTTPS与HTTP的一些区别" class="headerlink" title="HTTPS与HTTP的一些区别"></a>HTTPS与HTTP的一些区别</h2><p>1.HTTPS协议需要到CA申请证书，一般免费证书很少，需要交费，免费的推荐可以使用 <a href="http://letsencrypt.readthedocs.io/en/latest/using.html#getting-certificates-and-choosing-plugins" target="_blank" rel="external">letsencrypt</a>。<br>2.HTTP协议运行在TCP之上，所有传输的内容都是明文，HTTPS运行在SSL/TLS之上，SSL/TLS运行在TCP之上，所有传输的内容都经过加密的。<br>3.HTTP和HTTPS使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。<br>4.HTTPS可以有效的防止运营商劫持，解决了防劫持的一个大问题。</p>
<h2 id="如何HTTPS部署改造"><a href="#如何HTTPS部署改造" class="headerlink" title="如何HTTPS部署改造"></a>如何HTTPS部署改造</h2><p>一个网站要全站由HTTP替换成HTTPS，可能需要关注以下几点：</p>
<ul>
<li>1.安装CA证书，一般的证书都是需要收费的，这边推荐一个比较好的购买证书网站：1）<a href="https://letsencrypt.org/" target="_blank" rel="external">Let’s Encrypt</a>，免费，快捷，支持多域名（不是通配符），三条命令即时签署+导出证书。2）Comodo PositiveSSL，收费，但是比较稳定。</li>
<li>2.在购买证书之后，在证书提供的网站上配置自己的域名，将证书下载下来之后，配置自己的web服务器，同时进行代码改造。</li>
<li>3.HTTPS 降低用户访问速度。SSL握手，HTTPS 对速度会有一定程度的降低，但是只要经过合理优化和部署，HTTPS 对速度的影响完全可以接受。在很多场景下，HTTPS 速度完全不逊于 HTTP，如果使用 SPDY，HTTPS 的速度甚至还要比 HTTP 快。</li>
<li>4.相对于HTTPS降低访问速度，其实更需要关心的是服务器端的CPU压力，HTTPS中大量的密钥算法计算，会消耗大量的CPU资源，只有足够的优化，HTTPS 的机器成本才不会明显增加。</li>
</ul>
<h2 id="Let’s-Encrypt-介绍"><a href="#Let’s-Encrypt-介绍" class="headerlink" title="Let’s Encrypt 介绍"></a>Let’s Encrypt 介绍</h2><p><a href="https://letsencrypt.org/" target="_blank" rel="external">Let’s Encrypt</a> 是一个免费、开放，自动化的证书颁发机构，由 ISRG（Internet Security Research Group）运作。</p>
<p>ISRG 是一个关注网络安全的公益组织，其赞助商从非商业组织到财富100强公司都有，包括 Mozilla、Akamai、Cisco、Facebook，密歇根大学等等。ISRG 以消除资金，技术领域的障碍，全面推进加密连接成为互联网标配为自己的使命。</p>
<p>申请 Let’s Encrypt 证书不但免费，还非常简单，虽然每次只有 90 天的有效期，但可以通过<a href="https://certbot.eff.org/" target="_blank" rel="external">certbot</a>脚本定期更新，  Let’s Encrypt有了<a href="https://github.com/certbot/certbot" target="_blank" rel="external">certbot</a>自动化工具，配置管理起来非常容易。</p>
<p><img src="http://img.pfan123.com/https_certbot.png" alt=" certbot生成证书 "></p>
<p>1.下载安装 <code>certbot</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.eff.org/certbot-auto</span><br><span class="line">chmod a+x certbot-auto</span><br></pre></td></tr></table></figure>
<p><img src="http://img.pfan123.com/https_certbot1.png" alt=" certbot生成证书 "></p>
<p>2.获取CA申请证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./certbot-auto certonly</span><br></pre></td></tr></table></figure>
<p><img src="http://img.pfan123.com/https_certbot2.png" alt=" certbot生成证书 "></p>
<p>3.查看 <code>fullchain.pem</code> 和 <code>privkey.pem</code>， 配置nginx</p>
<p>查看 <code>etc/letsencrypt/live/[DOMAIN]/</code>, 发现含有 <code>fullchain.pem</code> 和 <code>privkey.pem</code> ，然后配置 nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line">    listen 443 ssl;</span><br><span class="line"></span><br><span class="line">    server_name yun.pfan123.com;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/yun.pfan123.com/fullchain.pem;</span><br><span class="line"></span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/yun.pfan123.com/privkey.pem;</span><br><span class="line"></span><br><span class="line">    ssl_dhparam /etc/ssl/certs/dhparams.pem;</span><br><span class="line"></span><br><span class="line">    ssl_ciphers &apos;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA&apos;;</span><br><span class="line"></span><br><span class="line">    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4.配置 http 强制跳转到 https：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line">    listen 80;</span><br><span class="line"></span><br><span class="line">    server_name www.saxieyu.com;</span><br><span class="line"></span><br><span class="line">    return 301 https://$server_name$request_uri;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5.验证服务器证书</p>
<p>如上修改过 nginx 配置，并 reload 过 nginx 服务后，使用浏览器访问 <a href="https://yun.pfan123.com" target="_blank" rel="external">https://yun.pfan123.com</a>，验证服务器证书是否正确生效。</p>
<p>也可以使用 <a href="https://www.ssllabs.com/ssltest/analyze.html" target="_blank" rel="external">ssllabs</a> 在线测试服务器证书强度及配置正确性.</p>
<p>参考资料：</p>
<p><a href="https://certbot.eff.org/" target="_blank" rel="external">certbot</a></p>
<p><a href="https://github.com/certbot/certbot" target="_blank" rel="external">certbot github</a></p>
<p><a href="http://letsencrypt.readthedocs.io/en/latest/using.html#getting-certificates-and-choosing-plugins" target="_blank" rel="external">letsencrypt docs</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/letsencrypt、HTTPS、SSL、TSL/">letsencrypt、HTTPS、SSL、TSL</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-用 Git Hooks 进行自动部署" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/03/10/用 Git Hooks 进行自动部署/" class="article-date">
  	<time datetime="2017-03-10T02:00:21.000Z" itemprop="datePublished">2017-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/10/用 Git Hooks 进行自动部署/">用 Git Hooks 进行自动部署</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Git-Hook"><a href="#Git-Hook" class="headerlink" title="Git Hook"></a>Git Hook</h2><p>Git Hook是在Git仓库中特定事件发生时自动运行的脚本。它可以让你自定义Git内部的行为，在开发周期中的关键点触发自定义的行为。</p>
<p>Git Hook最常见的使用场景包括推行提交规范，根据仓库状态改变项目环境，和接入持续集成工作流。但是，因为脚本可以完全定制，你可以用Git钩子来自动化或者优化你开发工作流中任意部分。更通俗的讲，当设置了 Git Hook 后，只要你的远程仓库收到一次 push 之后，Git Hook 就能帮你执行一次 bash 脚本。</p>
<h2 id="Git-Hook-安装"><a href="#Git-Hook-安装" class="headerlink" title="Git Hook 安装"></a>Git Hook 安装</h2><p>钩子存在于每个Git仓库的.git/hooks目录中。 当你用 git init 初始化一个新版本库时，Git 默认会在这个目录中放置一些示例脚本。所有的示例都是 shell 脚本，其中一些还混杂了 Perl 代码，不过，任何正确命名的可执行脚本都可以正常使用 —— 你可以用 Ruby 或 Python，或其它语言编写它们。 这些示例的名字都是以 .sample 结尾，如果你想启用它们，得先移除这个后缀。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  hooks git:(master) ls</span><br><span class="line">applypatch-msg.sample     pre-applypatch.sample     pre-rebase.sample</span><br><span class="line">commit-msg.sample         pre-commit.sample         prepare-commit-msg.sample</span><br><span class="line">post-update.sample        pre-push.sample           update.sample</span><br></pre></td></tr></table></figure>
<h2 id="Git-Hooks-进行自动部署"><a href="#Git-Hooks-进行自动部署" class="headerlink" title="Git Hooks 进行自动部署"></a>Git Hooks 进行自动部署</h2><p>1.在服务器初始化一个远程 Git 裸仓库 (bare)</p>
<p>裸仓库与 git clone 初使化的仓库不太一样，裸仓库其实相当于通过克隆来的仓库里的.git文件夹，整个裸仓库中只有git索引（index），并没有任何代码相关的东西。要实现Push to Deploy，首先我们需要一个裸仓库。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git init --bare xxx-bare.git</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line">mkdir xxx-bare.git</span><br><span class="line">cd xxx-bare.git</span><br><span class="line">git init --bare</span><br></pre></td></tr></table></figure>
<p><code>post-update.sample</code>去掉sample， 在里面增加执行脚本:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">#</span><br><span class="line">DIR_ONE=/home/user/deploy-directory</span><br><span class="line">#</span><br><span class="line">cd $DIR_ONE</span><br><span class="line">git clean -fd</span><br><span class="line">#</span><br><span class="line">git checkout --force</span><br></pre></td></tr></table></figure>
<p>2.在服务器初始化一个本地 Git 仓库</p>
<p>在<code>deploy-directory</code>目录 git init 初始化本地仓库，它的作用是拉去远程仓库最新的源码，然后在这个仓库里进行编译，把代码编译到 www 目录（网站的根目录）。</p>
<p><code>post-update.sample</code>去掉sample， 在里面增加执行脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">unset GIT_DIR  </span><br><span class="line">DeployPath=/home/user/Deploy</span><br><span class="line">WwwPath=/home/wwwroot/Deploy</span><br><span class="line">cd $DeployPath</span><br><span class="line">git clean -f</span><br><span class="line">git pull origin master</span><br><span class="line"></span><br><span class="line">ath build WwwPath</span><br><span class="line">＃exec git-update-server-info</span><br></pre></td></tr></table></figure>
<p><code>注意：</code>  一定要<code>unset GIT_DIR</code>清除变量， 不然会引起<code>remote: fatal: Not a git repository: &#39;.&#39;</code>错误。</p>
<p><code>post-update</code>添加执行权限：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x post-receive</span><br></pre></td></tr></table></figure></p>
<p>3.本地仓库添加 remote 源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin user@1.2.3.4:/home/git/xxx-bare.git</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>
<p>参考资料：</p>
<p><a href="https://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90" target="_blank" rel="external">自定义 Git - Git 钩子</a><br><a href="https://github.com/geeeeeeeeek/git-recipes/wiki/5.4-Git%E9%92%A9%E5%AD%90%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BD%A0%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81" target="_blank" rel="external">Git钩子：自定义你的工作流</a><br><a href="https://github.com/rvagg/github-webhook-handler" target="_blank" rel="external">github-webhook-handler</a><br><a href="http://sabrinaluo.com/tech/2016/04/14/push-to-deploy-through-git-hook/" target="_blank" rel="external">如何通过Git钩子自动部署(Push to Deploy)</a><br><a href="https://segmentfault.com/a/1190000003836345" target="_blank" rel="external">用 Git Hooks 进行自动部署</a><br><a href="http://stackoverflow.com/questions/4043609/getting-fatal-not-a-git-repository-when-using-post-update-hook-to-execut" target="_blank" rel="external">“fatal: not a git repository: ‘.’”</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webhook，git，-Git-Hooks/">Webhook，git， Git Hooks</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-探究iPhone显示模式下device-width区别" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/03/04/探究iPhone显示模式下device-width区别/" class="article-date">
  	<time datetime="2017-03-04T07:00:21.000Z" itemprop="datePublished">2017-03-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/04/探究iPhone显示模式下device-width区别/">探究iPhone不同显示模式device-width值变化</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>　  为了更好的大屏显示效果，苹果为 iPhone 6、iPhone 6s、iPhone 6 Plus、iPhone 7、iPhone 7 Plus 都新增了“放大显示”模式，并提示用户使用“标准”或者“放大”模式来获得更适合自己的显示效果。</p>
<p>　　通过观察我们可以发现，iPhone 6 Plus 和 iPhone 7 Plus 在放大模式下的显示内容是和 iPhone 6、iPhone 6s、iPhone 7 的标准模式一样的，这意味着 iPhone 6、iPhone 6s、iPhone 7 放大模式的内容数量，和 iPhone 5s 的显示内容是几乎一致的。</p>
<p><img src="http://img.pfan123.com/zoomdisplaycompare.png" alt="zoomdisplaycompare"></p>
<p>此时，设备视口宽度（device-width）、高度（device-height）, 将变为与iphone 5s一致。具体，可以参照 <a href="https://www.paintcodeapp.com/news/iphone-6-screens-demystified" target="_blank" rel="external">paintcode</a> 的信息图， 如下：</p>
<p><img src="http://img.pfan123.com/iphoneDevice.jpg" alt="iphoneDevice"></p>
<p>而判断iphone6plus等大屏条件手机如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(window.screen.width &gt;= 375 &amp;&amp; window.devicePixelRatio == 3) || (window.screen.width &gt;= 414 &amp;&amp; window.devicePixelRatio == 3)&#123;</span><br><span class="line">	//此为iphone大屏手机ip6p，ip7p</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而无法准确判断区分iphone5、iphone5s与iphone6、iphone6s。</p>
<p>参考资料：</p>
<p><a href="http://blog.csdn.net/freshlover/article/details/44454991" target="_blank" rel="external">信不信由你！iPhone6屏幕宽度不一定是375px，iPhone6 Plus屏幕宽度不一定是414px</a></p>
<p><a href="https://www.paintcodeapp.com/news/ultimate-guide-to-iphone-resolutions" target="_blank" rel="external">The Ultimate Guide To iPhone Resolutions</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/device-width-window-screen-width-区分ip6与ip6plus/">device-width window.screen.width 区分ip6与ip6plus</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-Fiddler实战深入研究" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/28/Fiddler实战深入研究/" class="article-date">
  	<time datetime="2017-02-28T02:00:21.000Z" itemprop="datePublished">2017-02-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/28/Fiddler实战深入研究/">Fiddler实战深入研究</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文介绍的工具是 <a href="http://www.telerik.com/fiddler" target="_blank" rel="external">Fiddler</a>，它能够在本机和服务端之间建立一个代理，通过这个代理，可以对所有经过的请求和响应进行拦截、修改、分析等。理论上说，只要你使用的软件支持代理，都可以用 Fiddler 进行拦截，包括浏览器、命令行等。</p>
<p>类似的软件有很多，比如 WireShark、HttpWatch 等，如果只是模拟发请求的话，Chrome 中有几个插件也很不错，比如 Postman、REST Client 等。</p>
<h2 id="基本术语"><a href="#基本术语" class="headerlink" title="基本术语"></a>基本术语</h2><h3 id="会话（Session）"><a href="#会话（Session）" class="headerlink" title="会话（Session）"></a>会话（Session）</h3><p>不同于服务端的 Session，这里仅仅指一次HTTP请求而已。会话面板在工具左侧，如下图所示。</p>
<p><img src="http://img.pfan123.com/fiddler_1.png" alt="fiddler1"></p>
<p>图中显示了三条请求，每一列的具体含义都很清晰，认识英文单词就能懂了。</p>
<p>只是左边 # 号下的图标，帮各位找了一下，见下图。</p>
<p><img src="http://img.pfan123.com/fiddler_2.png" alt="fiddler2"></p>
<p>默认情况下，一旦开启 Fiddler，就会走它的代理。想暂停这种行为，那请看到左下方有个状态栏。</p>
<p><img src="http://img.pfan123.com/fiddler_3.png" alt="fiddler3"></p>
<p>单击一下左边的 Capturing，就能停止拦截，想再开启，就再单击一下。</p>
<p>它的右边是会话的来源，可以设置仅仅拦截浏览器发出的请求。</p>
<p>右边还有有三种选择：1、在请求发出之前进行断点；2、在响应回来的时候进行断点；3、不设断点。</p>
<h3 id="审查（Inspector）"><a href="#审查（Inspector）" class="headerlink" title="审查（Inspector）"></a>审查（Inspector）</h3><p>随便单击一条会话，右侧就会显示详细信息。</p>
<p><img src="http://img.pfan123.com/fiddler_4.png" alt="fiddler4"></p>
<p>首先，这里有上下两栏，上面是 Request，下面是 Response。</p>
<p>Request 中有三个比较重要的：</p>
<ul>
<li>Headers、Cookies，并且可以对请求体格式化，以 WebForms、JSON、Raw 等方式查看。具体每种方式的区别可以自己感受一下。一般来说，想要查看请求的参数的话，WebForms 的方式就挺直观的。</li>
<li>AutoResponder：这个地方可以模拟服务端返回值。顾名思义，当浏览器发出的请求满足你设置的匹配条件的话，Fiddler 就自动响应了，并不需要走网络。</li>
<li>Composer：模拟向服务端发送请求，用于测试服务端接口是否正确。</li>
</ul>
<p>Response 中常用也有三个：</p>
<ul>
<li>Headers：响应头。比如 Content-Type、Access-Control-Allow-Origin 等这些属性都在这个 tab 展示。</li>
<li>Cookies：查看由服务端带回来的 cookie。</li>
<li>JSON：将返回的内容以 JSON 格式显示。这个很有用，特别是当服务端返回的内容本身就是 JSON 的时候。</li>
</ul>
<h2 id="QuickExec"><a href="#QuickExec" class="headerlink" title="QuickExec"></a>QuickExec</h2><p>它位于状态栏的上方，有个 QuickExec 的提示，非常显眼。</p>
<p>其实，当你看到它的时候，就已经会了第一个命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">help</span><br></pre></td></tr></table></figure>
<p>输入<code>help</code>会带你到命令行的<a href="http://docs.telerik.com/fiddler/KnowledgeBase/QuickExec" target="_blank" rel="external">帮助页</a>，上面列举了所有可用的命令。不是很多，而且都很直观。这里同样把常用的列一下。</p>
<ul>
<li><code>?sometext</code>：高亮包含匹配文字的会话。比如 <code>?/foo</code> 就可以把所有包含 <code>/foo</code> 的请求都找出来。</li>
</ul>
<p>其他的高亮功能还有：=（匹配请求方法或状态码）、@（匹配host）、select（匹配MIME）。</p>
<ul>
<li>clear：清空会话面板。</li>
<li>keeponly：清空会话面板，仅保留指定的MIME类型。比如 <code>keeponly json</code> 就能筛选出所有返回 json 的会话。</li>
<li>go：放行所有的断点。</li>
</ul>
<h2 id="请求重定向-AutoResponder"><a href="#请求重定向-AutoResponder" class="headerlink" title="请求重定向(AutoResponder)"></a>请求重定向(AutoResponder)</h2><p>所谓请求在前端就是一些基本的css，js，图片等请求，重定向是指页面请求资源文件替换成其他需要替换成的文件。</p>
<p>比如目前需要调试线上某个js或者css文件等，可以使用fiddler捕获这个文件的请求，然后复制线上一份文件(比如JS或者css)代码放到本地，在本地的文件(JS或者css)修改完后，替换线上的文件来调式，当一切设置完毕之后，可以直接把代码提交到服务器上即可，如下所示：<br><img src="http://img.pfan123.com/fiddler_5.png" alt="fiddler5"></p>
<p>如上：<code>Enable automatic responses</code> 复选框的含义是：控制是否激活 <code>AutoResponder</code> 选项卡，如果没有选中该选项，选项卡上的其他选项就不可选。</p>
<p><code>Unmatched  requests passthrough</code> 复选框的含义是： 如果选中该选项，不匹配的请求会正常发送到服务器，如果没有选中该选项，Fiddler会为所有和该规则完全不匹配的HTTP请求生成 HTTP/404 Not Found 响应，比如我现在不勾选它，如下所示：<br><img src="http://img.pfan123.com/fiddler_6.png" alt="fiddler6"></p>
<p>那么现在再来访问淘宝网，就访问不了，提示如下所示：<br><img src="http://img.pfan123.com/fiddler_7.png" alt="fiddler7"></p>
<p><code>Enable Latency</code>的含义是：控制匹配某个规则的请求时立即执行，还是延迟Latency字段中所指定的毫秒数。如果没有选中该选项，Latency字段就不会显示，使用这个选项可以更准确地模拟现实中的服务器响应，取消该选项可以提升性能。如下所示：<br><img src="http://img.pfan123.com/fiddler_8.png" alt="fiddler8"></p>
<p>我们也可以点击右键进行毫秒数设置它，如下：<br><img src="http://img.pfan123.com/fiddler_9.png" alt="fiddler9"></p>
<p>在下方的Rule Editor选项卡中可以调整上面的请求替换，如下：<br>第一个下拉框指需要替换的文件，第二个下拉框a.js是替换上面的下拉框的文件；当然不一定要这样替换，如果正则非常好的话，我们可以使用正则替换需要替换的文件。当我们点击 save后即可替换。</p>
<p><img src="http://img.pfan123.com/fiddler_10.png" alt="fiddler10"></p>
<h2 id="Composer选项卡"><a href="#Composer选项卡" class="headerlink" title="Composer选项卡"></a>Composer选项卡</h2><p>Composer选项卡支持手动构建和发送HTTP，HTTPS和FTP请求，我们还可以从web session列表中拖曳session，把它放到composer选项卡中，当我们点击Execute按钮，把请求发送到服务器端。</p>
<p>Composer使用场景如下：</p>
<p>比如开发需要测试post请求接口，都知道浏览器请求只能是get请求，所以无法使用浏览器来测试，因此可以使用Composer构造post请求，点击execute发送请求。</p>
<p>Composer选项卡是由4个子选项卡组成的，如下所示：</p>
<p><img src="http://img.pfan123.com/fiddler_11.png" alt="fiddler11"></p>
<p>其中 Scratchpad 选项卡基本不用，先看 <code>Options</code> 选项卡中 <code>Request Options</code> 的复选框中的含义如下：</p>
<p><code>Inspect  Session</code>  请求执行后，Inspectors选项卡会被激活，可以查看请求结果。</p>
<p><code>Fix Content-Length header*</code>  该选项控制Composer是否会自动添加或修改Content-Length请求头，表示请求体的大小。在很多情况下，缺少适当的Content-Length头的请求会导致http请求响应出错。</p>
<p><code>Follow Redirects*</code>  该选项控制Composer是否会自动使用响应的Location头，遵循HTTP/3xx重定向，如果选中该选项，Composer在失败之前最多会执行10次重定向。</p>
<p><code>Automatically Authenticate*</code>  该选项控制composer是否会自动响应服务器的HTTP/401或HTTP/407认证需求。</p>
<p><code>Tear off button</code>  该按钮会从主Fiddler窗口删除Composer，并把它作为独立的悬浮窗口打开。如果选中Inspect   Session选项，该选项就非常有用，因为它支持同时查看Composer和Inspector选项卡；</p>
<h2 id="断点调试"><a href="#断点调试" class="headerlink" title="断点调试"></a>断点调试</h2><p>这是Fiddler又一强大和实用的工具之一。通过设置断点，Fiddler可以做到：</p>
<ul>
<li><p>1.修改HTTP请求头信息。例如修改请求头的UA, Cookie, Referer 信息，通过“伪造”相应信息达到达到相应的目的（调试，模拟用户真实请求等）。</p>
</li>
<li><p>2.构造请求数据，突破表单的限制，随意提交数据。避免页面js和表单限制影响相关调试。</p>
</li>
<li><p>3.拦截响应数据，修改响应实体。</p>
</li>
</ul>
<p>为什么以上方法是重要的？假设js前端程序员和服务器程序员是分工合作的，js程序员想要调试Ajax请求的功能，这样便不必等待服务器端程序员开发好所有接口之后再开始开发js端的ajax请求功能，因为通过“模拟”真实的服务器端的响应，便可以保证功能的正确性，而服务器端开发程序员，只要保证最终的响应是符合规定的即可。这大大简化了程序开发的效率，当然也降低了不同业务线程序员联调的难度。</p>
<p>有两种方法设置断点：</p>
<ul>
<li>1.fiddler菜单栏-&gt;rules-&gt;automatic Breakpoints-&gt;选择断点方式，这种方式下设定的断点会对之后的所有HTTP请求有效。</li>
</ul>
<p>有两个断点位置：</p>
<blockquote>
<p>a. before response。也就是发送请求之后，但是Fiddler代理中转之前，这时可以修改请求的数据。</p>
<p>b.after response。也就是服务器响应之后，但是在Fiddler将响应中转给客户端之前。这时可以修改响应的结果。</p>
</blockquote>
<ul>
<li>2.命令行下输入。Bpafter xxx或者bpv,bpu,bpm等设置断点。这种断点只针对特定类型的请求。</li>
</ul>
<p>参考资料：</p>
<p><a href="http://docs.telerik.com/fiddler/KnowledgeBase/QuickExec" target="_blank" rel="external">Fiddler官方文档</a><br><a href="http://www.cnblogs.com/tugenhua0707/p/4637771.html#_labe4" target="_blank" rel="external">Fiddler实战深入研究</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fiddler/">fiddler</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-Linux(CentOS)下设置nginx开机自动启动和chkconfig管理--转载" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/20/Linux(CentOS)下设置nginx开机自动启动和chkconfig管理--转载/" class="article-date">
  	<time datetime="2017-02-20T02:00:21.000Z" itemprop="datePublished">2017-02-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/20/Linux(CentOS)下设置nginx开机自动启动和chkconfig管理--转载/">Linux(CentOS)下设置nginx开机自动启动和chkconfig管理--转载</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Nginx 是一个很强大的高性能Web和反向代理服务器。虽然使用命令行可以对nginx进行各种操作，比如启动等，但是还是根据不太方便。下面介绍在linux下安装后，如何设置开机自启动。</p>
<h2 id="配置自动启动"><a href="#配置自动启动" class="headerlink" title="配置自动启动"></a>配置自动启动</h2><p>首先，在linux系统的/etc/init.d/目录下创建nginx文件，使用如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/init.d/nginx</span><br></pre></td></tr></table></figure>
<p>在脚本中添加如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">#</span><br><span class="line"># nginx - this script starts and stops the nginx daemon</span><br><span class="line">#</span><br><span class="line"># chkconfig:   - 85 15</span><br><span class="line"># description:  NGINX is an HTTP(S) server, HTTP(S) reverse \</span><br><span class="line">#               proxy and IMAP/POP3 proxy server</span><br><span class="line"># processname: nginx</span><br><span class="line"># config:      /etc/nginx/nginx.conf</span><br><span class="line"># config:      /etc/sysconfig/nginx</span><br><span class="line"># pidfile:     /var/run/nginx.pid</span><br><span class="line"></span><br><span class="line"># Source function library.</span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"></span><br><span class="line"># Source networking configuration.</span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"></span><br><span class="line"># Check that networking is up.</span><br><span class="line">[ &quot;$NETWORKING&quot; = &quot;no&quot; ] &amp;&amp; exit 0</span><br><span class="line"></span><br><span class="line">nginx=&quot;/usr/sbin/nginx&quot;</span><br><span class="line">prog=$(basename $nginx)</span><br><span class="line"></span><br><span class="line">NGINX_CONF_FILE=&quot;/etc/nginx/nginx.conf&quot;</span><br><span class="line"></span><br><span class="line">[ -f /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx</span><br><span class="line"></span><br><span class="line">lockfile=/var/lock/subsys/nginx</span><br><span class="line"></span><br><span class="line">make_dirs() &#123;</span><br><span class="line">   # make required directories</span><br><span class="line">   user=`$nginx -V 2&gt;&amp;1 | grep &quot;configure arguments:.*--user=&quot; | sed &apos;s/[^*]*--user=\([^ ]*\).*/\1/g&apos; -`</span><br><span class="line">   if [ -n &quot;$user&quot; ]; then</span><br><span class="line">      if [ -z &quot;`grep $user /etc/passwd`&quot; ]; then</span><br><span class="line">         useradd -M -s /bin/nologin $user</span><br><span class="line">      fi</span><br><span class="line">      options=`$nginx -V 2&gt;&amp;1 | grep &apos;configure arguments:&apos;`</span><br><span class="line">      for opt in $options; do</span><br><span class="line">          if [ `echo $opt | grep &apos;.*-temp-path&apos;` ]; then</span><br><span class="line">              value=`echo $opt | cut -d &quot;=&quot; -f 2`</span><br><span class="line">              if [ ! -d &quot;$value&quot; ]; then</span><br><span class="line">                  # echo &quot;creating&quot; $value</span><br><span class="line">                  mkdir -p $value &amp;&amp; chown -R $user $value</span><br><span class="line">              fi</span><br><span class="line">          fi</span><br><span class="line">       done</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">start() &#123;</span><br><span class="line">    [ -x $nginx ] || exit 5</span><br><span class="line">    [ -f $NGINX_CONF_FILE ] || exit 6</span><br><span class="line">    make_dirs</span><br><span class="line">    echo -n $&quot;Starting $prog: &quot;</span><br><span class="line">    daemon $nginx -c $NGINX_CONF_FILE</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; touch $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    echo -n $&quot;Stopping $prog: &quot;</span><br><span class="line">    killproc $prog -QUIT</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restart() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    stop</span><br><span class="line">    sleep 1</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reload() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    echo -n $&quot;Reloading $prog: &quot;</span><br><span class="line">    killproc $nginx -HUP</span><br><span class="line">    RETVAL=$?</span><br><span class="line">    echo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">force_reload() &#123;</span><br><span class="line">    restart</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">configtest() &#123;</span><br><span class="line">  $nginx -t -c $NGINX_CONF_FILE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rh_status() &#123;</span><br><span class="line">    status $prog</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rh_status_q() &#123;</span><br><span class="line">    rh_status &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        rh_status_q &amp;&amp; exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    restart|configtest)</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        rh_status_q || exit 7</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">    condrestart|try-restart)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">            ;;</span><br><span class="line">    *)</span><br><span class="line">        echo $&quot;Usage: $0 &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;&quot;</span><br><span class="line">        exit 2</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
<p>这个脚本其实也不是我写的，谁写的呢，nginx官方写的，脚本地址：<a href="https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/" target="_blank" rel="external">http://wiki.nginx.org/RedHatNginxInitScript</a> ，不过要注意，如果你是自定义编译安装的nginx，需要根据您的安装路径修改下面这两项配置：</p>
<p>nginx=”/usr/sbin/nginx” 修改成nginx执行程序的路径。</p>
<p>NGINX_CONF_FILE=”/etc/nginx/nginx.conf” 修改成配置文件的路径。</p>
<p>保存脚本文件后<code>设置文件的执行权限</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x /etc/init.d/nginx</span><br></pre></td></tr></table></figure>
<p>然后，就可以通过该脚本对nginx服务进行管理了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/nginx start</span><br><span class="line">/etc/init.d/nginx stop</span><br></pre></td></tr></table></figure>
<p>检查 <code>nginx conf</code> 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./webserver/nginx/sbin/nginx -t</span><br></pre></td></tr></table></figure>
<h2 id="使用chkconfig进行管理"><a href="#使用chkconfig进行管理" class="headerlink" title="使用chkconfig进行管理"></a>使用chkconfig进行管理</h2><p>上面的方法完成了用脚本管理nginx服务的功能，但是还是不太方便，比如要设置nginx开机启动等。这时可以使用chkconfig来设置。</p>
<p>先将nginx服务加入chkconfig管理列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add /etc/init.d/nginx</span><br></pre></td></tr></table></figure>
<p>加完这个之后，就可以使用service对nginx进行启动，重启等操作了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service nginx start</span><br><span class="line">service nginx stop</span><br></pre></td></tr></table></figure>
<p>设置终端模式开机启动：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig nginx on</span><br></pre></td></tr></table></figure></p>
<p>chkconfig命令的使用方法，就不多数啦，可以自行搜索</p>
<h2 id="其他方案"><a href="#其他方案" class="headerlink" title="其他方案"></a>其他方案</h2><p>另外这里还有一个网友分享的脚本（脚本地址：<a href="http://blog.163.com/qsc0624@126/blog/static/140324073201312734548701/" target="_blank" rel="external">http://blog.163.com/qsc0624@126/blog/static/140324073201312734548701/</a>）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># nginx Startup script for the Nginx HTTP Server</span><br><span class="line"># it is v.0.0.2 version.</span><br><span class="line"># chkconfig: - 85 15</span><br><span class="line"># description: Nginx is a high-performance web and proxy server.</span><br><span class="line">#              It has a lot of features, but it&apos;s not for everyone.</span><br><span class="line"># processname: nginx</span><br><span class="line"># pidfile: /var/run/nginx.pid</span><br><span class="line"># config: /usr/local/nginx/conf/nginx.conf</span><br><span class="line">nginxd=/usr/local/nginx/sbin/nginx</span><br><span class="line">nginx_config=/usr/local/nginx/conf/nginx.conf</span><br><span class="line">nginx_pid=/var/run/nginx.pid</span><br><span class="line">RETVAL=0</span><br><span class="line">prog=&quot;nginx&quot;</span><br><span class="line"># Source function library.</span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"># Source networking configuration.</span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"># Check that networking is up.</span><br><span class="line">[ $&#123;NETWORKING&#125; = &quot;no&quot; ] &amp;&amp; exit 0</span><br><span class="line">[ -x $nginxd ] || exit 0</span><br><span class="line"># Start nginx daemons functions.</span><br><span class="line">start() &#123;</span><br><span class="line">if [ -e $nginx_pid ];then</span><br><span class="line">   echo &quot;nginx already running....&quot;</span><br><span class="line">   exit 1</span><br><span class="line">fi</span><br><span class="line">   echo -n $&quot;Starting $prog: &quot;</span><br><span class="line">   daemon $nginxd -c $&#123;nginx_config&#125;</span><br><span class="line">   RETVAL=$?</span><br><span class="line">   echo</span><br><span class="line">   [ $RETVAL = 0 ] &amp;&amp; touch /var/lock/subsys/nginx</span><br><span class="line">   return $RETVAL</span><br><span class="line">&#125;</span><br><span class="line"># Stop nginx daemons functions.</span><br><span class="line">stop() &#123;</span><br><span class="line">        echo -n $&quot;Stopping $prog: &quot;</span><br><span class="line">        killproc $nginxd</span><br><span class="line">        RETVAL=$?</span><br><span class="line">        echo</span><br><span class="line">        [ $RETVAL = 0 ] &amp;&amp; rm -f /var/lock/subsys/nginx /var/run/nginx.pid</span><br><span class="line">&#125;</span><br><span class="line"># reload nginx service functions.</span><br><span class="line">reload() &#123;</span><br><span class="line">    echo -n $&quot;Reloading $prog: &quot;</span><br><span class="line">    #kill -HUP `cat $&#123;nginx_pid&#125;`</span><br><span class="line">    killproc $nginxd -HUP</span><br><span class="line">    RETVAL=$?</span><br><span class="line">    echo</span><br><span class="line">&#125;</span><br><span class="line"># See how we were called.</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">start)</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">stop)</span><br><span class="line">        stop</span><br><span class="line">        ;;</span><br><span class="line">reload)</span><br><span class="line">        reload</span><br><span class="line">        ;;</span><br><span class="line">restart)</span><br><span class="line">        stop</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">status)</span><br><span class="line">        status $prog</span><br><span class="line">        RETVAL=$?</span><br><span class="line">        ;;</span><br><span class="line">*)</span><br><span class="line">        echo $&quot;Usage: $prog &#123;start|stop|restart|reload|status|help&#125;&quot;</span><br><span class="line">        exit 1</span><br><span class="line">esac</span><br><span class="line">exit $RETVAL</span><br></pre></td></tr></table></figure>
<p>参考资料：</p>
<p><a href="http://www.runoob.com/linux/nginx-install-setup.html" target="_blank" rel="external">Nginx 安装配置</a><br><a href="http://www.cnblogs.com/peida/tag/linux%E5%91%BD%E4%BB%A4/" target="_blank" rel="external">linux 命令学习教程</a><br><a href="http://wiki.ubuntu.org.cn/%E8%B7%9F%E6%88%91%E4%B8%80%E8%B5%B7%E5%86%99Makefile" target="_blank" rel="external">跟我一起写Makefile</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux、Unix/">Linux、Unix</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-CentOS系统环境下安装MongoDB" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/07/CentOS系统环境下安装MongoDB/" class="article-date">
  	<time datetime="2017-02-07T02:00:21.000Z" itemprop="datePublished">2017-02-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/07/CentOS系统环境下安装MongoDB/">CentOS系统环境下安装MongoDB</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Linux平台安装MongoDB"><a href="#Linux平台安装MongoDB" class="headerlink" title="Linux平台安装MongoDB"></a>Linux平台安装MongoDB</h2><p>MongoDB提供了linux平台上32位和64位的安装包，你可以在官网下载安装包。<br>下载地址：(<a href="http://www.mongodb.org/downloads)[http://www.mongodb.org/downloads" target="_blank" rel="external">http://www.mongodb.org/downloads)[http://www.mongodb.org/downloads</a>]</p>
<p><img src="http://www.runoob.com/wp-content/uploads/2013/10/MongoDB-Linux.jpg" alt="Linux文件目录1"></p>
<p>1.查看系统，判定系统位数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure>
<p>如果输出的信息包含 x86_64 说明你的系统是64位,如果不包含说明是32位系统.</p>
<p>2.下载完安装包，并解压 tgz（以下演示的是 32 位 Linux上的安装） </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://fastdl.mongodb.org/linux/mongodb-linux-i686-3.0.6.tgz  # 下载</span><br><span class="line"></span><br><span class="line">tar -zxvf mongodb-linux-i686-3.0.6.tgz                                 # 解压</span><br><span class="line"></span><br><span class="line">mv mongodb-linux-i686-3.0.6 /usr/local/mongodb   # 将解压包拷贝到指定目录</span><br></pre></td></tr></table></figure>
<p>3.MongoDB 的可执行文件位于 bin 目录下，所以可以将其添加到 PATH 路径中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=&lt;mongodb-install-directory&gt;/bin:$PATH</span><br></pre></td></tr></table></figure>
<p><code>&lt;mongodb-install-directory&gt;</code> 为你 MongoDB 的安装路径。如本文的 <code>/usr/local/mongodb</code> 。</p>
<p>4.创建数据库目录</p>
<p>MongoDB的数据存储在data目录的db目录下，但是这个目录在安装过程不会自动创建，所以你需要手动创建data目录，并在data目录中创建db目录。</p>
<p>进入mongodb目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mongodb</span><br></pre></td></tr></table></figure>
<p>新建自定义数据目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ./data/db/</span><br></pre></td></tr></table></figure>
<p>新建日志目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir logs</span><br></pre></td></tr></table></figure>
<p>5.命令行中运行 MongoDB 服务</p>
<p>你可以再命令行中执行mongo安装目录中的bin目录执行mongod命令来启动mongdb服务。</p>
<blockquote>
<p>注意：如果你的数据库目录不是/data/db，可以通过 –dbpath 来指定。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">进入bin目录</span><br><span class="line">cd /usr/local/mongodb/bin/</span><br><span class="line"></span><br><span class="line">启动 mongodb</span><br><span class="line">./mongod</span><br></pre></td></tr></table></figure>
<p>以后台运行方式启动mongodb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mongodb/bin/mongod --dbpath=/usr/local/mongodb/data/db --logpath=/usr/local/mongodb/logs/mongodb.log --fork</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">显示</span><br><span class="line">forked process: 18261</span><br><span class="line">all output going to: /usr/local/mongodb/logs/mongodb.log</span><br><span class="line">log file [/usr/local/mongodb/logs/mongodb.log] exists; copied to temporary file [/usr/local/mongodb/logs/mongodb.log.2013-03-01T04-04-28]</span><br><span class="line">child process started successfully, parent exiting</span><br></pre></td></tr></table></figure>
<p>设置开机自启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;/usr/local/mongodb/bin/mongod --dbpath=/usr/local/mongodb/data/db --logpath=/usr/local/mongodb/logs/mongodb.log --fork&quot; &gt;&gt; /etc/rc.local</span><br></pre></td></tr></table></figure>
<p>查看MongoDB日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f /usr/local/mongodb/logs/mongodb.log</span><br></pre></td></tr></table></figure>
<p>参考资料：</p>
<p><a href="http://www.runoob.com/mongodb/mongodb-linux-install.html" target="_blank" rel="external">Linux平台安装MongoDB</a></p>
<p><a href="http://yijiebuyi.com/blog/9daac70a111e4c3298a4cb69b5dc6214.html" target="_blank" rel="external">CentOS 中使用 yum 安装 mongodb</a></p>
<p><a href="https://my.oschina.net/chinaearl/blog/111077" target="_blank" rel="external">CentOS系统环境下安装MongoDB</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux、Unix/">Linux、Unix</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-Linux 使用nvm安装node" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/06/Linux 使用nvm安装node/" class="article-date">
  	<time datetime="2017-02-06T07:00:21.000Z" itemprop="datePublished">2017-02-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/06/Linux 使用nvm安装node/">Linux 使用nvm安装node</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="NVM安装"><a href="#NVM安装" class="headerlink" title="NVM安装"></a>NVM安装</h2><p>NVM（Node version manager）顾名思义，就是Node.js的版本管理软件，可以轻松的在Node.js各个版本间切换，项目源码 <a href="https://github.com/creationix/nvm" target="_blank" rel="external">GitHub</a>。</p>
<p>1.下载并安装NVM脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl https://raw.githubusercontent.com/creationix/nvm/v0.13.1/install.sh | bash</span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>
<p>2.列出所需要的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm list-remote</span><br></pre></td></tr></table></figure>
<p>返回结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">	  v5.4.0</span><br><span class="line">      v5.4.1</span><br><span class="line">      v5.5.0</span><br><span class="line">      v5.6.0</span><br><span class="line">      v5.7.0</span><br><span class="line">     v5.10.0</span><br><span class="line">     v5.10.1</span><br><span class="line">     v5.11.0</span><br><span class="line">     v5.11.1</span><br><span class="line">     v5.12.0</span><br><span class="line">      v6.9.1</span><br><span class="line">      v6.9.2</span><br><span class="line">      v6.9.3</span><br><span class="line">      v6.9.4</span><br><span class="line">      v6.9.5</span><br><span class="line">      v7.0.0</span><br><span class="line">      v7.1.0</span><br><span class="line">      v7.2.0</span><br><span class="line">      v7.2.1</span><br><span class="line">      v7.3.0</span><br><span class="line">      v7.4.0</span><br><span class="line">      v7.5.0</span><br></pre></td></tr></table></figure>
<p>3.安装相应的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm install v5.4.0</span><br></pre></td></tr></table></figure>
<p>4.查看已安装的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nvm list</span><br><span class="line"></span><br><span class="line">-&gt;  v0.10.30</span><br><span class="line">      system</span><br></pre></td></tr></table></figure>
<p>5.切换版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm use v5.4.0</span><br></pre></td></tr></table></figure>
<p>6.设置默认版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm alias default v5.4.0</span><br></pre></td></tr></table></figure>
<p>参考资料：</p>
<p><a href="https://cnbin.github.io/blog/2015/06/23/linux-xia-ge-ge-mu-lu-de-zuo-yong-ji-nei-rong/" target="_blank" rel="external">Linux 下各个目录的作用及内容</a></p>
<p><a href="http://linux-wiki.cn/wiki/zh-hans/Linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" target="_blank" rel="external">Linux目录结构</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2012/02/a_history_of_unix_directory_structure.html" target="_blank" rel="external">Unix目录结构的来历</a></p>
<p><a href="http://blog.csdn.net/csfreebird/article/details/48804797" target="_blank" rel="external">Linux常见目录使用区别</a></p>
<p><a href="http://www.imooc.com/article/12746" target="_blank" rel="external">Linux常用命令 帮助命令</a></p>
<p><a href="http://www.runoob.com/linux/nginx-install-setup.html" target="_blank" rel="external">Nginx 安装配置</a></p>
<p><a href="http://wiki.ubuntu.org.cn/%E8%B7%9F%E6%88%91%E4%B8%80%E8%B5%B7%E5%86%99Makefile" target="_blank" rel="external">跟我一起写Makefile</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux、Unix、nvm、node/">Linux、Unix、nvm、node</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-Linux 下各个目录的作用--转载" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/04/Linux 下各个目录的作用--转载/" class="article-date">
  	<time datetime="2017-02-04T02:00:21.000Z" itemprop="datePublished">2017-02-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/04/Linux 下各个目录的作用--转载/">Linux 下各个目录的作用--转载</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Linux-目录"><a href="#Linux-目录" class="headerlink" title="Linux 目录"></a>Linux 目录</h2><p>在早期的 <code>UNIX</code> 系统中，各个厂家各自定义了自己的 <code>UNIX</code> 系统文件目录，比较混乱。<code>Linux</code> 面世不久后，对文件目录进行了标准化，于1994年对根文件目录做了统一的规范，推出 FHS ( Filesystem Hierarchy Standard ) 的 <code>Linux</code> 文件系统层次结构标准。FHS 标准规定了 Linux 根目录各文件夹的名称及作用，统一了 <code>Linux</code> 界命名混乱的局面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">＃ cd /</span><br><span class="line">＃ ls</span><br><span class="line"></span><br><span class="line">//显示如下 root是根目录</span><br><span class="line">aquota.group  bin   dev  home  lost+found  mnt  proc  sbin     srv  tmp  var</span><br><span class="line">aquota.user   boot  etc  lib   media       opt  root  selinux  sys  usr</span><br></pre></td></tr></table></figure>
<p>无论何种版本的 <code>Linux</code> 发行版，桌面、应用是 <code>Linux</code> 的外衣，文件组织、目录结构才是 <code>Linux</code> 的内心。</p>
<p><code>FHS</code>（英文：<code>Filesystem Hierarchy Standard</code> 中文：文件系统层次结构标准），多数 Linux 版本采用这种文件组织形式，FHS 定义了系统中每个区域的用途、所需要的最小构成的文件和目录同时还给出了例外处理与矛盾处理。 FHS 定义了两层规范，第一层是， <code>/</code> 下面的各个目录应该要放什么文件数据，例如 <code>/etc</code> 应该要放置设置文件，<code>/bin</code> 与 <code>/sbin</code> 则应该要放置可执行文件等等。</p>
<p>第二层则是针对 <code>/usr</code> 及 <code>/var</code> 这两个目录的子目录来定义。例如 <code>/var/log</code> 放置系统登录文件、 <code>/usr/share</code> 放置共享数据等等。</p>
<p><code>FHS</code> 是根据以往无数 Linux 用户和开发者的经验总结出来的，并且会维持更新，FHS 依据文件系统使用的频繁与否以及是否允许用户随意改动（注意，不是不能，学习过程中，不要怕这些），将目录定义为四种交互作用的形态，如下表所示：</p>
<p><img src="http://ww2.sinaimg.cn/mw690/78f9859egw1etd2zfi9t1j20sx061tb4.jpg" alt="Linux文件目录1"></p>
<p><code>/</code>：根目录，一般根目录下只存放目录，不要存放件，/etc、/bin、/dev、/lib、/sbin应该和根目录放置在一个分区中</p>
<p><img src="http://ww3.sinaimg.cn/mw690/78f9859egw1etbt8f77f2j20io0bsgm4.jpg" alt="Linux文件目录2"></p>
<p><code>/bin</code>: <code>/usr/bin</code>: 可执行二进制文件的目录，如常用的命令ls、tar、mv、cat等。</p>
<p><code>/boot</code>：放置linux系统启动时用到的一些文件。/boot/vmlinuz 为 linux 的内核文件，以及 /boot/gurb。建议单独分区，分区大小100M即可</p>
<p><code>/dev</code>：存放linux系统下的设备文件，访问该目录下某个文件，相当于访问某个设备，常用的是挂载光驱 mount /dev/cdrom /mnt。</p>
<p><code>/etc</code>：系统配置文件存放的目录，不建议在此目录下存放可执行文件，重要的配置文件有 /etc/inittab、/etc/fstab、/etc/init.d、/etc/X11、/etc/sysconfig、/etc/xinetd.d修改配置文件之前记得备份。</p>
<blockquote>
<p>注：/etc/X11 存放与 x windows 有关的设置。</p>
</blockquote>
<p><code>/home</code>：系统默认的用户家目录，新增用户账号时，用户的家目录都存放在此目录下，~表示当前用户的家目录，~edu 表示用户 edu 的家目录。建议单独分区，并设置较大的磁盘空间，方便用户存放数据</p>
<p><code>/lib</code>: <code>/usr/lib</code>: <code>/usr/local/lib</code>：系统使用的函数库的目录，程序在执行过程中，需要调用一些额外的参数时需要函数库的协助，比较重要的目录为 /lib/modules。</p>
<p><code>/lost+fount</code>：系统异常产生错误时，会将一些遗失的片段放置于此目录下，通常这个目录会自动出现在装置目录下。如加载硬盘于 /disk 中，此目录下就会自动产生目录 /disk/lost+found</p>
<p><code>/mnt</code>: <code>/media</code>：光盘默认挂载点，通常光盘挂载于 /mnt/cdrom 下，也不一定，可以选择任意位置进行挂载。</p>
<p><code>/opt</code>：给主机额外安装软件所摆放的目录。如：FC4使用的Fedora 社群开发软件，如果想要自行安装新的 KDE 桌面软件，可以将该软件安装在该目录下。以前的 Linux 系统中，习惯放置在 /usr/local 目录下</p>
<p><code>/proc</code>：此目录的数据都在内存中，如系统核心，外部设备，网络状态，由于数据都存放于内存中，所以不占用磁盘空间，比较重要的目录有 /proc/cpuinfo、/proc/interrupts、/proc/dma、/proc/ioports、/proc/net/* 等。</p>
<p><code>/root</code>：系统管理员root的家目录，系统第一个启动的分区为 /，所以最好将 /root和 /放置在一个分区下。</p>
<p><code>/sbin</code>: <code>/usr/sbin</code>: <code>/usr/local/sbin</code>：放置系统管理员使用的可执行命令，如fdisk、shutdown、mount 等。与 /bin 不同的是，这几个目录是给系统管理员 root使用的命令，一般用户只能”查看”而不能设置和使用。</p>
<p><code>/tmp</code>：一般用户或正在执行的程序临时存放文件的目录，任何人都可以访问，重要数据不可放置在此目录下</p>
<p><code>/srv</code>：服务启动之后需要访问的数据目录，如 www 服务需要访问的网页数据存放在 /srv/www 内。</p>
<p><code>/usr</code>：应用程序存放目录，/usr/bin 存放应用程序，/usr/share 存放共享数据，/usr/lib 存放不能直接运行的，却是许多程序运行所必需的一些函数库文件。/usr/local: 存放软件升级包。/usr/share/doc: 系统说明文件存放目录。/usr/share/man: 程序说明文件存放目录，使用 man ls 时会查询 /usr/share/man/man1/ls.1.gz 的内容建议单独分区，设置较大的磁盘空间。</p>
<p><code>/var</code>：放置系统执行过程中经常变化的文件，如随时更改的日志文件 /var/log，/var/log/message：所有的登录文件存放目录，/var/spool/mail：邮件存放的目录，/var/run:程序或服务启动后，其PID存放在该目录下。建议单独分区，设置较大的磁盘空间。</p>
<h2 id="一切皆文件"><a href="#一切皆文件" class="headerlink" title="一切皆文件"></a>一切皆文件</h2><p>Linux 对数据文件(.mp3、.bmp)，程序文件(.c、.h、*.o)，设备文件（LCD、触摸屏、鼠标），网络文件( socket ) 等的管理都抽象为文件，使用统一的方式方法管理。</p>
<p>文件分类：</p>
<p>1）普通文件( 数据文件 )</p>
<p>普通文件是用于存放数据、程序等信息的文件，一般都长期地存放在外存储器（磁盘）中。普通文件又分为文本文件和二进制文件。</p>
<p>2）目录文件</p>
<p>目录文件是文件系统中一个目录所包含的目录项所组成的文件。</p>
<p>3）设备文件</p>
<p>设备文件是用于为操作系统与设备提供连接的一种文件。在Linux系统中将设备作为文件来处理，操作设备就像是操作普通文件一样。每一个设备对应一个设备文件，存放在 /dev 目录中。</p>
<p>5）链接文件</p>
<p>似于 windows 下的快捷方式，链接又可以分为软链接（符号链接）和硬链接。</p>
<p>6）管道文件</p>
<p>管道文件主要用于在进程间传递数据的一种特殊文件。</p>
<p>7）套接口文件</p>
<p>主要用于不同计算机间网络通信的一种特殊文件。</p>
<p><img src="http://ww1.sinaimg.cn/mw690/78f9859egw1etcuy8qxfvj20hp0h2te0.jpg" alt="Linux文件目录3"></p>
<p><img src="http://ww3.sinaimg.cn/mw690/78f9859egw1etd2vg2ad8j20yn12kwlq.jpg" alt="Linux文件目录4"></p>
<p>参考资料：</p>
<p><a href="https://cnbin.github.io/blog/2015/06/23/linux-xia-ge-ge-mu-lu-de-zuo-yong-ji-nei-rong/" target="_blank" rel="external">Linux 下各个目录的作用及内容</a></p>
<p><a href="http://linux-wiki.cn/wiki/zh-hans/Linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" target="_blank" rel="external">Linux目录结构</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2012/02/a_history_of_unix_directory_structure.html" target="_blank" rel="external">Unix目录结构的来历</a></p>
<p><a href="http://blog.csdn.net/csfreebird/article/details/48804797" target="_blank" rel="external">Linux常见目录使用区别</a></p>
<p><a href="http://www.imooc.com/article/12746" target="_blank" rel="external">Linux常用命令 帮助命令</a></p>
<p><a href="http://www.runoob.com/linux/nginx-install-setup.html" target="_blank" rel="external">Nginx 安装配置</a></p>
<p><a href="http://wiki.ubuntu.org.cn/%E8%B7%9F%E6%88%91%E4%B8%80%E8%B5%B7%E5%86%99Makefile" target="_blank" rel="external">跟我一起写Makefile</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux、Unix/">Linux、Unix</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
    <article id="post-搬瓦工VPS快速搭建Shadowsocks服务器" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/03/搬瓦工VPS快速搭建Shadowsocks服务器/" class="article-date">
  	<time datetime="2017-02-03T15:00:21.000Z" itemprop="datePublished">2017-02-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/03/搬瓦工VPS快速搭建Shadowsocks服务器/">搬瓦工VPS快速搭建Shadowsocks服务器</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="shaowsocks安装"><a href="#shaowsocks安装" class="headerlink" title="shaowsocks安装"></a>shaowsocks安装</h2><p>搬瓦工自带 <code>shaowsocks</code> 一键安装，左侧菜单栏找到 <code>Shadowsocks Server</code> ，点进去安装就好了（注意：搬瓦工提供的一键安装功能只支持CentOS6，你也可以通过命令行的方式安装），安装好的 <code>Shadowsocks Server</code> 界面是这样的：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1787336-dcc98c63956bccf1.png?imageMogr2/auto-orient/strip%7CimageView2/2" alt="shaowsocks安装成功图片1"></p>
<p>此时VPN已经可以用了，还需要客户端，Windows版本的客户端在后台面板就有链接，Mac用户我已经下载好放到我的网盘了 <a href="https://pan.baidu.com/s/1bpgRndH" target="_blank" rel="external">ShadowsocksX-2.6.3.dmg</a>，安装好打开 <code>Shadowsocks Server</code> ，在Mac的工具栏会有一个小飞机的图标</p>
<blockquote>
<p>由于iPhone的Shadowsocks Server只在英国地区销售，国内的AppStore是下载不到的，大家可以在AppStore搜wingy，配置过程跟mac差不多，主要是IP、 Port和密码，加密协议都用默认的aes-256-cfb就行，然后手机也可以愉快的上网了。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1787336-bc0272263128ee87.png?imageMogr2/auto-orient/strip%7CimageView2/2" alt="shaowsocks安装成功图片2"></p>
<p>点开服务器，配置IP和密码，只需要修改地址和密码，其他不用改就OK了。<br><img src="http://upload-images.jianshu.io/upload_images/1787336-afddffb57d20deaa.png?imageMogr2/auto-orient/strip%7CimageView2/2" alt="shaowsocks安装成功图片3"></p>
<p>上两张图显示 <code>Shadowsocks Server</code> 有两种加速模式 ，<code>一般情况下勾选自动代理模式就可以了，这个这个模式下会自动判断你当前访问的域名是否在GFW名单里面，如果是就启用代理，如果不是就正常访问，这样我们在访问墙内网站的时候也不会受到任何影响</code> ，如果你遇到网站无法访问，有可能是这个网站近期被墙了，你没有更新本地的GFW名单，如果你确定这个网站是可以打开的，切换到全局模式就可以访问了。</p>
<blockquote>
<p>Shadowsocks Server自动代理模式原理是根据GFWList配置了一个PAC文件，名单中的域名全部走代理，你可以手动修改这个配置文件，添加你要访问的被墙的网站，它就是一个js文件，你点击编辑自动模式的PAC文件便会跳转到这个js所在的位置，那个GFWList自动更新功能坏掉了，作者一直也没更新，不过不影响平时使用。</p>
</blockquote>
<h2 id="net-speeder加速VPN"><a href="#net-speeder加速VPN" class="headerlink" title="net_speeder加速VPN"></a>net_speeder加速VPN</h2><p>完成以上操作，就可以访问墙外网站外了，但是速度不怎么快。可以使用 Speeder 给 VPN 加速具体如下：</p>
<p>1.先连上远程主机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@192.243.112.242 -p 26244</span><br></pre></td></tr></table></figure>
<p>注意把端口和IP换成你自己主机的，然后需要输入root密码，输入在第一步我们设置的密码就可以了。</p>
<p>2.安装Net-Speeder</p>
<p>输入下面的命令进行安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://coding.net/u/njzhenghao/p/download/git/raw/master/net_speeder-installer.sh</span><br></pre></td></tr></table></figure>
<p>3.编译并安装</p>
<p>输入下面的命令编译Net-Speeder：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash net_speeder-installer.sh</span><br></pre></td></tr></table></figure>
<p>命令执行成功之后，执行 <code>reboot</code> 重启主机，或者在后台面板重启主机也行。（<code>此时远程主机的连接会断开，需要重新连接</code>）</p>
<p>4.端口加速</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup /usr/local/net_speeder/net_speeder venet0 &quot;ip&quot; &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>执行完这个命令应该会有一个端口号打印出来，证明加速成功了！还有最后一步，点开 <code>Shadowsocks Server</code> 菜单点击退出，不要点关闭 <code>Shadowsocks Server</code> ，然后再次打开App，现在打开YouTube看个视频试试吧！现在墙外网站下载速度一般都在500KB左右，当然这个速度也受到你所在运营商的网络环境影响。（注意：加速端口这个命令每次重启主机都需要执行一次，因这个脚本没有加到开机自启动）</p>
<p>参考资料：</p>
<p><a href="http://www.cnblogs.com/yfming/p/6337301.html" target="_blank" rel="external">租用搬瓦工 VPS 自建高速丝滑 VPN</a></p>
<p><a href="https://blog.phpgao.com/vps_net_speeder.html" target="_blank" rel="external">使用net_speeder加速你的VPS</a></p>
<p><a href="http://www.jianshu.com/p/57f45490620c" target="_blank" rel="external">搬瓦工VPS搭建高速VPN服务器</a></p>
<p><a href="http://www.runoob.com/linux/nginx-install-setup.html" target="_blank" rel="external">Linux 教程</a></p>

      
    </div>

    <!-- S 打赏模块 -->
    <div class="pfan_payment" style="max-width: 500px;margin: 0 auto">
        <img src="http://img.pfan123.com/payment.png" alt="" style="width: 100%;height: 10%;">
    </div>
    <!-- E 打赏模块 -->


    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/搬瓦工，Shadowsocks/">搬瓦工，Shadowsocks</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
    
</article>











  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 pfan
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a>
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>